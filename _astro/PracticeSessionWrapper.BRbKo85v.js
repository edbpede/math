import{d as Se,c as G,g as f,t as v,a as D,i as o,b as c,S as U,e as z,s as p,f as ee,r as Y,y as Fe,M as te,F as de,z as _e,k as Ke,m as pe,h as Me,A as Ie,o as dt,u as ut,x as gt,B as ve}from"./store.D7pQqe3Y.js";import{a as We,_ as ye,d as J,m as ue,$ as ge}from"./store.CLE7GteW.js";import{s as ht,e as ft,l as He,u as mt}from"./progress.isgvytKC.js";import"./client.D0X2hLWc.js";import"./_commonjsHelpers.gnU0ypJ3.js";const ze=[{locale:"da-DK",name:"Danish",nativeName:"Dansk",direction:"ltr",numberFormat:{decimalSeparator:",",thousandsSeparator:"."},dateFormat:{short:"dd/MM/yyyy",medium:"d. MMM yyyy",long:"d. MMMM yyyy"}},{locale:"en-US",name:"English",nativeName:"English",direction:"ltr",numberFormat:{decimalSeparator:".",thousandsSeparator:","},dateFormat:{short:"MM/dd/yyyy",medium:"MMM d, yyyy",long:"MMMM d, yyyy"}}];function xt(r){const e=ze.find(t=>t.locale===r);return e||(console.warn(`Locale config not found for ${r}, using da-DK`),ze[0])}function vt(r,e){const t=e?.locale||We.get(),n=e?.decimals??2,s=e?.useGrouping??!0,i=xt(t),a=r.toFixed(n).split(".");let l=a[0];const d=a[1];return s&&l.length>3&&(l=l.replace(/\B(?=(\d{3})+(?!\d))/g,i.numberFormat.thousandsSeparator)),n>0&&d?`${l}${i.numberFormat.decimalSeparator}${d}`:l}async function bt(r){const e=r||We.get();try{const t=await ye(Object.assign({"../../locales/da-DK/contexts.json":()=>J(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>J(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${e}/contexts.json`,5),n=t.default||t;return{locale:e,names:n.names?.male.concat(n.names?.female||[]).concat(n.names?.neutral||[])||[],places:n.places?.cities.concat(n.places?.locations||[])||[],currency:n.currency||{symbol:"kr",name:"kroner"},items:n.items||{}}}catch(t){return console.error(`Failed to load context pool for locale ${e}:`,t),{locale:e,names:[],places:[],currency:{symbol:"kr",name:"kroner"},items:{}}}}class Xe{locale;contextPool=null;usageTrackers=new Map;defaultMaxRecent;constructor(e,t=10){this.locale=e,this.defaultMaxRecent=t}async loadContextPool(){this.contextPool=await bt(this.locale)}getTracker(e){return this.usageTrackers.has(e)||this.usageTrackers.set(e,{category:e,recentlyUsed:[],maxRecentSize:this.defaultMaxRecent}),this.usageTrackers.get(e)}markAsUsed(e,t){const n=this.getTracker(e),s=n.recentlyUsed.indexOf(t);s>-1&&n.recentlyUsed.splice(s,1),n.recentlyUsed.unshift(t),n.recentlyUsed.length>n.maxRecentSize&&(n.recentlyUsed=n.recentlyUsed.slice(0,n.maxRecentSize))}getAvailableItems(e,t){const n=this.getTracker(e),s=t.filter(i=>!n.recentlyUsed.includes(i));return s.length===0?(n.recentlyUsed=[],t):s}async selectName(e){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const t=await ye(Object.assign({"../../locales/da-DK/contexts.json":()=>J(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>J(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),n=t.default||t;let s=[],i="names";if(e?(s=n.names?.[e]||[],i=`names:${e}`):s=[...n.names?.male||[],...n.names?.female||[],...n.names?.neutral||[]],s.length===0)throw new Error(`No names available for gender: ${e||"any"}`);const a=this.getAvailableItems(i,s),l=a[Math.floor(Math.random()*a.length)];return this.markAsUsed(i,l),l}async selectNames(e=1,t){const n=[];for(let s=0;s<e;s++)n.push(await this.selectName(t));return n}async selectPlace(e){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const t=await ye(Object.assign({"../../locales/da-DK/contexts.json":()=>J(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>J(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),n=t.default||t;let s=[],i="places";if(e?(s=n.places?.[e]||[],i=`places:${e}`):s=[...n.places?.cities||[],...n.places?.locations||[],...n.places?.neighborhoods||[]],s.length===0)throw new Error(`No places available for type: ${e||"any"}`);const a=this.getAvailableItems(i,s),l=a[Math.floor(Math.random()*a.length)];return this.markAsUsed(i,l),l}async selectItems(e,t=1){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const n=await ye(Object.assign({"../../locales/da-DK/contexts.json":()=>J(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>J(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),i=(n.default||n).items?.[e]||[];if(i.length===0)throw new Error(`No items available for category: ${e}`);const a=`items:${e}`,d=[...this.getAvailableItems(a,i)].sort(()=>Math.random()-.5),u=d.slice(0,Math.min(t,d.length));return u.forEach(h=>this.markAsUsed(a,h)),u}async selectScenario(e){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const t=await ye(Object.assign({"../../locales/da-DK/contexts.json":()=>J(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>J(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),s=(t.default||t).scenarios?.[e]||[];if(s.length===0)throw new Error(`No scenarios available for category: ${e}`);const i=`scenarios:${e}`,a=this.getAvailableItems(i,s),l=a[Math.floor(Math.random()*a.length)];return this.markAsUsed(i,l),l}async selectActivityVerb(){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const e=await ye(Object.assign({"../../locales/da-DK/contexts.json":()=>J(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>J(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),n=(e.default||e).activities?.verbs||[];if(n.length===0)throw new Error("No activity verbs available");const s="activities:verbs",i=this.getAvailableItems(s,n),a=i[Math.floor(Math.random()*i.length)];return this.markAsUsed(s,a),a}getCurrency(){if(!this.contextPool)throw new Error("Context pool not loaded. Call loadContextPool() first.");return this.contextPool.currency}resetUsageTracking(){this.usageTrackers.clear()}resetCategoryTracking(e){this.usageTrackers.delete(e)}getUsageStats(){const e={};for(const[t,n]of this.usageTrackers.entries())e[t]={total:n.recentlyUsed.length,available:n.maxRecentSize-n.recentlyUsed.length};return e}}class me extends Error{constructor(e,t,n){super(`Parameter generation failed for '${t}': ${e}`),this.parameterName=t,this.cause=n,this.name="ParameterGenerationError"}}class xe extends Error{constructor(e,t,n){super(`Constraint violation for '${t}' (value: ${n}): ${e}`),this.parameterName=t,this.value=n,this.name="ConstraintViolationError"}}const $t={maxAttempts:100,seed:Date.now()};class Te{state;constructor(e){this.state=e>>>0||1}next(){let e=this.state+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}nextInt(e,t){if(!Number.isInteger(e)||!Number.isInteger(t))throw new Error("nextInt requires integer bounds");if(e>t)throw new Error("min must be less than or equal to max");return Math.floor(this.next()*(t-e+1))+e}nextFloat(e,t){if(e>=t)throw new Error("min must be less than max");return this.next()*(t-e)+e}choice(e){if(e.length===0)throw new Error("Cannot select from empty array");return e[Math.floor(this.next()*e.length)]}shuffle(e){const t=[...e];for(let n=t.length-1;n>0;n--){const s=Math.floor(this.next()*(n+1));[t[n],t[s]]=[t[s],t[n]]}return t}}class wt{rng;config;constructor(e={}){this.config={...$t,...e},this.rng=new Te(this.config.seed)}generate(e){const t=this.computeGenerationOrder(e);for(let n=0;n<this.config.maxAttempts;n++)try{const s={};for(const i of t){const a=e[i],l=this.generateParameter(i,a,s);s[i]=l}return this.validateParameters(s,e),s}catch(s){if(n===this.config.maxAttempts-1)throw s instanceof xe?new me(`Failed to generate valid parameters after ${this.config.maxAttempts} attempts`,s.parameterName,s):s;continue}throw new me(`Failed to generate parameters after ${this.config.maxAttempts} attempts`,"unknown")}validate(e,t,n,s={}){if(!this.validateType(t,n.type))throw new xe(`Expected type ${n.type} but got ${typeof t}`,e,t);if(n.type==="integer"||n.type==="decimal"){const i=t;if(n.min!==void 0&&i<n.min)throw new xe(`Value ${i} is less than minimum ${n.min}`,e,t);if(n.max!==void 0&&i>n.max)throw new xe(`Value ${i} is greater than maximum ${n.max}`,e,t);if(n.step!==void 0&&n.min!==void 0){const a=(i-n.min)/n.step;if(!Number.isInteger(a))throw new xe(`Value ${i} does not match step ${n.step} from minimum ${n.min}`,e,t)}}if(n.options&&n.options.length>0&&!n.options.includes(t))throw new xe(`Value is not in allowed options: ${JSON.stringify(n.options)}`,e,t);if(n.constraint){const i={...s,[e]:t};if(!n.constraint(i))throw new xe("Custom constraint function returned false",e,t)}}getRNG(){return this.rng}resetSeed(e){this.rng=new Te(e),this.config.seed=e}generateParameter(e,t,n){try{if(t.options&&t.options.length>0)return this.rng.choice(t.options);switch(t.type){case"integer":return this.generateInteger(t);case"decimal":return this.generateDecimal(t);case"fraction":return this.generateFraction(t);case"string":return this.generateString(t);default:throw new me(`Unknown parameter type: ${t.type}`,e)}}catch(s){throw s instanceof me?s:new me(`Failed to generate parameter: ${s instanceof Error?s.message:String(s)}`,e,s)}}generateInteger(e){const t=e.min??0,n=e.max??100,s=e.step??1,i=Math.floor((n-t)/s),a=this.rng.nextInt(0,i);return t+a*s}generateDecimal(e){const t=e.min??0,n=e.max??100,s=e.step;if(s!==void 0){const i=Math.floor((n-t)/s),a=this.rng.nextInt(0,i);return Number((t+a*s).toFixed(10))}return Number(this.rng.nextFloat(t,n).toFixed(2))}generateFraction(e){const t=e.min??1,n=e.max??10,s=this.rng.nextInt(t,n),i=this.rng.nextInt(t,n);return`${s}/${i===0?1:i}`}generateString(e){if(!e.options||e.options.length===0)throw new Error("String parameters must have options defined");return this.rng.choice(e.options)}validateType(e,t){switch(t){case"integer":return typeof e=="number"&&Number.isInteger(e);case"decimal":return typeof e=="number";case"fraction":return typeof e=="string"&&/^\d+\/\d+$/.test(e);case"string":return typeof e=="string";default:return!1}}computeGenerationOrder(e){const t=Object.keys(e),n=new Set,s=new Set,i=[],a=l=>{if(n.has(l))return;if(s.has(l))throw new me("Circular dependency detected",l);s.add(l);const d=e[l];if(d.dependsOn)for(const u of d.dependsOn){if(!e[u])throw new me(`Depends on undefined parameter: ${u}`,l);a(u)}s.delete(l),n.add(l),i.push(l)};for(const l of t)a(l);return i}validateParameters(e,t){for(const[n,s]of Object.entries(t)){const i=e[n];this.validate(n,i,s,e)}}}const yt={srsBaseline:1,bindingBonus:.3,recencyPenalty:.5,masteryAdjustment:0};class W extends Error{constructor(e,t,n){super(`Template validation failed for '${t}': ${e}`),this.templateId=t,this.field=n,this.name="TemplateValidationError"}}class _t{templates=new Map;competencyIndex=new Map;skillsIndex=new Map;gradeIndex=new Map;difficultyIndex=new Map;bindingIndex=new Map;tagIndex=new Map;recentlyUsed=[];maxRecentSize=20;register(e){if(this.validateTemplate(e),this.templates.has(e.id))throw new W("Template ID already registered",e.id,"id");const t={template:e,weight:1,lastUsed:void 0,usageCount:0};this.templates.set(e.id,t),this.indexTemplate(e.id,e.metadata)}unregister(e){const t=this.templates.get(e);return t?(this.deindexTemplate(e,t.template.metadata),this.templates.delete(e),this.recentlyUsed=this.recentlyUsed.filter(n=>n!==e),!0):!1}get(e){return this.templates.get(e)?.template}has(e){return this.templates.has(e)}count(){return this.templates.size}find(e){let t=new Set(this.templates.keys());return e.competencyAreaId!==void 0&&(t=this.intersect(t,this.competencyIndex.get(e.competencyAreaId))),e.skillsAreaId!==void 0&&(t=this.intersect(t,this.skillsIndex.get(e.skillsAreaId))),e.gradeRange!==void 0&&(t=this.intersect(t,this.gradeIndex.get(e.gradeRange))),e.difficulty!==void 0&&(t=this.intersect(t,this.difficultyIndex.get(e.difficulty))),e.isBinding!==void 0&&(t=this.intersect(t,this.bindingIndex.get(e.isBinding))),e.tags&&e.tags.length>0&&(t=new Set(Array.from(t).filter(n=>{const s=this.templates.get(n);return s?e.tags.every(i=>s.template.metadata.tags.includes(i)):!1}))),e.excludeTemplateIds&&e.excludeTemplateIds.length>0&&e.excludeTemplateIds.forEach(n=>t.delete(n)),Array.from(t)}select(e,t={},n=50){const s=this.find(e);if(s.length===0)return;if(s.length===1)return s[0];const i={...yt,...t},a=s.map(l=>({id:l,weight:this.calculateWeight(l,i,n)}));return this.weightedRandomSelect(a)}markUsed(e){const t=this.templates.get(e);t&&(t.lastUsed=new Date,t.usageCount+=1,this.recentlyUsed.push(e),this.recentlyUsed.length>this.maxRecentSize&&this.recentlyUsed.shift())}getRecentlyUsed(){return[...this.recentlyUsed].reverse()}clearRecentlyUsed(){this.recentlyUsed=[]}getUsageStats(e){const t=this.templates.get(e);if(t)return{usageCount:t.usageCount,lastUsed:t.lastUsed}}validateTemplate(e){if(!e.id||typeof e.id!="string"||e.id.trim()==="")throw new W("Template ID is required and must be a non-empty string",e.id||"unknown","id");if(!e.name||typeof e.name!="string"||e.name.trim()==="")throw new W("Template name is required and must be a non-empty string",e.id,"name");if(!e.metadata)throw new W("Template metadata is required",e.id,"metadata");if(this.validateMetadata(e.id,e.metadata),!e.parameters||typeof e.parameters!="object")throw new W("Template parameters must be an object",e.id,"parameters");if(typeof e.generate!="function")throw new W("Template generate must be a function",e.id,"generate");if(typeof e.validate!="function")throw new W("Template validate must be a function",e.id,"validate");if(!Array.isArray(e.hints))throw new W("Template hints must be an array",e.id,"hints");if(e.hints.length<4)throw new W("Template must provide at least 4 hint levels",e.id,"hints");e.hints.forEach((t,n)=>{if(typeof t!="function")throw new W(`Hint at index ${n} must be a function`,e.id,`hints[${n}]`)})}validateMetadata(e,t){if(!["matematiske-kompetencer","tal-og-algebra","geometri-og-maling","statistik-og-sandsynlighed"].includes(t.competencyAreaId))throw new W(`Invalid competency area ID: ${t.competencyAreaId}`,e,"metadata.competencyAreaId");if(!t.skillsAreaId||typeof t.skillsAreaId!="string")throw new W("Skills area ID is required and must be a string",e,"metadata.skillsAreaId");if(!["0-3","4-6","7-9"].includes(t.gradeRange))throw new W(`Invalid grade range: ${t.gradeRange}`,e,"metadata.gradeRange");if(!["A","B","C"].includes(t.difficulty))throw new W(`Invalid difficulty: ${t.difficulty}`,e,"metadata.difficulty");if(typeof t.isBinding!="boolean")throw new W("isBinding must be a boolean",e,"metadata.isBinding");if(!Array.isArray(t.tags))throw new W("Tags must be an array",e,"metadata.tags");t.tags.forEach((a,l)=>{if(typeof a!="string")throw new W(`Tag at index ${l} must be a string`,e,`metadata.tags[${l}]`)})}indexTemplate(e,t){this.addToIndex(this.competencyIndex,t.competencyAreaId,e),this.addToIndex(this.skillsIndex,t.skillsAreaId,e),this.addToIndex(this.gradeIndex,t.gradeRange,e),this.addToIndex(this.difficultyIndex,t.difficulty,e),this.addToIndex(this.bindingIndex,t.isBinding,e),t.tags.forEach(n=>{this.addToIndex(this.tagIndex,n,e)})}deindexTemplate(e,t){this.removeFromIndex(this.competencyIndex,t.competencyAreaId,e),this.removeFromIndex(this.skillsIndex,t.skillsAreaId,e),this.removeFromIndex(this.gradeIndex,t.gradeRange,e),this.removeFromIndex(this.difficultyIndex,t.difficulty,e),this.removeFromIndex(this.bindingIndex,t.isBinding,e),t.tags.forEach(n=>{this.removeFromIndex(this.tagIndex,n,e)})}addToIndex(e,t,n){let s=e.get(t);s||(s=new Set,e.set(t,s)),s.add(n)}removeFromIndex(e,t,n){const s=e.get(t);s&&(s.delete(n),s.size===0&&e.delete(t))}intersect(e,t){return t?new Set(Array.from(e).filter(n=>t.has(n))):new Set}calculateWeight(e,t,n){const s=this.templates.get(e);if(!s)return 0;let i=t.srsBaseline;s.template.metadata.isBinding&&(i+=t.bindingBonus);const a=this.recentlyUsed.indexOf(e);if(a!==-1){const g=(this.recentlyUsed.length-a)/this.recentlyUsed.length;i-=t.recencyPenalty*g}const d={A:1,B:2,C:3}[s.template.metadata.difficulty],u=1+n/50,h=Math.abs(d-u);return i-=t.masteryAdjustment*h,Math.max(0,i)}weightedRandomSelect(e){const t=e.reduce((s,i)=>s+i.weight,0);if(t<=0)return e[Math.floor(Math.random()*e.length)].id;let n=Math.random()*t;for(const s of e)if(n-=s.weight,n<=0)return s.id;return e[e.length-1].id}}const Pe=new _t;function pt(r,e={}){const{count:t=3,strategies:n,seed:s=Date.now(),excludeValues:i=[]}=e,a=new Te(s),l=new Set,d=typeof r.value=="number"?r.value:parseFloat(r.value.toString()),u=new Set([r.value.toString(),...i.map(E=>E.toString())]);r.equivalents&&r.equivalents.forEach(E=>u.add(E.toString()));const h=n||["off-by-one","wrong-operation","sign-error","place-value","factor-multiple"];let g=0;const S=t*10;for(;l.size<t&&g<S;){g++;const E=a.choice(h),R=St(d,E,a).toString();u.has(R)||l.has(R)||l.add(R)}for(;l.size<t&&g<S;){g++;const E=a.nextInt(-10,10);if(E===0)continue;const R=(d+E).toString();!u.has(R)&&!l.has(R)&&l.add(R)}return Array.from(l)}function St(r,e,t){switch(e){case"off-by-one":return kt(r,t);case"wrong-operation":return Ct(r,t);case"sign-error":return At(r);case"place-value":return It(r,t);case"factor-multiple":return Tt(r,t);case"common-mistake":return Et(r,t);default:return r+t.nextInt(-5,5)}}function kt(r,e){return r+(e.next()<.5?1:-1)}function Ct(r,e){const t=e.nextInt(2,5);return e.next()<.5?r*t:Math.floor(r/t)}function At(r){return-r}function It(r,e){const t=e.next()<.5?10:.1;return r*t}function Tt(r,e){if(r<=1)return r*2;const t=[2,3,4,5],n=e.choice(t);return e.next()<.5?r*n:Math.floor(r/n)}function Et(r,e){const t=[()=>Math.floor(r/10)*10,()=>Math.floor(r/100)*100,()=>r+Math.floor(r*.1),()=>r-Math.floor(r*.1)];return e.choice(t)()}function Mt(r,e={}){const{count:t=3,seed:n=Date.now(),excludeValues:s=[]}=e,i=new Te(n),a=new Set,d=r.value.toString().match(/^(\d+)\/(\d+)$/);if(!d)return[];const[,u,h]=d,g=parseInt(u,10),S=parseInt(h,10),E=new Set([r.value.toString(),...s.map(m=>m.toString())]);r.equivalents&&r.equivalents.forEach(m=>E.add(m.toString()));const P=[()=>`${S}/${g}`,()=>`${g+1}/${S}`,()=>`${g-1}/${S}`,()=>`${g}/${S+1}`,()=>`${g}/${S-1}`,()=>{const m=i.nextInt(2,4);return`${g*m}/${S*m+1}`},()=>{const m=i.nextInt(2,3);return`${Math.floor(g/m)}/${Math.floor(S/m)}`}];let R=0;const j=t*10;for(;a.size<t&&R<j;){R++;const b=i.choice(P)();b.match(/^\d+\/\d+$/)&&!E.has(b)&&!a.has(b)&&a.add(b)}return Array.from(a)}function Dt(r,e={}){const{count:t=3,seed:n=Date.now(),excludeValues:s=[],alternatives:i=[]}=e,a=new Te(n),l=new Set,d=new Set([r.value.toString(),...s.map(u=>u.toString())]);if(r.equivalents&&r.equivalents.forEach(u=>d.add(u.toString())),i.length>0){const u=a.shuffle(i);for(const h of u){if(l.size>=t)break;d.has(h)||l.add(h)}}return Array.from(l)}function Pt(r,e={}){const t=r.value;return typeof t=="number"?pt(r,e):typeof t=="string"?t.match(/^\d+\/\d+$/)?Mt(r,e):Dt(r,e):[]}class Re extends Error{constructor(e,t,n,s){super(`Instance generation failed for template '${t}' with seed ${n}: ${e}`),this.templateId=t,this.seed=n,this.cause=s,this.name="InstanceGenerationError"}}async function Rt(r,e,t={}){const{locale:n="da-DK",contextSelector:s,includeDistractors:i=!0,distractorCount:a=3}=t,l=Pe.get(r);if(!l)throw new Re("Template not found in registry",r,e);try{const u=new wt({seed:e}).generate(l.parameters),h=s||new Xe(n),g={locale:n,contextType:l.contextType};if(l.contextType&&l.contextType!=="abstract")try{g.names=await h.selectNames(2),g.places=await h.selectPlace();const b={shopping:"food",school:"school",nature:"animals",sports:"sports"}[l.contextType];b&&(g.items=await h.selectItems(b,3))}catch(m){console.warn(`Context selection failed for template ${r}:`,m)}const S=l.generate(u,n),E=Ft(S.questionText,u,n,g),P=l.hints.map((m,b)=>{const $=m(u,n);return typeof $=="string"?{level:b+1,text:$,visualAid:S.visualAid}:{level:b+1,...$}});let R;i&&(R=Pt(S.correctAnswer,{count:a,seed:e,excludeValues:[]}));const j=`${r}-${e}`;return Pe.markUsed(r),{id:j,templateId:r,questionText:E,correctAnswer:S.correctAnswer,distractors:R,hints:P,metadata:l.metadata,context:g,seed:e}}catch(d){throw new Re(d instanceof Error?d.message:String(d),r,e,d)}}async function Ut(r,e,t={}){const{startSeed:n=Date.now(),locale:s="da-DK",contextSelector:i,includeDistractors:a=!0,distractorCount:l=3}=t,d=new Array(e),u=i||new Xe(s);for(let h=0;h<e;h++){const g=Pe.select(r);if(!g)throw new Re("No templates found matching criteria","unknown",n+h);const S=n+h,E=await Rt(g,S,{locale:s,contextSelector:u,includeDistractors:a,distractorCount:l});d[h]=E}return d}function Ft(r,e,t,n){let s=r;if(n.names&&n.names.length>0&&(n.names.forEach((a,l)=>{s=s.replace(new RegExp(`\\{\\{context\\.names\\[${l}\\]\\}\\}`,"g"),a)}),s=s.replace(/\{\{context\.name\}\}/g,n.names[0])),n.places){const a=Array.isArray(n.places)?n.places[0]:n.places;s=s.replace(/\{\{context\.place\}\}/g,a)}n.items&&n.items.length>0&&(n.items.forEach((a,l)=>{s=s.replace(new RegExp(`\\{\\{context\\.items\\[${l}\\]\\}\\}`,"g"),a)}),s=s.replace(/\{\{context\.item\}\}/g,n.items[0]));const i=/\{\{([^:}]+)(?::([^}]+))?\}\}/g;return s=s.replace(i,(a,l,d)=>{const u=e[l];return u===void 0?(console.warn(`Parameter ${l} not found in params`),a):d==="number"&&typeof u=="number"?vt(u,t):String(u)}),s}var jt=v('<div class="mb-8 p-4 bg-blue-50 border border-blue-200 rounded-lg"role=status aria-live=polite><p class="text-blue-800 text-sm">'),Lt=v('<div><div class=mb-8><h1 class="text-3xl font-bold text-gray-900 mb-2"></h1><p class="text-lg text-gray-600"></p></div><!$><!/><div class=mb-8><label id=difficulty-label class="block text-lg font-semibold text-gray-800 mb-4"></label><div role=radiogroup aria-labelledby=difficulty-label class=space-y-3></div></div><div class=mb-8><label id=count-label class="block text-lg font-semibold text-gray-800 mb-4"></label><div role=radiogroup aria-labelledby=count-label class=space-y-3></div></div><div class=mt-8><button type=button class="w-full py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold text-lg rounded-lg transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-md hover:shadow-lg">'),qe=v('<div class="w-full h-full rounded-full bg-white scale-40">'),Ne=v('<button type=button role=radio><div class="flex items-start"><div aria-hidden=true></div><div class=flex-1><div class="font-semibold text-gray-900 mb-1"></div><div class="text-sm text-gray-600">');function Vt(r){const e=ue(ge),[t,n]=G(r.isFirstTime?"A":"Auto"),[s,i]=G(20),a=()=>{r.onStart({difficulty:t(),exerciseCount:s()})},l=[{value:"Auto",key:"auto"},{value:"A",key:"a"},{value:"B",key:"b"},{value:"C",key:"c"}],d=[{value:10,key:"10"},{value:20,key:"20"},{value:30,key:"30"}];return(()=>{var u=f(Lt),h=u.firstChild,g=h.firstChild,S=g.nextSibling,E=h.nextSibling,[P,R]=D(E.nextSibling),j=P.nextSibling,m=j.firstChild,b=m.nextSibling,$=j.nextSibling,I=$.firstChild,k=I.nextSibling,x=$.nextSibling,F=x.firstChild;return o(g,()=>e()("exercises.session.setup.title")),o(S,()=>e()("exercises.session.setup.subtitle")),o(u,c(U,{get when(){return r.isFirstTime},get children(){var T=f(jt),C=T.firstChild;return o(C,()=>e()("exercises.session.setup.firstTimeNotice")),T}}),P,R),o(m,()=>e()("exercises.session.setup.difficulty.label")),o(b,()=>l.map(T=>{const C=()=>t()===T.value;return(()=>{var M=f(Ne),V=M.firstChild,O=V.firstChild,B=O.nextSibling,q=B.firstChild,w=q.nextSibling;return M.$$click=()=>n(T.value),o(O,c(U,{get when(){return C()},get children(){return f(qe)}})),o(q,()=>e()(`exercises.session.setup.difficulty.${T.key}`)),o(w,()=>e()(`exercises.session.setup.difficulty.${T.key}Description`)),z(y=>{var _=C(),L=`
                  w-full text-left p-4 rounded-lg border-2 transition-all
                  min-h-[44px] cursor-pointer
                  ${C()?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 bg-white hover:border-blue-300 hover:bg-blue-50"}
                  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
                `,H=`
                      flex-shrink-0 w-5 h-5 rounded-full border-2 mt-0.5 mr-3
                      ${C()?"border-blue-500 bg-blue-500":"border-gray-400 bg-white"}
                    `;return _!==y.e&&p(M,"aria-checked",y.e=_),L!==y.t&&ee(M,y.t=L),H!==y.a&&ee(O,y.a=H),y},{e:void 0,t:void 0,a:void 0}),Y(),M})()})),o(I,()=>e()("exercises.session.setup.exerciseCount.label")),o(k,()=>d.map(T=>{const C=()=>s()===T.value;return(()=>{var M=f(Ne),V=M.firstChild,O=V.firstChild,B=O.nextSibling,q=B.firstChild,w=q.nextSibling;return M.$$click=()=>i(T.value),o(O,c(U,{get when(){return C()},get children(){return f(qe)}})),o(q,()=>e()(`exercises.session.setup.exerciseCount.${T.key}`)),o(w,()=>e()(`exercises.session.setup.exerciseCount.${T.key}Description`)),z(y=>{var _=C(),L=`
                  w-full text-left p-4 rounded-lg border-2 transition-all
                  min-h-[44px] cursor-pointer
                  ${C()?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 bg-white hover:border-blue-300 hover:bg-blue-50"}
                  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
                `,H=`
                      flex-shrink-0 w-5 h-5 rounded-full border-2 mt-0.5 mr-3
                      ${C()?"border-blue-500 bg-blue-500":"border-gray-400 bg-white"}
                    `;return _!==y.e&&p(M,"aria-checked",y.e=_),L!==y.t&&ee(M,y.t=L),H!==y.a&&ee(O,y.a=H),y},{e:void 0,t:void 0,a:void 0}),Y(),M})()})),F.$$click=a,o(F,()=>e()("exercises.session.setup.startButton")),z(()=>ee(u,`session-setup ${r.class||""}`)),Y(),u})()}Se(["click"]);function Bt(r,e){return{revealNext(){let t=null;return e(n=>n>=r.length?n:(t=r[n],n+1)),t},reset(){e(0)},getRevealedHints(t){return r.slice(0,t)},areAllRevealed(t){return t>=r.length}}}var Ot=v("<div role=img>"),Ht=v('<div class="number-line-container p-4"><svg viewBox="0 0 540 120"class="w-full h-auto"role=img><line x1=20 y1=60 x2=520 y2=60 stroke=currentColor stroke-width=2 class=text-gray-700></line><!$><!/><!$><!/><defs><marker id=arrowhead markerWidth=10 markerHeight=7 refX=9 refY=3.5 orient=auto><polygon points="0 0, 10 3.5, 0 7"fill=currentColor>'),zt=v("<svg><line y1=55 y2=65 stroke=currentColor stroke-width=2 class=text-gray-700></svg>",!1,!0,!1),qt=v('<svg><text y=85 text-anchor=middle class="text-sm font-medium fill-gray-700"></svg>',!1,!0,!1),Nt=v("<svg><path fill=none stroke-width=2 marker-end=url(#arrowhead)></svg>",!1,!0,!1),Gt=v('<svg><text text-anchor=middle class="text-sm font-bold"><!$><!/><!$><!/></svg>',!1,!0,!1),Kt=v('<div class="p-4 bg-gray-100 rounded text-center text-gray-600"><p>Diagram type: <!$><!/></p><p class=text-sm>(Visualization coming soon)'),Wt=v('<div class="diagram-container p-4">'),Xt=v('<div class="place-value-diagram flex gap-4 justify-center items-end p-4">'),Qt=v('<div class="place-column flex flex-col items-center gap-2"><div class="text-sm font-bold text-gray-700 capitalize"></div><div class="blocks flex flex-col-reverse gap-1"></div><div class="text-lg font-bold text-gray-800">'),Jt=v('<div class="block w-16 h-16 rounded border-2 flex items-center justify-center font-bold text-lg">'),Yt=v('<svg viewBox="0 0 200 200"class="w-48 h-48 mx-auto"><circle cx=100 cy=100 r=90 fill=white stroke=currentColor stroke-width=2 class=text-gray-700></circle><!$><!/>'),Zt=v("<svg><line x1=100 y1=100 stroke=currentColor stroke-width=1 class=text-gray-700></svg>",!1,!0,!1),en=v('<svg><path fill="rgb(147, 51, 234)"opacity=0.7></svg>',!1,!0,!1),tn=v('<svg viewBox="0 0 200 80"class="w-full h-24 mx-auto"><rect x=0 y=10 width=200 height=60 fill=white stroke=currentColor stroke-width=2 class=text-gray-700></rect><!$><!/>'),nn=v("<svg><line y1=10 y2=70 stroke=currentColor stroke-width=1 class=text-gray-700></svg>",!1,!0,!1),rn=v('<svg><rect y=11 height=58 fill="rgb(147, 51, 234)"opacity=0.7></svg>',!1,!0,!1),sn=v('<div class="chart-container p-4 bg-gray-100 rounded text-center"><p class=text-gray-600><!$><!/>: <!$><!/></p><p class="text-sm text-gray-500">(Chart visualization coming soon)'),on=v('<div class="image-container p-4"><img class="max-w-full h-auto rounded shadow-md"loading=lazy>',!0,!1,!1);function Ue(r){const e=ue(ge);return(()=>{var t=f(Ot);return o(t,c(Fe,{get children(){return[c(te,{get when(){return r.visualAid.type==="number-line"},get children(){return c(ln,{get data(){return r.visualAid.data}})}}),c(te,{get when(){return r.visualAid.type==="diagram"},get children(){return c(an,{get data(){return r.visualAid.data}})}}),c(te,{get when(){return r.visualAid.type==="chart"},get children(){return c(hn,{get data(){return r.visualAid.data}})}}),c(te,{get when(){return r.visualAid.type==="image"},get children(){return c(fn,{get data(){return r.visualAid.data}})}})]}})),z(n=>{var s=`visual-aid ${r.class||""}`,i=e()("hints.common.visualAid");return s!==n.e&&ee(t,n.e=s),i!==n.t&&p(t,"aria-label",n.t=i),n},{e:void 0,t:void 0}),t})()}function ln(r){const e=ue(ge),[t,n]=r.data.range,s=n-t+1,i=500,a=h=>(h-t)/(n-t)*i,l=Array.from({length:s},(h,g)=>t+g);let d=r.data.start;const u=r.data.hops.map(h=>{const g=d;return d+=h,{start:g,end:d,value:h}});return(()=>{var h=f(Ht),g=h.firstChild,S=g.firstChild,E=S.nextSibling,[P,R]=D(E.nextSibling),j=P.nextSibling,[m,b]=D(j.nextSibling);return m.nextSibling,o(g,c(de,{each:l,children:$=>{const I=a($)+20;return[(()=>{var k=f(zt);return p(k,"x1",I),p(k,"x2",I),k})(),(()=>{var k=f(qt);return p(k,"x",I),o(k,$),k})()]}}),P,R),o(g,c(de,{each:u,children:($,I)=>{const k=a($.start)+20,x=a($.end)+20,F=35-I()*10,T=$.value>0;return[(()=>{var C=f(Nt);return p(C,"d",`M ${k} ${F} Q ${(k+x)/2} ${F-15} ${x} ${F}`),p(C,"stroke",T?"rgb(34, 197, 94)":"rgb(239, 68, 68)"),C})(),(()=>{var C=f(Gt),M=C.firstChild,[V,O]=D(M.nextSibling),B=V.nextSibling,[q,w]=D(B.nextSibling);return p(C,"x",(k+x)/2),p(C,"y",F-20),p(C,"fill",T?"rgb(34, 197, 94)":"rgb(239, 68, 68)"),o(C,T?"+":"",V,O),o(C,()=>$.value,q,w),C})()]}}),m,b),z(()=>p(g,"aria-label",e()("solutions.numberLine"))),h})()}function an(r){return(()=>{var e=f(Wt);return o(e,c(Fe,{get children(){return[c(te,{get when(){return r.data.diagramType==="place-value"},get children(){return c(cn,{get data(){return r.data}})}}),c(te,{get when(){return r.data.diagramType==="fraction"},get children(){return c(dn,{get data(){return r.data}})}}),c(te,{when:!0,get children(){var t=f(Kt),n=t.firstChild,s=n.firstChild,i=s.nextSibling,[a,l]=D(i.nextSibling);return o(n,()=>r.data.diagramType,a,l),t}})]}})),e})()}function cn(r){const e=r.data.breakdown,t=Object.entries(e).reverse();return(()=>{var n=f(Xt);return o(n,c(de,{each:t,children:([s,i])=>(()=>{var a=f(Qt),l=a.firstChild,d=l.nextSibling,u=d.nextSibling;return o(l,s),o(d,c(de,{get each(){return Array(i)},children:()=>(()=>{var h=f(Jt);return o(h,s==="hundreds"?"100":s==="tens"?"10":"1"),z(g=>_e(h,{"bg-blue-200 border-blue-500 text-blue-900":s==="hundreds","bg-green-200 border-green-500 text-green-900":s==="tens","bg-yellow-200 border-yellow-500 text-yellow-900":s==="ones"},g)),h})()})),o(u,i),a})()})),n})()}function dn(r){const e=r.data.numerator,t=r.data.denominator;return r.data.shapeType==="circle"?c(un,{numerator:e,denominator:t}):c(gn,{numerator:e,denominator:t})}function un(r){const e=360/r.denominator,t=Array.from({length:r.denominator},(n,s)=>s);return(()=>{var n=f(Yt),s=n.firstChild,i=s.nextSibling,[a,l]=D(i.nextSibling);return o(n,c(de,{each:t,children:d=>{const u=d*e-90,h=(d+1)*e-90,g=u*Math.PI/180,S=h*Math.PI/180,E=100+90*Math.cos(g),P=100+90*Math.sin(g),R=100+90*Math.cos(S),j=100+90*Math.sin(S);return[(()=>{var m=f(Zt);return p(m,"x2",E),p(m,"y2",P),m})(),c(U,{get when(){return d<r.numerator},get children(){var m=f(en);return p(m,"d",`M 100 100 L ${E} ${P} A 90 90 0 0 1 ${R} ${j} Z`),m}})]}}),a,l),n})()}function gn(r){const e=Array.from({length:r.denominator},(t,n)=>n);return 100/r.denominator,(()=>{var t=f(tn),n=t.firstChild,s=n.nextSibling,[i,a]=D(s.nextSibling);return o(t,c(de,{each:e,children:l=>{const d=l*200/r.denominator,u=200/r.denominator;return[c(U,{when:l>0,get children(){var h=f(nn);return p(h,"x1",d),p(h,"x2",d),h}}),c(U,{get when(){return l<r.numerator},get children(){var h=f(rn);return p(h,"x",d+1),p(h,"width",u-2),h}})]}}),i,a),t})()}function hn(r){const e=ue(ge);return(()=>{var t=f(sn),n=t.firstChild,s=n.firstChild,[i,a]=D(s.nextSibling),l=i.nextSibling,d=l.nextSibling,[u,h]=D(d.nextSibling);return o(n,()=>e()("solutions.chartType"),i,a),o(n,()=>r.data.chartType,u,h),t})()}function fn(r){return(()=>{var e=f(on),t=e.firstChild;return z(n=>{var s=r.data.src,i=r.data.alt,a=r.data.width,l=r.data.height;return s!==n.e&&p(t,"src",n.e=s),i!==n.t&&p(t,"alt",n.t=i),a!==n.a&&p(t,"width",n.a=a),l!==n.o&&p(t,"height",n.o=l),n},{e:void 0,t:void 0,a:void 0,o:void 0}),e})()}var mn=v('<div class="solution-visual-aid mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200"><div class="text-sm font-medium text-purple-900 mb-3"></div><!$><!/>'),xn=v('<div role=region><div class="worked-solution-header mb-4 pb-3 border-b-2 border-purple-300"><h3 class="text-lg font-bold text-purple-900 flex items-center gap-2"><svg class="w-6 h-6"fill=none stroke=currentColor viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span></span></h3></div><div class="solution-steps space-y-4 mb-6"role=list></div><!$><!/><div class="final-answer p-4 rounded-lg bg-gradient-to-r from-green-100 to-green-200 border-2 border-green-400 shadow-md"role=status><div class="flex items-center gap-3"><svg class="w-8 h-8 text-green-700"fill=none stroke=currentColor viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-green-800 uppercase tracking-wide mb-1"></div><div class="text-xl font-bold text-green-900">'),vn=v('<div class="step-visual-aid mt-3">'),bn=v('<div class="solution-step p-4 rounded-lg bg-gradient-to-r from-purple-50 to-purple-100 border border-purple-200 shadow-sm transition-all duration-200 hover:shadow-md"role=listitem><div class="flex items-start gap-4"><div class="step-number flex-shrink-0 w-8 h-8 rounded-full bg-purple-600 text-white flex items-center justify-center font-bold text-sm shadow"aria-hidden=true></div><div class="step-content flex-1"><div class="step-explanation text-gray-700 font-medium mb-2"></div><div class="step-expression p-3 bg-white rounded border border-purple-200 font-mono text-lg text-purple-900 shadow-sm"></div><!$><!/>');function Qe(r){const e=ue(ge);return c(U,{get when(){return r.show!==!1},get children(){var t=f(xn),n=t.firstChild,s=n.firstChild,i=s.firstChild,a=i.nextSibling,l=n.nextSibling,d=l.nextSibling,[u,h]=D(d.nextSibling),g=u.nextSibling,S=g.firstChild,E=S.firstChild,P=E.nextSibling,R=P.firstChild,j=R.nextSibling;return o(a,()=>e()("solutions.stepByStepSolution")),o(l,c(de,{get each(){return r.solution.steps},children:(m,b)=>(()=>{var $=f(bn),I=$.firstChild,k=I.firstChild,x=k.nextSibling,F=x.firstChild,T=F.nextSibling,C=T.nextSibling,[M,V]=D(C.nextSibling);return o(k,()=>b()+1),o(F,()=>m.explanation),o(T,()=>m.expression),o(x,c(U,{get when(){return m.visualAid},get children(){var O=f(vn);return o(O,c(Ue,{get visualAid(){return m.visualAid}})),O}}),M,V),z(()=>p($,"aria-label",`${e()("solutions.step")} ${b()+1}`)),$})()})),o(t,c(U,{get when(){return r.solution.visualAid},get children(){var m=f(mn),b=m.firstChild,$=b.nextSibling,[I,k]=D($.nextSibling);return o(b,()=>e()("solutions.overallVisualization")),o(m,c(Ue,{get visualAid(){return r.solution.visualAid}}),I,k),m}}),u,h),o(R,()=>e()("solutions.finalAnswer")),o(j,()=>r.solution.finalAnswer),z(m=>{var b=`worked-solution-container ${r.class||""}`,$=e()("solutions.workedSolutionLabel"),I=e()("solutions.solutionSteps"),k=e()("solutions.finalAnswer");return b!==m.e&&ee(t,m.e=b),$!==m.t&&p(t,"aria-label",m.t=$),I!==m.a&&p(l,"aria-label",m.a=I),k!==m.o&&p(g,"aria-label",m.o=k),m},{e:void 0,t:void 0,a:void 0,o:void 0}),t}})}var $n=v('<span class="flex items-center gap-2"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg><span>'),wn=v('<div class="hint-progress mt-2 text-sm text-gray-600"aria-live=polite>'),yn=v('<div class="revealed-hints space-y-4"role=list>'),_n=v('<div class=hint-system role=region><div class="hint-button-container mb-4"><button type=button class="hint-button px-6 py-3 rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2"style=min-width:44px;min-height:44px></button><!$><!/></div><!$><!/>'),pn=v('<span class="flex items-center gap-2"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M5 13l4 4L19 7"></path></svg><span>'),Sn=v('<div class="hint-visual-aid mt-3 p-3 bg-white rounded border border-gray-200"role=img><div class="text-sm text-gray-600 mb-2 font-medium"></div><div class="text-xs text-gray-500">Type: <!$><!/>'),kn=v('<div class="worked-solution-wrapper mt-4">'),Cn=v('<div class="hint-item p-4 rounded-lg border-l-4 transition-all duration-300 animate-fade-in"role=listitem><div class="flex items-start gap-3"><div class="hint-level-badge flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm"aria-hidden=true></div><div class="hint-content flex-1"><div class="hint-text text-gray-800 leading-relaxed whitespace-pre-line"></div><!$><!/><!$><!/>');function An(r){const e=ue(ge),[t,n]=G(0),s=Bt(r.hints,n);Ke(()=>{r.resetKey,s.reset()});const i=()=>{const u=s.revealNext();u&&r.onHintRequested(u.level)},a=()=>s.getRevealedHints(t()),l=()=>s.areAllRevealed(t()),d=()=>r.hints.length;return(()=>{var u=f(_n),h=u.firstChild,g=h.firstChild,S=g.nextSibling,[E,P]=D(S.nextSibling),R=h.nextSibling,[j,m]=D(R.nextSibling);return g.$$click=i,o(g,c(U,{get when(){return!l()},get fallback(){return(()=>{var b=f(pn),$=b.firstChild,I=$.nextSibling;return o(I,()=>e()("hints.common.allHintsShown")),b})()},get children(){var b=f($n),$=b.firstChild,I=$.nextSibling;return o(I,(()=>{var k=pe(()=>t()===0);return()=>k()?e()("hints.common.getHint"):e()("hints.common.getNextHint")})()),b}})),o(h,c(U,{get when(){return t()>0},get children(){var b=f(wn);return o(b,()=>e()("hints.common.hintProgress",{current:t().toString(),total:d().toString()})),b}}),E,P),o(u,c(U,{get when(){return t()>0},get children(){var b=f(yn);return o(b,c(de,{get each(){return a()},children:$=>(()=>{var I=f(Cn),k=I.firstChild,x=k.firstChild,F=x.nextSibling,T=F.firstChild,C=T.nextSibling,[M,V]=D(C.nextSibling),O=M.nextSibling,[B,q]=D(O.nextSibling);return o(x,()=>$.level),o(T,()=>$.text),o(F,c(U,{get when(){return $.visualAid},get children(){var w=f(Sn),y=w.firstChild,_=y.nextSibling,L=_.firstChild,H=L.nextSibling,[ne,re]=D(H.nextSibling);return o(y,()=>e()("hints.common.visualAid")),o(_,()=>$.visualAid?.type,ne,re),z(()=>p(w,"aria-label",e()("hints.common.visualAid"))),w}}),M,V),o(F,c(U,{get when(){return $.workedSolution},get children(){var w=f(kn);return o(w,c(Qe,{get solution(){return $.workedSolution}})),w}}),B,q),z(w=>{var y={"bg-blue-50 border-blue-500":$.level===1,"bg-green-50 border-green-500":$.level===2,"bg-yellow-50 border-yellow-500":$.level===3,"bg-purple-50 border-purple-500":$.level===4},_=`${e()("hints.common.hintLevel")} ${$.level}`,L={"bg-blue-600 text-white":$.level===1,"bg-green-600 text-white":$.level===2,"bg-yellow-600 text-white":$.level===3,"bg-purple-600 text-white":$.level===4};return w.e=_e(I,y,w.e),_!==w.t&&p(I,"aria-label",w.t=_),w.a=_e(x,L,w.a),w},{e:void 0,t:void 0,a:void 0}),I})()})),z(()=>p(b,"aria-label",e()("hints.common.revealedHints"))),b}}),j,m),z(b=>{var $=e()("hints.common.hintProgress",{current:t().toString(),total:d().toString()}),I={"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":!l()&&!r.disabled,"bg-gray-300 text-gray-500 cursor-not-allowed":l()||r.disabled},k=l()||r.disabled,x=l()?e()("hints.common.allHintsShown"):`${e()("hints.common.hintProgress",{current:(t()+1).toString(),total:d().toString()})}`;return $!==b.e&&p(u,"aria-label",b.e=$),b.t=_e(g,I,b.t),k!==b.a&&Me(g,"disabled",b.a=k),x!==b.o&&p(g,"aria-label",b.o=x),b},{e:void 0,t:void 0,a:void 0,o:void 0}),Y(),u})()}Se(["click"]);var In=v('<svg class="w-8 h-8 text-green-600"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z">'),Tn=v('<p class="text-base font-semibold text-orange-900 mt-2">'),En=v('<div class="visual-aid-section mb-6 p-4 bg-white rounded-lg border-2 border-gray-200 shadow-sm"><div class="text-sm font-medium text-gray-700 mb-3"></div><!$><!/>'),Mn=v('<div class="p-4 bg-white rounded-lg border-2 border-purple-200 shadow-sm">'),Dn=v('<div class="worked-solution-section mb-6"><button class="mb-4 px-5 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all flex items-center gap-2"aria-controls=worked-solution-content style=min-width:44px;min-height:44px><svg class="w-5 h-5 transition-transform duration-200"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M19 9l-7 7-7-7"></path></svg><span></span></button><div id=worked-solution-content>'),Pn=v('<button class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all"style=min-width:44px;min-height:44px>'),Rn=v('<div role=alert aria-live=polite aria-atomic=true><div class=feedback-content><div class="feedback-header flex items-start gap-4 mb-4"><div class=flex-shrink-0></div><div class=flex-1><h4 class="text-lg font-bold mb-2"></h4><p class="text-base mb-3"></p><!$><!/></div></div><!$><!/><!$><!/><div class="action-buttons flex gap-3 flex-wrap">'),Un=v('<svg class="w-8 h-8 text-orange-600"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">'),Fn=v('<button class="px-6 py-3 bg-orange-600 text-white font-semibold rounded-lg hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-all"style=min-width:44px;min-height:44px>');function Ge(r){const e=ue(ge),[t,n]=G(!1),s=()=>{n(i=>!i)};return(()=>{var i=f(Rn),a=i.firstChild,l=a.firstChild,d=l.firstChild,u=d.nextSibling,h=u.firstChild,g=h.nextSibling,S=g.nextSibling,[E,P]=D(S.nextSibling),R=l.nextSibling,[j,m]=D(R.nextSibling),b=j.nextSibling,[$,I]=D(b.nextSibling),k=$.nextSibling;return o(d,c(U,{get when(){return r.isCorrect},get fallback(){return f(Un)},get children(){return f(In)}})),o(h,(()=>{var x=pe(()=>!!r.isCorrect);return()=>x()?e()("feedback.correct.title"):e()("feedback.incorrect.title")})()),o(g,()=>r.message),o(u,c(U,{get when(){return!r.isCorrect},get children(){var x=f(Tn);return o(x,()=>e()("feedback.incorrect.showCorrect",{answer:r.correctAnswer})),x}}),E,P),o(a,c(U,{get when(){return r.visualAid},get children(){var x=f(En),F=x.firstChild,T=F.nextSibling,[C,M]=D(T.nextSibling);return o(F,()=>e()("hints.common.visualAid")),o(x,c(Ue,{get visualAid(){return r.visualAid}}),C,M),x}}),j,m),o(a,c(U,{get when(){return r.workedSolution},get children(){var x=f(Dn),F=x.firstChild,T=F.firstChild,C=T.nextSibling,M=F.nextSibling;return F.$$click=s,o(C,(()=>{var V=pe(()=>!!t());return()=>V()?e()("feedback.incorrect.hideSolution"):e()("feedback.incorrect.viewSolution")})()),o(M,c(U,{get when(){return t()},get children(){var V=f(Mn);return o(V,c(Qe,{get solution(){return r.workedSolution},show:!0})),V}})),z(V=>{var O=t(),B=!!t();return O!==V.e&&p(F,"aria-expanded",V.e=O),B!==V.t&&T.classList.toggle("rotate-180",V.t=B),V},{e:void 0,t:void 0}),Y(),x}}),$,I),o(k,c(U,{get when(){return r.isCorrect},get fallback(){return c(U,{get when(){return r.onTryAgain},get children(){var x=f(Fn);return Ie(x,"click",r.onTryAgain),o(x,()=>e()("feedback.incorrect.tryAgain")),z(()=>p(x,"aria-label",e()("feedback.incorrect.tryAgain"))),Y(),x}})},get children(){return c(U,{get when(){return r.onContinue},get children(){var x=f(Pn);return Ie(x,"click",r.onContinue),o(x,()=>e()("feedback.correct.continue")),z(()=>p(x,"aria-label",e()("feedback.correct.continue"))),Y(),x}})}})),z(x=>{var F=`feedback-display-container mb-6 p-6 rounded-lg border-2 transition-all duration-300 animate-slide-in ${r.class||""}`,T={"bg-green-50 border-green-400":r.isCorrect,"bg-orange-50 border-orange-400":!r.isCorrect},C=!!r.isCorrect,M=!r.isCorrect,V=!!r.isCorrect,O=!r.isCorrect;return F!==x.e&&ee(i,x.e=F),x.t=_e(i,T,x.t),C!==x.a&&h.classList.toggle("text-green-900",x.a=C),M!==x.o&&h.classList.toggle("text-orange-900",x.o=M),V!==x.i&&g.classList.toggle("text-green-800",x.i=V),O!==x.n&&g.classList.toggle("text-orange-800",x.n=O),x},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),i})()}Se(["click"]);var jn=v('<div role=main><div class="progress-section mb-8"role=region><div class="flex items-center justify-between mb-3"><h2 class="text-lg font-semibold text-gray-700"></h2><span class="text-sm text-gray-600"><!$><!/>%</span></div><div class="progress-bar w-full h-3 bg-gray-200 rounded-full overflow-hidden"role=progressbar aria-valuemin=1><div class="progress-fill h-full bg-blue-600 transition-all duration-500 ease-out"></div></div></div><!$><!/>'),Ln=v('<div class="text-center text-gray-600">'),Vn=v('<span class="text-xs px-3 py-1 rounded-full bg-purple-100 text-purple-700 font-medium">'),Bn=v('<button type=submit class="px-6 py-3 font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2"style=min-width:44px;min-height:44px>'),On=v('<button class="px-5 py-2 text-gray-600 font-medium rounded hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-all text-sm"style=min-height:44px>'),Hn=v('<div class="skip-section flex justify-end">'),zn=v('<div class="exercise-content bg-white rounded-lg shadow-md p-8"><div class="question-section mb-8"role=region><h3 class="text-xl font-bold text-gray-900 mb-4"></h3><div class="question-text text-2xl font-medium text-gray-800 leading-relaxed p-6 bg-blue-50 rounded-lg border-2 border-blue-200"></div><div class="mt-4 flex gap-3 flex-wrap"><span class="text-xs px-3 py-1 rounded-full bg-gray-100 text-gray-700"></span><!$><!/></div></div><form class="answer-section mb-6"><label for=answer-input class="block text-lg font-semibold text-gray-700 mb-3"></label><div class="flex gap-3"><input id=answer-input type=text class="flex-1 px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed transition-all"aria-required=true style=min-height:44px><!$><!/></div></form><!$><!/><!$><!/><div class="hint-section mb-6"></div><!$><!/>'),qn=v('<div class="skip-confirm flex items-center gap-3 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg"><p class="text-sm text-yellow-900 font-medium"></p><button class="px-4 py-2 bg-yellow-600 text-white font-medium rounded hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all text-sm"style=min-height:44px></button><button class="px-4 py-2 bg-gray-300 text-gray-700 font-medium rounded hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-all text-sm"style=min-height:44px>');function Nn(r){const e=ue(ge),[t,n]=G(""),[s,i]=G({status:"pending"}),[a,l]=G(0),[d,u]=G(Date.now()),[h,g]=G(!1),[S,E]=G(),P=()=>r.exercises[r.currentIndex],R=()=>r.currentIndex>=r.exercises.length-1,j=()=>r.exercises.length;Ke(()=>{r.currentIndex,P()&&(n(""),i({status:"pending"}),l(0),u(Date.now()),g(!1),setTimeout(()=>{S()?.focus()},100))}),dt(()=>{S()?.focus()});const m=_=>{l(L=>L+1)},b=()=>Math.floor((Date.now()-d())/1e3),$=_=>_.trim(),I=_=>{n(_)},k=async _=>{_?.preventDefault();const L=$(t());if(!L)return;const H=P();if(H){i({status:"validating"});try{const ne=H.templateId,re=H.metadata.competencyAreaId,be=L.toLowerCase()===String(H.correctAnswer.value).toLowerCase(),$e=b(),we={exerciseId:H.id,templateId:H.templateId,correct:be,timeSpentSeconds:$e,hintsUsed:a(),userAnswer:L};if(be){const Z=e()("feedback.correct.messages"),oe=Z[Math.floor(Math.random()*Z.length)];i({status:"correct",message:oe}),r.onExerciseComplete(we)}else{const Z=e()("feedback.incorrect.messages"),oe=Z[Math.floor(Math.random()*Z.length)];i({status:"incorrect",message:oe,correctAnswer:String(H.correctAnswer.value)}),r.onExerciseComplete(we)}}catch(ne){console.error("Error validating answer:",ne);const re=$(t())===String(P()?.correctAnswer.value);i({status:re?"correct":"incorrect",message:re?e()("feedback.correct.title"):e()("feedback.incorrect.title"),correctAnswer:String(P()?.correctAnswer.value)})}}},x=()=>{n(""),i({status:"pending"}),S()?.focus()},F=()=>{R()&&r.onSessionComplete()},T=()=>{g(!0)},C=()=>{const _=P();if(!_)return;const L=b(),H={exerciseId:_.id,templateId:_.templateId,correct:!1,timeSpentSeconds:L,hintsUsed:a(),userAnswer:"",skipped:!0};r.onSkip(H),g(!1)},M=()=>{g(!1)},V=_=>{_.key==="Enter"&&(_.preventDefault(),k())},O=P(),B=s(),q=B.status==="validating",w=B.status==="correct"||B.status==="incorrect";B.status;const y=B.status==="incorrect";return(()=>{var _=f(jn),L=_.firstChild,H=L.firstChild,ne=H.firstChild,re=ne.nextSibling,be=re.firstChild,[$e,we]=D(be.nextSibling);$e.nextSibling;var Z=H.nextSibling,oe=Z.firstChild,ke=L.nextSibling,[Ee,Q]=D(ke.nextSibling);return o(ne,()=>e()("exercises.session.progress",{current:(r.currentIndex+1).toString(),total:j().toString()})),o(re,()=>Math.round((r.currentIndex+1)/j()*100),$e,we),o(_,c(U,{when:O,get fallback(){return(()=>{var A=f(Ln);return o(A,()=>e()("errors.exercise.notFound")),A})()},children:A=>(()=>{var X=f(zn),se=X.firstChild,ie=se.firstChild,le=ie.nextSibling,ae=le.nextSibling,Ce=ae.firstChild,Je=Ce.nextSibling,[Ye,Ze]=D(Je.nextSibling),De=se.nextSibling,je=De.firstChild,Le=je.nextSibling,ce=Le.firstChild,et=ce.nextSibling,[tt,nt]=D(et.nextSibling),rt=De.nextSibling,[Ve,st]=D(rt.nextSibling),it=Ve.nextSibling,[Be,ot]=D(it.nextSibling),Oe=Be.nextSibling,lt=Oe.nextSibling,[at,ct]=D(lt.nextSibling);return o(ie,()=>e()("exercises.exercise.question")),o(le,()=>A().questionText),o(Ce,()=>e()("exercises.exercise.difficulty",{level:A().metadata.difficulty})),o(ae,c(U,{get when(){return A().metadata.isBinding},get children(){var N=f(Vn);return o(N,()=>e()("exercises.exercise.bindingContent")),N}}),Ye,Ze),De.addEventListener("submit",k),o(je,()=>e()("exercises.exercise.yourAnswer")),ce.$$keydown=V,ce.$$input=N=>I(N.currentTarget.value),ut(E,ce),Me(ce,"disabled",w||q),p(ce,"aria-invalid",y),o(Le,c(U,{when:!w,get children(){var N=f(Bn);return o(N,c(U,{when:q,get fallback(){return e()("exercises.exercise.checkAnswer")},get children(){return e()("exercises.validation.checking")}})),z(K=>{var he=!t().trim()||q,fe={"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":!q&&t().trim(),"bg-gray-300 text-gray-500 cursor-not-allowed":!t().trim()||q},Ae=e()("exercises.exercise.checkAnswer");return he!==K.e&&Me(N,"disabled",K.e=he),K.t=_e(N,fe,K.t),Ae!==K.a&&p(N,"aria-label",K.a=Ae),K},{e:void 0,t:void 0,a:void 0}),N}}),tt,nt),o(X,c(U,{get when(){return w&&B.status==="correct"},get children(){return c(Ge,{isCorrect:!0,get message(){return B.message},get correctAnswer(){return String(A().correctAnswer.value)},get userAnswer(){return t()},get workedSolution(){return A().workedSolution},get visualAid(){return A().visualAid},onContinue:F})}}),Ve,st),o(X,c(U,{get when(){return w&&B.status==="incorrect"},get children(){return c(Ge,{isCorrect:!1,get message(){return B.message},get correctAnswer(){return pe(()=>"correctAnswer"in B)()?B.correctAnswer:String(A().correctAnswer.value)},get userAnswer(){return t()},get workedSolution(){return A().workedSolution},get visualAid(){return A().visualAid},onTryAgain:x})}}),Be,ot),o(Oe,c(An,{get hints(){return A().hints},onHintRequested:m,disabled:q,get resetKey(){return A().id}})),o(X,c(U,{when:!w,get children(){var N=f(Hn);return o(N,c(U,{get when(){return!h()},get fallback(){return(()=>{var K=f(qn),he=K.firstChild,fe=he.nextSibling,Ae=fe.nextSibling;return o(he,()=>e()("exercises.session.confirmQuit")),fe.$$click=C,o(fe,()=>e()("common.actions.confirm")),Ae.$$click=M,o(Ae,()=>e()("common.actions.cancel")),Y(),K})()},get children(){var K=f(On);return K.$$click=T,o(K,()=>e()("exercises.exercise.skipExercise")),z(()=>p(K,"aria-label",e()("exercises.exercise.skipExercise"))),Y(),K}})),N}}),at,ct),z(N=>{var K=e()("exercises.exercise.question"),he=e()("exercises.exercise.placeholder"),fe=e()("exercises.exercise.yourAnswer");return K!==N.e&&p(se,"aria-label",N.e=K),he!==N.t&&p(ce,"placeholder",N.t=he),fe!==N.a&&p(ce,"aria-label",N.a=fe),N},{e:void 0,t:void 0,a:void 0}),z(()=>Me(ce,"value",t())),Y(),X})()}),Ee,Q),z(A=>{var X=`exercise-practice-container max-w-4xl mx-auto p-6 ${r.class||""}`,se=e()("exercises.session.title"),ie=e()("exercises.session.progress",{current:(r.currentIndex+1).toString(),total:j().toString()}),le=r.currentIndex+1,ae=j(),Ce=`${(r.currentIndex+1)/j()*100}%`;return X!==A.e&&ee(_,A.e=X),se!==A.t&&p(_,"aria-label",A.t=se),ie!==A.a&&p(L,"aria-label",A.a=ie),le!==A.o&&p(Z,"aria-valuenow",A.o=le),ae!==A.i&&p(Z,"aria-valuemax",A.i=ae),Ce!==A.n&&gt(oe,"width",A.n=Ce),A},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),_})()}Se(["input","keydown","click"]);var Gn=v('<div class="mb-8 p-6 bg-yellow-50 border border-yellow-200 rounded-lg"><h2 class="text-lg font-semibold text-yellow-900 mb-4 text-center">Achievements Unlocked!</h2><div class="grid grid-cols-1 sm:grid-cols-2 gap-3">'),Kn=v('<div class=text-center><div class="text-3xl font-bold text-yellow-600 mb-1"></div><div class="text-sm text-gray-600">'),Wn=v('<div class=text-center><div class="text-3xl font-bold text-gray-600 mb-1"></div><div class="text-sm text-gray-600">'),Xn=v('<div class="text-center col-span-2"><div class="text-3xl font-bold text-indigo-600 mb-1">+<!$><!/></div><div class="text-sm text-gray-600">'),Qn=v('<div><div class="text-center mb-8"><div class="text-6xl mb-4"aria-hidden=true></div><h1 class="text-3xl font-bold text-gray-900 mb-2"></h1><p class="text-xl text-gray-700"></p></div><!$><!/><div class="mb-8 p-6 bg-white border border-gray-200 rounded-lg shadow-sm"><h2 class="text-xl font-semibold text-gray-900 mb-6"></h2><div class="grid grid-cols-2 gap-6"><div class=text-center><div class="text-3xl font-bold text-blue-600 mb-1"></div><div class="text-sm text-gray-600"></div></div><div class=text-center><div class="text-3xl font-bold text-green-600 mb-1"></div><div class="text-sm text-gray-600"></div></div><div class=text-center><div class="text-3xl font-bold text-purple-600 mb-1"><!$><!/>%</div><div class="text-sm text-gray-600"></div></div><div class=text-center><div class="text-3xl font-bold text-orange-600 mb-1"></div><div class="text-sm text-gray-600"></div></div><!$><!/><!$><!/><!$><!/></div></div><div class=space-y-3><button type=button class="w-full py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold text-lg rounded-lg transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-md hover:shadow-lg"></button><button type=button class="w-full py-4 px-6 bg-green-600 hover:bg-green-700 text-white font-semibold text-lg rounded-lg transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 shadow-md hover:shadow-lg"></button><button type=button class="w-full py-4 px-6 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold text-lg rounded-lg transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 shadow-sm hover:shadow-md">'),Jn=v('<div class="flex items-center p-3 bg-white rounded-lg shadow-sm"><span class="text-2xl mr-3"aria-hidden=true></span><span class="text-sm font-medium text-gray-800">');function Yn(r){const e=ue(ge),t=ve(()=>r.stats.totalExercises===0?0:Math.round(r.stats.correctCount/r.stats.totalExercises*100)),n=ve(()=>{const a=Math.round(r.stats.avgTimeSeconds),l=Math.floor(a/60),d=a%60;return`${l}:${d.toString().padStart(2,"0")}`}),s=ve(()=>{const a=t();return a>=90?e()("exercises.session.summary.excellentWork"):a>=70?e()("exercises.session.summary.goodProgress"):e()("exercises.session.summary.keepPracticing")}),i=ve(()=>{const a=[];return t()===100&&a.push("perfectScore"),r.stats.hintsUsed===0&&r.stats.correctCount>0&&a.push("noHints"),r.stats.avgTimeSeconds<30&&a.push("fastLearner"),r.stats.totalExercises>=30&&a.push("persistent"),a});return(()=>{var a=f(Qn),l=a.firstChild,d=l.firstChild,u=d.nextSibling,h=u.nextSibling,g=l.nextSibling,[S,E]=D(g.nextSibling),P=S.nextSibling,R=P.firstChild,j=R.nextSibling,m=j.firstChild,b=m.firstChild,$=b.nextSibling,I=m.nextSibling,k=I.firstChild,x=k.nextSibling,F=I.nextSibling,T=F.firstChild,C=T.firstChild,[M,V]=D(C.nextSibling);M.nextSibling;var O=T.nextSibling,B=F.nextSibling,q=B.firstChild,w=q.nextSibling,y=B.nextSibling,[_,L]=D(y.nextSibling),H=_.nextSibling,[ne,re]=D(H.nextSibling),be=ne.nextSibling,[$e,we]=D(be.nextSibling),Z=P.nextSibling,oe=Z.firstChild,ke=oe.nextSibling,Ee=ke.nextSibling;return o(u,()=>e()("exercises.session.summary.title")),o(h,s),o(a,c(U,{get when(){return i().length>0},get children(){var Q=f(Gn),A=Q.firstChild,X=A.nextSibling;return o(X,c(de,{get each(){return i()},children:se=>(()=>{var ie=f(Jn),le=ie.firstChild,ae=le.nextSibling;return o(ae,()=>e()(`exercises.session.summary.achievements.${se}`)),ie})()})),Q}}),S,E),o(R,()=>e()("exercises.session.summary.statistics.title")),o(b,()=>r.stats.totalExercises),o($,()=>e()("exercises.session.summary.statistics.total")),o(k,()=>r.stats.correctCount),o(x,()=>e()("exercises.session.summary.statistics.correct")),o(T,t,M,V),o(O,()=>e()("exercises.session.summary.statistics.accuracy")),o(q,n),o(w,()=>e()("exercises.session.summary.statistics.avgTime")),o(j,c(U,{get when(){return r.stats.hintsUsed>0},get children(){var Q=f(Kn),A=Q.firstChild,X=A.nextSibling;return o(A,()=>r.stats.hintsUsed),o(X,()=>e()("exercises.session.summary.statistics.hintsUsed")),Q}}),_,L),o(j,c(U,{get when(){return r.stats.skippedCount>0},get children(){var Q=f(Wn),A=Q.firstChild,X=A.nextSibling;return o(A,()=>r.stats.skippedCount),o(X,()=>e()("exercises.session.summary.statistics.skipped")),Q}}),ne,re),o(j,c(U,{get when(){return pe(()=>r.masteryGain!==void 0)()&&r.masteryGain>0},get children(){var Q=f(Xn),A=Q.firstChild,X=A.firstChild,se=X.nextSibling,[ie,le]=D(se.nextSibling),ae=A.nextSibling;return o(A,()=>r.masteryGain,ie,le),o(ae,()=>e()("exercises.session.summary.statistics.masteryGain")),Q}}),$e,we),Ie(oe,"click",r.onPracticeAgain),o(oe,()=>e()("exercises.session.summary.actions.practiceAgain")),Ie(ke,"click",r.onViewProgress),o(ke,()=>e()("exercises.session.summary.actions.viewProgress")),Ie(Ee,"click",r.onReturnToDashboard),o(Ee,()=>e()("exercises.session.summary.actions.dashboard")),z(()=>ee(a,`session-summary ${r.class||""}`)),Y(),a})()}Se(["click"]);var Zn=v('<div class="text-center py-12"><div class="text-red-600 text-xl font-semibold mb-4">Error</div><p class="text-gray-700 mb-6"></p><button type=button class="py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">Try Again'),er=v("<div>");function or(r){const[e,t]=G("setup"),[n,s]=G(""),[i,a]=G([]),[l,d]=G(0),[u,h]=G(""),[g,S]=G(0),[E,P]=G(0),[R,j]=G(0),[m,b]=G(0),[$,I]=G(Date.now()),k=ve(()=>{const w=i(),y=l();return w[y]||null}),x=ve(()=>l()>=i().length-1),F=async w=>{try{const y=await ht(r.userId,r.gradeRange,r.competencyAreaId);s(y.id);const _=w.difficulty==="Auto"?void 0:w.difficulty,L=await Ut({competencyAreaId:r.competencyAreaId,gradeRange:r.gradeRange,difficulty:_},w.exerciseCount,{locale:r.locale});a(L),d(0),I(Date.now()),t("practicing")}catch(y){console.error("Failed to start session:",y),h("Failed to start session. Please try again."),t("error")}},T=async w=>{try{const y=k();if(!y)return;const _=Math.round((Date.now()-$())/1e3);b(m()+_),w.correct&&S(g()+1),P(E()+w.hintsUsed),await He({userId:r.userId,sessionId:n(),templateId:y.templateId,competencyAreaId:r.competencyAreaId,skillId:y.metadata.skillId||"unknown",difficulty:y.metadata.difficulty,isBinding:y.metadata.isBinding,correct:w.correct,timeSpentSeconds:_,hintsUsed:w.hintsUsed,userAnswer:w.userAnswer});const L=l()+1;L%5===0&&await mt(n(),L,g()),x()?await M():(d(l()+1),I(Date.now()))}catch(y){console.error("Failed to log exercise attempt:",y),x()?await M():(d(l()+1),I(Date.now()))}},C=async w=>{try{const y=k();if(!y)return;const _=Math.round((Date.now()-$())/1e3);b(m()+_),j(R()+1),P(E()+w.hintsUsed),await He({userId:r.userId,sessionId:n(),templateId:y.templateId,competencyAreaId:r.competencyAreaId,skillId:y.metadata.skillId||"unknown",difficulty:y.metadata.difficulty,isBinding:y.metadata.isBinding,correct:!1,timeSpentSeconds:_,hintsUsed:w.hintsUsed,userAnswer:w.userAnswer||""}),x()?await M():(d(l()+1),I(Date.now()))}catch(y){console.error("Failed to log skipped exercise:",y),x()?await M():(d(l()+1),I(Date.now()))}},M=async()=>{try{const w=i().length,y=w>0?m()/w:0;await ft(n(),w,g(),y),t("complete")}catch(w){console.error("Failed to end session:",w),t("complete")}},V=()=>{s(""),a([]),d(0),S(0),P(0),j(0),b(0),t("setup")},O=()=>{window.location.href="/dashboard"},B=()=>{window.location.href="/dashboard"},q=ve(()=>({totalExercises:i().length,correctCount:g(),avgTimeSeconds:i().length>0?m()/i().length:0,hintsUsed:E(),skippedCount:R()}));return(()=>{var w=f(er);return o(w,c(Fe,{get children(){return[c(te,{get when(){return e()==="setup"},get children(){return c(Vt,{get isFirstTime(){return r.isFirstTime},onStart:F})}}),c(te,{get when(){return pe(()=>e()==="practicing")()&&k()},get children(){return c(Nn,{get exercises(){return i()},get currentIndex(){return l()},get sessionId(){return n()},onExerciseComplete:T,onSkip:C,onSessionComplete:M})}}),c(te,{get when(){return e()==="complete"},get children(){return c(Yn,{get stats(){return q()},onPracticeAgain:V,onViewProgress:O,onReturnToDashboard:B})}}),c(te,{get when(){return e()==="error"},get children(){var y=f(Zn),_=y.firstChild,L=_.nextSibling,H=L.nextSibling;return o(L,u),H.$$click=()=>t("setup"),Y(),y}})]}})),z(()=>ee(w,`practice-session-wrapper max-w-4xl mx-auto px-4 py-8 ${r.class||""}`)),w})()}Se(["click"]);export{or as default};
