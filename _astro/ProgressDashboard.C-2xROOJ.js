import{d as Qe,c as Xe,w as Ce,b as $,g as o,t as a,a as c,i as t,v as De,S as y,m as me,F as re,e as Me,x as le,s as Ze,r as Pe,E as et}from"./store.D7pQqe3Y.js";import{m as tt,$ as rt}from"./store.BH8NtN2R.js";import{s as lt}from"./client.D0X2hLWc.js";import{f as nt,a as st,b as it}from"./progress.isgvytKC.js";import"./_commonjsHelpers.gnU0ypJ3.js";const Re=[{level:"introduced",min:0,max:20,colorCode:"red"},{level:"developing",min:21,max:40,colorCode:"yellow"},{level:"progressing",min:41,max:60,colorCode:"light-green"},{level:"proficient",min:61,max:80,colorCode:"green"},{level:"mastered",min:81,max:100,colorCode:"blue"}];function $e(r){const e=Math.max(0,Math.min(100,r));for(const n of Re)if(e>=n.min&&e<=n.max)return n;return Re[0]}function ot(r){if(r.length===0)return{currentStreak:0,longestStreak:0,lastPracticeDate:null,isAtRisk:!0};const e=new Set;let n=null;for(const se of r){const z=se.createdAt,u=ne(z);e.add(u),(!n||z>n)&&(n=z)}const l=Array.from(e).sort().reverse(),d=at(l),s=dt(l),h=ne(new Date),X=l[0]!==h;return{currentStreak:d,longestStreak:s,lastPracticeDate:n,isAtRisk:X}}function ne(r){const e=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),l=String(r.getDate()).padStart(2,"0");return`${e}-${n}-${l}`}function at(r){if(r.length===0)return 0;const e=ne(new Date),n=ne(ct());if(r[0]!==e&&r[0]!==n)return 0;let l=0,d=r[0];for(const s of r)if(s===d)l++,d=Ae(d);else break;return l}function dt(r){if(r.length===0)return 0;let e=1,n=1;for(let l=0;l<r.length-1;l++){const d=r[l],s=r[l+1],h=Ae(d);s===h?(n++,e=Math.max(e,n)):n=1}return e}function ct(){const r=new Date;return r.setDate(r.getDate()-1),r}function Ae(r){const e=new Date(r+"T00:00:00");return e.setDate(e.getDate()-1),ne(e)}async function gt(r,e=10){const{data:n,error:l}=await lt.from("skills_progress").select("*").eq("user_id",r).not("next_review_at","is",null).order("next_review_at",{ascending:!0}).limit(e*2);if(l)return console.error("Error fetching upcoming reviews:",l),{overdue:[],today:[],thisWeek:[],upcoming:[],total:0};if(!n||n.length===0)return{overdue:[],today:[],thisWeek:[],upcoming:[],total:0};const d=n.map(X=>ut(X)),s=mt(d),h=Math.ceil(e/4);return{overdue:s.overdue.slice(0,h),today:s.today.slice(0,h),thisWeek:s.thisWeek.slice(0,h),upcoming:s.upcoming.slice(0,h),total:d.length}}function ut(r){const e=new Date(r.next_review_at),n=r.last_practiced_at?new Date(r.last_practiced_at):void 0,l=$t(e),d=l==="overdue"?xt(e):void 0;return{skillId:r.skill_id,masteryLevel:r.mastery_level,nextReviewAt:e,urgency:l,daysOverdue:d,lastPracticed:n}}function mt(r){const e=[],n=[],l=[],d=[];for(const s of r)switch(s.urgency){case"overdue":e.push(s);break;case"today":n.push(s);break;case"this-week":l.push(s);break;case"upcoming":d.push(s);break}return{overdue:e,today:n,thisWeek:l,upcoming:d,total:r.length}}function $t(r){const e=new Date,n=ft(e),l=bt(e);return r<e?"overdue":r<=n?"today":r<=l?"this-week":"upcoming"}function xt(r){const n=new Date().getTime()-r.getTime(),l=Math.ceil(n/(1e3*60*60*24));return Math.max(0,l)}function ft(r){const e=new Date(r);return e.setHours(23,59,59,999),e}function bt(r){const e=new Date(r),l=7-e.getDay();return e.setDate(e.getDate()+l),e.setHours(23,59,59,999),e}function Ee(r){const e=new Date,n=r.getTime()-e.getTime(),l=Math.floor(n/(1e3*60*60*24));if(l<0){const h=Math.abs(l);return h===0?"today":h===1?"yesterday":`${h} days ago`}if(l===0)return"today";if(l===1)return"tomorrow";if(l<7)return`in ${l} days`;const d=Math.floor(l/7);if(d===1)return"in 1 week";if(d<4)return`in ${d} weeks`;const s=Math.floor(l/30);return s===1?"in 1 month":`in ${s} months`}var ht=a('<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-2">'),_t=a('<div class=mb-8><h2 class="mb-4 text-2xl font-bold text-gray-900"></h2><!$><!/>'),vt=a('<div class="rounded-lg border-2 border-red-200 bg-red-50 p-4"><h3 class="mb-3 text-sm font-semibold text-red-900"><!$><!/> (<!$><!/>)</h3><div class=space-y-2>'),pt=a('<div class="rounded-lg border border-yellow-200 bg-yellow-50 p-4"><h3 class="mb-3 text-sm font-semibold text-yellow-900"><!$><!/> (<!$><!/>)</h3><div class=space-y-2>'),yt=a('<div class="rounded-lg border border-blue-200 bg-blue-50 p-4"><h3 class="mb-3 text-sm font-semibold text-blue-900"><!$><!/> (<!$><!/>)</h3><div class=space-y-2>'),St=a("<div class=space-y-4><!$><!/><!$><!/><!$><!/>"),wt=a('<div><h2 class="mb-4 text-2xl font-bold text-gray-900"></h2><!$><!/>'),kt=a('<div class="mx-auto max-w-7xl px-4 py-8"><div class=mb-8><h1 class="text-3xl font-bold text-gray-900"></h1><p class="mt-2 text-gray-600"></p></div><!$><!/>'),Ct=a('<div class="rounded-lg border-2 border-red-200 bg-red-50 p-6 text-center"><p class="text-lg font-semibold text-red-800"></p><p class="mt-2 text-sm text-red-600"></p><button class="mt-4 rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700">'),Dt=a('<div class="text-center py-12"><div class="inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"></div><p class="mt-4 text-gray-600">'),Mt=a('<p class="mt-2 text-sm opacity-75">'),Le=a('<p class="mt-4 text-sm font-medium">'),Pt=a('<div class="mb-8 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 p-6 text-white shadow-lg"><div class="flex items-center justify-between"><div><p class="text-sm font-medium opacity-90"></p><p class="mt-1 text-3xl font-bold"></p><!$><!/></div><div class=text-6xl></div></div><!$><!/><!$><!/>'),Rt=a('<div class="rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-8 text-center"><p class=text-gray-600></p><p class="mt-2 text-sm text-gray-500">'),Et=a("<div class=space-y-3>"),Lt=a('<div class="border-t border-gray-200 bg-gray-50 p-6"><h4 class="mb-4 text-sm font-semibold text-gray-700"></h4><!$><!/>'),At=a('<div class="rounded-lg border border-gray-200 bg-white shadow-sm transition-shadow hover:shadow-md"><div class=p-6><div class="flex items-start justify-between"><div class=flex-1><h3 class="text-lg font-semibold text-gray-900"></h3><div class="mt-2 flex items-center gap-2"><div class=flex-1><div class="h-3 overflow-hidden rounded-full bg-gray-200"><div class="h-full transition-all duration-300"></div></div></div><span class="text-sm font-medium text-gray-700"><!$><!/>%</span></div><div class="mt-3 flex items-center gap-2"><span class="inline-block rounded-full px-3 py-1 text-xs font-medium text-white"></span></div></div></div><div class="mt-4 grid grid-cols-2 gap-4 text-sm"><div><p class=text-gray-500></p><p class="font-semibold text-gray-900"></p></div><div><p class=text-gray-500></p><p class="font-semibold text-gray-900"><!$><!/>%</p></div></div><div class="mt-3 text-xs text-gray-500"><!$><!/>: <!$><!/></div><button class="mt-4 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"></button></div><!$><!/>'),It=a('<p class="text-sm text-gray-500">'),Tt=a('<p class="mt-1 text-xs text-gray-500">'),Wt=a('<div class="rounded-md bg-white p-3"><div class="flex items-center justify-between mb-2"><span class="text-sm font-medium text-gray-900"></span><span class="text-sm text-gray-600"><!$><!/>%</span></div><div class="h-2 overflow-hidden rounded-full bg-gray-200"><div class="h-full transition-all duration-300"></div></div><!$><!/>'),Ot=a('<div class="text-center py-8"><p class=text-gray-600>'),jt=a('<div class="rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-8 text-center"><p class=text-gray-600>'),Ft=a('<div class="flex items-center justify-between rounded-md bg-white p-3"><div><p class="text-sm font-medium text-gray-900"></p><p class="text-xs text-red-600"></p></div><button class="rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700">'),Bt=a('<div class="flex items-center justify-between rounded-md bg-white p-3"><div><p class="text-sm font-medium text-gray-900"></p><p class="text-xs text-gray-600"></p></div><button class="rounded-md bg-yellow-600 px-4 py-2 text-sm font-medium text-white hover:bg-yellow-700">'),Ht=a('<div class="flex items-center justify-between rounded-md bg-white p-3"><div><p class="text-sm font-medium text-gray-900"></p><p class="text-xs text-gray-600">');const qt=r=>{const e=tt(rt),[n,l]=Xe(null),[d]=Ce(async()=>{const[u,_,S]=await Promise.all([nt(r.userId),st(r.userId),it(r.userId,1e3)]);return{competencies:u,skills:_,exerciseHistory:S}}),[s]=Ce(async()=>await gt(r.userId,10)),h=()=>{const u=d();return u?ot(u.exerciseHistory):null},X=u=>{l(_=>_===u?null:u)},se=u=>{const _=d();return _?_.skills.filter(S=>S.skillId.startsWith(u)):[]},z=u=>{if(!u)return e()("progress.competencyCard.notPracticedYet");const S=new Date().getTime()-u.getTime(),w=Math.floor(S/(1e3*60*60*24));if(w===0)return e()("common.time.justNow");if(w===1)return`1 ${e()("common.time.days")} ${e()("common.time.ago")}`;if(w<7)return`${w} ${e()("common.time.days")} ${e()("common.time.ago")}`;const E=Math.floor(w/7);return E===1?`1 ${e()("common.time.weeks")} ${e()("common.time.ago")}`:E<4?`${E} ${e()("common.time.weeks")} ${e()("common.time.ago")}`:`${Math.floor(w/30)} ${e()("common.time.months")} ${e()("common.time.ago")}`};return $(et,{fallback:u=>(()=>{var _=o(Ct),S=_.firstChild,w=S.nextSibling,E=w.nextSibling;return t(S,()=>e()("progress.errors.loadFailed")),t(w,()=>String(u)),E.$$click=()=>window.location.reload(),t(E,()=>e()("progress.errors.tryAgain")),Pe(),_})(),get children(){var u=o(kt),_=u.firstChild,S=_.firstChild,w=S.nextSibling,E=_.nextSibling,[xe,Ie]=c(E.nextSibling);return t(S,()=>e()("progress.dashboard.title")),t(w,()=>e()("progress.dashboard.subtitle")),t(u,$(De,{get fallback(){return(()=>{var x=o(Dt),p=x.firstChild,L=p.nextSibling;return t(L,()=>e()("progress.loading.progress")),x})()},get children(){return[$(y,{get when(){return h()},children:x=>(()=>{var p=o(Pt),L=p.firstChild,F=L.firstChild,q=F.firstChild,m=q.nextSibling,g=m.nextSibling,[f,B]=c(g.nextSibling),H=F.nextSibling,N=L.nextSibling,[Y,Z]=c(N.nextSibling),G=Y.nextSibling,[V,v]=c(G.nextSibling);return t(q,()=>e()("progress.sections.streak")),t(m,(()=>{var i=me(()=>x().currentStreak>0);return()=>i()?e()("progress.streak.current",{count:x().currentStreak}):e()("progress.streak.noStreak")})()),t(F,$(y,{get when(){return x().lastPracticeDate},get children(){var i=o(Mt);return t(i,()=>e()("progress.streak.lastPracticed",{date:z(x().lastPracticeDate)})),i}}),f,B),t(H,()=>x().currentStreak>=7?"ðŸ”¥":"â­"),t(p,$(y,{get when(){return me(()=>x().currentStreak>0)()&&x().isAtRisk},get children(){var i=o(Le);return t(i,()=>e()("progress.streak.keepItGoing")),i}}),Y,Z),t(p,$(y,{get when(){return x().currentStreak===0},get children(){var i=o(Le);return t(i,()=>e()("progress.streak.practiceToday")),i}}),V,v),p})()}),(()=>{var x=o(_t),p=x.firstChild,L=p.nextSibling,[F,q]=c(L.nextSibling);return t(p,()=>e()("progress.sections.competencies")),t(x,$(y,{get when(){return d()?.competencies.length??!1},get fallback(){return(()=>{var m=o(Rt),g=m.firstChild,f=g.nextSibling;return t(g,()=>e()("progress.empty.noCompetencies")),t(f,()=>e()("progress.empty.startPracticing")),m})()},get children(){var m=o(ht);return t(m,$(re,{get each(){return d()?.competencies},children:g=>{const f=()=>$e(g.masteryLevel),B=()=>n()===g.competencyAreaId;return(()=>{var H=o(At),N=H.firstChild,Y=N.firstChild,Z=Y.firstChild,G=Z.firstChild,V=G.nextSibling,v=V.firstChild,i=v.firstChild,A=i.firstChild,k=v.nextSibling,K=k.firstChild,[I,U]=c(K.nextSibling);I.nextSibling;var M=V.nextSibling,T=M.firstChild,W=Y.nextSibling,C=W.firstChild,D=C.firstChild,R=D.nextSibling,P=C.nextSibling,O=P.firstChild,J=O.nextSibling,Te=J.firstChild,[fe,We]=c(Te.nextSibling);fe.nextSibling;var ie=W.nextSibling,Oe=ie.firstChild,[be,je]=c(Oe.nextSibling),Fe=be.nextSibling,Be=Fe.nextSibling,[He,Ne]=c(Be.nextSibling),ge=ie.nextSibling,Ye=N.nextSibling,[Ke,Ue]=c(Ye.nextSibling);return t(G,()=>g.competencyAreaId),t(k,()=>g.masteryLevel,I,U),t(T,()=>e()(`progress.masteryLevels.${f().level}`)),t(D,()=>e()("progress.competencyCard.attemptsLabel")),t(R,()=>g.totalAttempts),t(O,()=>e()("progress.competencyCard.successRateLabel")),t(J,()=>g.successRate.toFixed(1),fe,We),t(ie,()=>e()("progress.competencyCard.lastPracticedLabel"),be,je),t(ie,()=>z(g.lastPracticed),He,Ne),ge.$$click=()=>X(g.competencyAreaId),t(ge,(()=>{var b=me(()=>!!B());return()=>b()?e()("progress.competencyCard.hideSkills"):e()("progress.competencyCard.viewSkills")})()),t(H,$(y,{get when(){return B()},get children(){var b=o(Lt),ee=b.firstChild,oe=ee.nextSibling,[ae,de]=c(oe.nextSibling);return t(ee,()=>e()("progress.sections.skills")),t(b,$(y,{get when(){return se(g.competencyAreaId).length>0},get fallback(){return(()=>{var te=o(It);return t(te,()=>e()("progress.skillsBreakdown.noSkillsYet")),te})()},get children(){var te=o(Et);return t(te,$(re,{get each(){return se(g.competencyAreaId)},children:Q=>{const ce=()=>$e(Q.masteryLevel);return(()=>{var ue=o(Wt),he=ue.firstChild,_e=he.firstChild,ve=_e.nextSibling,ze=ve.firstChild,[pe,qe]=c(ze.nextSibling);pe.nextSibling;var ye=he.nextSibling,Se=ye.firstChild,Ge=ye.nextSibling,[Ve,Je]=c(Ge.nextSibling);return t(_e,()=>Q.skillId),t(ve,()=>Q.masteryLevel,pe,qe),t(ue,$(y,{get when(){return Q.nextReview},get children(){var j=o(Tt);return t(j,()=>e()("progress.skillsBreakdown.nextReview",{date:Ee(Q.nextReview)})),j}}),Ve,Je),Me(j=>{var we=`${Q.masteryLevel}%`,ke=ce().colorCode==="red"?"#dc2626":ce().colorCode==="yellow"?"#fbbf24":ce().colorCode==="light-green"?"#86efac":ce().colorCode==="green"?"#16a34a":"#3b82f6";return we!==j.e&&le(Se,"width",j.e=we),ke!==j.t&&le(Se,"background-color",j.t=ke),j},{e:void 0,t:void 0}),ue})()}})),te}}),ae,de),b}}),Ke,Ue),Me(b=>{var ee=`${g.masteryLevel}%`,oe=f().colorCode==="red"?"#dc2626":f().colorCode==="yellow"?"#fbbf24":f().colorCode==="light-green"?"#86efac":f().colorCode==="green"?"#16a34a":"#3b82f6",ae=f().colorCode==="red"?"#dc2626":f().colorCode==="yellow"?"#fbbf24":f().colorCode==="light-green"?"#86efac":f().colorCode==="green"?"#16a34a":"#3b82f6",de=B();return ee!==b.e&&le(A,"width",b.e=ee),oe!==b.t&&le(A,"background-color",b.t=oe),ae!==b.a&&le(T,"background-color",b.a=ae),de!==b.o&&Ze(ge,"aria-expanded",b.o=de),b},{e:void 0,t:void 0,a:void 0,o:void 0}),Pe(),H})()}})),m}}),F,q),x})(),(()=>{var x=o(wt),p=x.firstChild,L=p.nextSibling,[F,q]=c(L.nextSibling);return t(p,()=>e()("progress.reviews.title")),t(x,$(De,{get fallback(){return(()=>{var m=o(Ot),g=m.firstChild;return t(g,()=>e()("progress.loading.reviews")),m})()},get children(){return $(y,{get when(){return s()?.total??!1},get fallback(){return(()=>{var m=o(jt),g=m.firstChild;return t(g,()=>e()("progress.reviews.noReviews")),m})()},get children(){var m=o(St),g=m.firstChild,[f,B]=c(g.nextSibling),H=f.nextSibling,[N,Y]=c(H.nextSibling),Z=N.nextSibling,[G,V]=c(Z.nextSibling);return t(m,$(y,{get when(){return(s()?.overdue.length??0)>0},get children(){var v=o(vt),i=v.firstChild,A=i.firstChild,[k,K]=c(A.nextSibling),I=k.nextSibling,U=I.nextSibling,[M,T]=c(U.nextSibling);M.nextSibling;var W=i.nextSibling;return t(i,()=>e()("progress.reviews.overdue"),k,K),t(i,()=>s()?.overdue.length,M,T),t(W,$(re,{get each(){return s()?.overdue},children:C=>(()=>{var D=o(Ft),R=D.firstChild,P=R.firstChild,O=P.nextSibling,J=R.nextSibling;return t(P,()=>C.skillId),t(O,()=>e()("progress.reviews.overdueBy",{days:C.daysOverdue??0})),t(J,()=>e()("progress.reviews.practiceNow")),D})()})),v}}),f,B),t(m,$(y,{get when(){return(s()?.today.length??0)>0},get children(){var v=o(pt),i=v.firstChild,A=i.firstChild,[k,K]=c(A.nextSibling),I=k.nextSibling,U=I.nextSibling,[M,T]=c(U.nextSibling);M.nextSibling;var W=i.nextSibling;return t(i,()=>e()("progress.reviews.dueToday"),k,K),t(i,()=>s()?.today.length,M,T),t(W,$(re,{get each(){return s()?.today},children:C=>(()=>{var D=o(Bt),R=D.firstChild,P=R.firstChild,O=P.nextSibling,J=R.nextSibling;return t(P,()=>C.skillId),t(O,()=>$e(C.masteryLevel).level),t(J,()=>e()("progress.reviews.practiceNow")),D})()})),v}}),N,Y),t(m,$(y,{get when(){return(s()?.thisWeek.length??0)>0},get children(){var v=o(yt),i=v.firstChild,A=i.firstChild,[k,K]=c(A.nextSibling),I=k.nextSibling,U=I.nextSibling,[M,T]=c(U.nextSibling);M.nextSibling;var W=i.nextSibling;return t(i,()=>e()("progress.reviews.dueThisWeek"),k,K),t(i,()=>s()?.thisWeek.length,M,T),t(W,$(re,{get each(){return s()?.thisWeek},children:C=>(()=>{var D=o(Ht),R=D.firstChild,P=R.firstChild,O=P.nextSibling;return t(P,()=>C.skillId),t(O,()=>e()("progress.reviews.dueOn",{date:Ee(C.nextReviewAt)})),D})()})),v}}),G,V),m}})}}),F,q),x})()]}}),xe,Ie),u}})};Qe(["click"]);export{qt as default};
