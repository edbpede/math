import{$ as e}from"./exercises.CmwZ4dJn.js";import{d as t,m as r,b as s,e as i,f as n,g as a,h as l,i as o,S as d,j as c,k as g,F as m,l as u,r as p,E as x,t as b,s as h,n as f}from"./solid-core.DXeZPQOr.js";import{g as v,f as y,c as _,a as w}from"./mastery.BYaRoLpV.js";import{c as S}from"./supabase.BYn26wLR.js";const C={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVoZGl0c3NyZHdwZ2ltenFubXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MjUwODcsImV4cCI6MjA3ODAwMTA4N30.mLWFSdiiv1YrwrAgYqVpquRzg1uksIgeo8XsRD5rgjs",PUBLIC_SUPABASE_URL:"https://ehditssrdwpgimzqnmxx.supabase.co",SITE:void 0,SSR:!1};function k(e){const t=C[e];if(!t)throw new Error(`Missing required environment variable: ${e}. Please add it to your .env file. See .env.example for reference.`);return t}const I=S(k("PUBLIC_SUPABASE_URL"),k("PUBLIC_SUPABASE_ANON_KEY"),{auth:{storage:"undefined"!=typeof window?window.localStorage:void 0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"math-edbpede-auth"},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Client-Info":"math-edbpede-web"}}});class $ extends Error{constructor(e,t,r){super(e),this.operation=t,this.cause=r,this.name="ProgressError"}}const A={maxAttempts:3,initialDelayMs:100,maxDelayMs:2e3,backoffMultiplier:2};async function P(e,t,r=A){let s,i=r.initialDelayMs;for(let a=1;a<=r.maxAttempts;a++)try{return await e()}catch(n){if(s=n,a===r.maxAttempts)break;await new Promise(e=>setTimeout(e,i)),i=Math.min(i*r.backoffMultiplier,r.maxDelayMs)}throw new $(`Failed to ${t} after ${r.maxAttempts} attempts`,t,s)}function R(e){return{competencyAreaId:e.competency_area_id,gradeRange:e.grade_range,masteryLevel:e.mastery_level,totalAttempts:e.total_attempts,successRate:Number(e.success_rate),lastPracticed:e.last_practiced_at?new Date(e.last_practiced_at):new Date,achievedAt:e.achieved_at?new Date(e.achieved_at):void 0}}function D(e){return{skillId:e.skill_id,masteryLevel:e.mastery_level,srsParams:{easeFactor:Number(e.ease_factor),interval:e.interval_days,repetitionCount:e.repetition_count},attempts:e.attempts,successes:e.successes,avgResponseTime:e.avg_response_time_ms??0,lastPracticed:e.last_practiced_at?new Date(e.last_practiced_at):new Date,nextReview:e.next_review_at?new Date(e.next_review_at):new Date}}function L(e){return{id:e.id,userId:e.user_id,sessionId:e.session_id,templateId:e.template_id,competencyAreaId:e.competency_area_id,skillId:e.skill_id,difficulty:e.difficulty,isBinding:e.is_binding,correct:e.correct,timeSpentSeconds:e.time_spent_seconds,hintsUsed:e.hints_used,userAnswer:e.user_answer??"",createdAt:new Date(e.created_at)}}function E(e){return{id:e.id,userId:e.user_id,gradeRange:e.grade_range,competencyAreaId:e.competency_area_id,startedAt:new Date(e.started_at),endedAt:e.ended_at?new Date(e.ended_at):void 0,totalExercises:e.total_exercises,correctCount:e.correct_count,avgTimePerExerciseSeconds:e.avg_time_per_exercise_seconds??void 0}}async function j(e){return P(async()=>{const{data:t,error:r}=await I.from("competency_progress").select("*").eq("user_id",e).order("competency_area_id",{ascending:!0});if(r)throw r;return(t??[]).map(R)},"fetch competency progress")}async function M(e,t,r){return P(async()=>{const{data:s,error:i}=await I.from("competency_progress").select("*").eq("user_id",e).eq("competency_area_id",t).eq("grade_range",r).single();if(i){if("PGRST116"===i.code)return null;throw i}return s?R(s):null},"fetch competency progress by area")}async function B(e){return P(async()=>{const{data:t,error:r}=await I.from("skills_progress").select("*").eq("user_id",e).order("skill_id",{ascending:!0});if(r)throw r;return(t??[]).map(D)},"fetch skills progress")}async function O(e,t){return P(async()=>{const{data:r,error:s}=await I.from("skills_progress").select("*").eq("user_id",e).eq("skill_id",t).single();if(s){if("PGRST116"===s.code)return null;throw s}return r?D(r):null},"fetch skill progress by skill")}async function U(e,t=100){return P(async()=>{const{data:r,error:s}=await I.from("exercise_history").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(t);if(s)throw s;return(r??[]).map(L)},"fetch exercise history")}async function T(e,t){return 0===t.length?[]:P(async()=>{const r=(new Date).toISOString(),s=t.map(t=>({user_id:e,competency_area_id:t.competencyAreaId,grade_range:t.gradeRange,mastery_level:t.masteryLevel,total_attempts:t.totalAttempts,success_rate:t.successRate,last_practiced_at:r,achieved_at:t.masteryLevel>=80?r:void 0})),{data:i,error:n}=await I.from("competency_progress").upsert(s,{onConflict:"user_id,competency_area_id,grade_range"}).select();if(n)throw n;return(i??[]).map(R)},"batch update competency progress")}async function q(e,t){return 0===t.length?[]:P(async()=>{const r=(new Date).toISOString(),s=t.map(t=>({user_id:e,skill_id:t.skillId,mastery_level:t.masteryLevel,attempts:t.attempts,successes:t.successes,avg_response_time_ms:t.avgResponseTime,ease_factor:t.srsParams.easeFactor,interval_days:t.srsParams.interval,repetition_count:t.srsParams.repetitionCount,last_practiced_at:r,next_review_at:t.nextReview.toISOString()})),{data:i,error:n}=await I.from("skills_progress").upsert(s,{onConflict:"user_id,skill_id"}).select();if(n)throw n;return(i??[]).map(D)},"batch update skill progress")}async function N(e){return P(async()=>{const t={user_id:e.userId,session_id:e.sessionId,template_id:e.templateId,competency_area_id:e.competencyAreaId,skill_id:e.skillId,difficulty:e.difficulty,is_binding:e.isBinding,correct:e.correct,time_spent_seconds:e.timeSpentSeconds,hints_used:e.hintsUsed,user_answer:e.userAnswer},{data:r,error:s}=await I.from("exercise_history").insert(t).select().single();if(s)throw s;return L(r)},"log exercise attempt")}async function F(e,t,r){return P(async()=>{const s={user_id:e,grade_range:t,competency_area_id:r,started_at:(new Date).toISOString()},{data:i,error:n}=await I.from("sessions").insert(s).select().single();if(n)throw n;return E(i)},"start session")}async function Y(e,t,r){return P(async()=>{const s={total_exercises:t,correct_count:r},{data:i,error:n}=await I.from("sessions").update(s).eq("id",e).select().single();if(n)throw n;return E(i)},"update session")}async function J(e,t,r,s){return P(async()=>{const i={ended_at:(new Date).toISOString(),total_exercises:t,correct_count:r,avg_time_per_exercise_seconds:Math.round(s)},{data:n,error:a}=await I.from("sessions").update(i).eq("id",e).select().single();if(a)throw a;return E(n)},"end session")}var X=b('<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-2">'),W=b('<div class=mb-8><h2 class="mb-4 text-2xl font-bold text-gray-900"></h2><!$><!/>'),Z=b('<div class="rounded-lg border-2 border-red-200 bg-red-50 p-4"><h3 class="mb-3 text-sm font-semibold text-red-900"><!$><!/> (<!$><!/>)</h3><div class=space-y-2>'),z=b('<div class="rounded-lg border border-yellow-200 bg-yellow-50 p-4"><h3 class="mb-3 text-sm font-semibold text-yellow-900"><!$><!/> (<!$><!/>)</h3><div class=space-y-2>'),G=b('<div class="rounded-lg border border-blue-200 bg-blue-50 p-4"><h3 class="mb-3 text-sm font-semibold text-blue-900"><!$><!/> (<!$><!/>)</h3><div class=space-y-2>'),V=b("<div class=space-y-4><!$><!/><!$><!/><!$><!/>"),H=b('<div><h2 class="mb-4 text-2xl font-bold text-gray-900"></h2><!$><!/>'),K=b('<div class="mx-auto max-w-7xl px-4 py-8"><div class=mb-8><h1 class="text-3xl font-bold text-gray-900"></h1><p class="mt-2 text-gray-600"></p></div><!$><!/>'),Q=b('<div class="rounded-lg border-2 border-red-200 bg-red-50 p-6 text-center"><p class="text-lg font-semibold text-red-800"></p><p class="mt-2 text-sm text-red-600"></p><button class="mt-4 rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700">'),ee=b('<div class="text-center py-12"><div class="inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"></div><p class="mt-4 text-gray-600">'),te=b('<p class="mt-2 text-sm opacity-75">'),re=b('<p class="mt-4 text-sm font-medium">'),se=b('<div class="mb-8 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 p-6 text-white shadow-lg"><div class="flex items-center justify-between"><div><p class="text-sm font-medium opacity-90"></p><p class="mt-1 text-3xl font-bold"></p><!$><!/></div><div class=text-6xl></div></div><!$><!/><!$><!/>'),ie=b('<div class="rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-8 text-center"><p class=text-gray-600></p><p class="mt-2 text-sm text-gray-500">'),ne=b("<div class=space-y-3>"),ae=b('<div class="border-t border-gray-200 bg-gray-50 p-6"><h4 class="mb-4 text-sm font-semibold text-gray-700"></h4><!$><!/>'),le=b('<div class="rounded-lg border border-gray-200 bg-white shadow-sm transition-shadow hover:shadow-md"><div class=p-6><div class="flex items-start justify-between"><div class=flex-1><h3 class="text-lg font-semibold text-gray-900"></h3><div class="mt-2 flex items-center gap-2"><div class=flex-1><div class="h-3 overflow-hidden rounded-full bg-gray-200"><div class="h-full transition-all duration-300"></div></div></div><span class="text-sm font-medium text-gray-700"><!$><!/>%</span></div><div class="mt-3 flex items-center gap-2"><span class="inline-block rounded-full px-3 py-1 text-xs font-medium text-white"></span></div></div></div><div class="mt-4 grid grid-cols-2 gap-4 text-sm"><div><p class=text-gray-500></p><p class="font-semibold text-gray-900"></p></div><div><p class=text-gray-500></p><p class="font-semibold text-gray-900"><!$><!/>%</p></div></div><div class="mt-3 text-xs text-gray-500"><!$><!/>: <!$><!/></div><button class="mt-4 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"></button></div><!$><!/>'),oe=b('<p class="text-sm text-gray-500">'),de=b('<p class="mt-1 text-xs text-gray-500">'),ce=b('<div class="rounded-md bg-white p-3"><div class="flex items-center justify-between mb-2"><span class="text-sm font-medium text-gray-900"></span><span class="text-sm text-gray-600"><!$><!/>%</span></div><div class="h-2 overflow-hidden rounded-full bg-gray-200"><div class="h-full transition-all duration-300"></div></div><!$><!/>'),ge=b('<div class="text-center py-8"><p class=text-gray-600>'),me=b('<div class="rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-8 text-center"><p class=text-gray-600>'),ue=b('<div class="flex items-center justify-between rounded-md bg-white p-3"><div><p class="text-sm font-medium text-gray-900"></p><p class="text-xs text-red-600"></p></div><button class="rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700">'),pe=b('<div class="flex items-center justify-between rounded-md bg-white p-3"><div><p class="text-sm font-medium text-gray-900"></p><p class="text-xs text-gray-600"></p></div><button class="rounded-md bg-yellow-600 px-4 py-2 text-sm font-medium text-white hover:bg-yellow-700">'),xe=b('<div class="flex items-center justify-between rounded-md bg-white p-3"><div><p class="text-sm font-medium text-gray-900"></p><p class="text-xs text-gray-600">');const be=t=>{const b=r(e),[S,C]=s(null),[k]=i(async()=>{const[e,r,s]=await Promise.all([j(t.userId),B(t.userId),U(t.userId,1e3)]);return{competencies:e,skills:r,exerciseHistory:s}}),[I]=i(async()=>await w(t.userId,10)),$=e=>{const t=k();return t?t.skills.filter(t=>t.skillId.startsWith(e)):[]},A=e=>{if(!e)return b()("progress.competencyCard.notPracticedYet");const t=(new Date).getTime()-e.getTime(),r=Math.floor(t/864e5);if(0===r)return b()("common.time.justNow");if(1===r)return`1 ${b()("common.time.days")} ${b()("common.time.ago")}`;if(r<7)return`${r} ${b()("common.time.days")} ${b()("common.time.ago")}`;const s=Math.floor(r/7);if(1===s)return`1 ${b()("common.time.weeks")} ${b()("common.time.ago")}`;if(s<4)return`${s} ${b()("common.time.weeks")} ${b()("common.time.ago")}`;return`${Math.floor(r/30)} ${b()("common.time.months")} ${b()("common.time.ago")}`};return n(x,{fallback:e=>{return t=a(Q),r=t.firstChild,s=r.nextSibling,i=s.nextSibling,o(r,()=>b()("progress.errors.loadFailed")),o(s,()=>String(e)),i.$$click=()=>window.location.reload(),o(i,()=>b()("progress.errors.tryAgain")),p(),t;var t,r,s,i},get children(){var e=a(K),t=e.firstChild,r=t.firstChild,s=r.nextSibling,i=t.nextSibling,[x,w]=l(i.nextSibling);return o(r,()=>b()("progress.dashboard.title")),o(s,()=>b()("progress.dashboard.subtitle")),o(e,n(d,{get fallback(){return e=a(ee),t=e.firstChild.nextSibling,o(t,()=>b()("progress.loading.progress")),e;var e,t},get children(){return[n(c,{get when(){return(()=>{const e=k();return e?_(e.exerciseHistory):null})()},children:e=>(()=>{var t,r=a(se),s=r.firstChild,i=s.firstChild,d=i.firstChild,m=d.nextSibling,u=m.nextSibling,[p,x]=l(u.nextSibling),h=i.nextSibling,f=s.nextSibling,[v,y]=l(f.nextSibling),_=v.nextSibling,[w,S]=l(_.nextSibling);return o(d,()=>b()("progress.sections.streak")),o(m,(t=g(()=>e().currentStreak>0),()=>t()?b()("progress.streak.current",{count:e().currentStreak}):b()("progress.streak.noStreak"))),o(i,n(c,{get when(){return e().lastPracticeDate},get children(){var t=a(te);return o(t,()=>b()("progress.streak.lastPracticed",{date:A(e().lastPracticeDate)})),t}}),p,x),o(h,()=>e().currentStreak>=7?"ðŸ”¥":"â­"),o(r,n(c,{get when(){return g(()=>e().currentStreak>0)()&&e().isAtRisk},get children(){var e=a(re);return o(e,()=>b()("progress.streak.keepItGoing")),e}}),v,y),o(r,n(c,{get when(){return 0===e().currentStreak},get children(){var e=a(re);return o(e,()=>b()("progress.streak.practiceToday")),e}}),w,S),r})()}),(()=>{var e=a(W),t=e.firstChild,r=t.nextSibling,[s,i]=l(r.nextSibling);return o(t,()=>b()("progress.sections.competencies")),o(e,n(c,{get when(){return k()?.competencies.length??!1},get fallback(){return e=a(ie),t=e.firstChild,r=t.nextSibling,o(t,()=>b()("progress.empty.noCompetencies")),o(r,()=>b()("progress.empty.startPracticing")),e;var e,t,r},get children(){var e=a(X);return o(e,n(m,{get each(){return k()?.competencies},children:e=>{const t=()=>v(e.masteryLevel),r=()=>S()===e.competencyAreaId;return(()=>{var s=a(le),i=s.firstChild,d=i.firstChild,x=d.firstChild.firstChild,_=x.nextSibling,w=_.firstChild,S=w.firstChild.firstChild,k=w.nextSibling,I=k.firstChild,[P,R]=l(I.nextSibling);P.nextSibling;var D=_.nextSibling.firstChild,L=d.nextSibling,E=L.firstChild,j=E.firstChild,M=j.nextSibling,B=E.nextSibling.firstChild,O=B.nextSibling,U=O.firstChild,[T,q]=l(U.nextSibling);T.nextSibling;var N,F=L.nextSibling,Y=F.firstChild,[J,X]=l(Y.nextSibling),W=J.nextSibling.nextSibling,[Z,z]=l(W.nextSibling),G=F.nextSibling,V=i.nextSibling,[H,K]=l(V.nextSibling);return o(x,()=>e.competencyAreaId),o(k,()=>e.masteryLevel,P,R),o(D,()=>b()(`progress.masteryLevels.${t().level}`)),o(j,()=>b()("progress.competencyCard.attemptsLabel")),o(M,()=>e.totalAttempts),o(B,()=>b()("progress.competencyCard.successRateLabel")),o(O,()=>e.successRate.toFixed(1),T,q),o(F,()=>b()("progress.competencyCard.lastPracticedLabel"),J,X),o(F,()=>A(e.lastPracticed),Z,z),G.$$click=()=>{return t=e.competencyAreaId,void C(e=>e===t?null:t);var t},o(G,(N=g(()=>!!r()),()=>N()?b()("progress.competencyCard.hideSkills"):b()("progress.competencyCard.viewSkills"))),o(s,n(c,{get when(){return r()},get children(){var t=a(ae),r=t.firstChild,s=r.nextSibling,[i,d]=l(s.nextSibling);return o(r,()=>b()("progress.sections.skills")),o(t,n(c,{get when(){return $(e.competencyAreaId).length>0},get fallback(){return e=a(oe),o(e,()=>b()("progress.skillsBreakdown.noSkillsYet")),e;var e},get children(){var t=a(ne);return o(t,n(m,{get each(){return $(e.competencyAreaId)},children:e=>{const t=()=>v(e.masteryLevel);return(()=>{var r=a(ce),s=r.firstChild,i=s.firstChild,d=i.nextSibling,g=d.firstChild,[m,p]=l(g.nextSibling);m.nextSibling;var x=s.nextSibling,f=x.firstChild,v=x.nextSibling,[_,w]=l(v.nextSibling);return o(i,()=>e.skillId),o(d,()=>e.masteryLevel,m,p),o(r,n(c,{get when(){return e.nextReview},get children(){var t=a(de);return o(t,()=>b()("progress.skillsBreakdown.nextReview",{date:y(e.nextReview)})),t}}),_,w),u(r=>{var s=`${e.masteryLevel}%`,i="red"===t().colorCode?"#dc2626":"yellow"===t().colorCode?"#fbbf24":"light-green"===t().colorCode?"#86efac":"green"===t().colorCode?"#16a34a":"#3b82f6";return s!==r.e&&h(f,"width",r.e=s),i!==r.t&&h(f,"background-color",r.t=i),r},{e:void 0,t:void 0}),r})()}})),t}}),i,d),t}}),H,K),u(s=>{var i=`${e.masteryLevel}%`,n="red"===t().colorCode?"#dc2626":"yellow"===t().colorCode?"#fbbf24":"light-green"===t().colorCode?"#86efac":"green"===t().colorCode?"#16a34a":"#3b82f6",a="red"===t().colorCode?"#dc2626":"yellow"===t().colorCode?"#fbbf24":"light-green"===t().colorCode?"#86efac":"green"===t().colorCode?"#16a34a":"#3b82f6",l=r();return i!==s.e&&h(S,"width",s.e=i),n!==s.t&&h(S,"background-color",s.t=n),a!==s.a&&h(D,"background-color",s.a=a),l!==s.o&&f(G,"aria-expanded",s.o=l),s},{e:void 0,t:void 0,a:void 0,o:void 0}),p(),s})()}})),e}}),s,i),e})(),(()=>{var e=a(H),t=e.firstChild,r=t.nextSibling,[s,i]=l(r.nextSibling);return o(t,()=>b()("progress.reviews.title")),o(e,n(d,{get fallback(){return e=a(ge),t=e.firstChild,o(t,()=>b()("progress.loading.reviews")),e;var e,t},get children(){return n(c,{get when(){return I()?.total??!1},get fallback(){return e=a(me),t=e.firstChild,o(t,()=>b()("progress.reviews.noReviews")),e;var e,t},get children(){var e=a(V),t=e.firstChild,[r,s]=l(t.nextSibling),i=r.nextSibling,[d,g]=l(i.nextSibling),u=d.nextSibling,[p,x]=l(u.nextSibling);return o(e,n(c,{get when(){return(I()?.overdue.length??0)>0},get children(){var e=a(Z),t=e.firstChild,r=t.firstChild,[s,i]=l(r.nextSibling),d=s.nextSibling.nextSibling,[c,g]=l(d.nextSibling);c.nextSibling;var u=t.nextSibling;return o(t,()=>b()("progress.reviews.overdue"),s,i),o(t,()=>I()?.overdue.length,c,g),o(u,n(m,{get each(){return I()?.overdue},children:e=>{return t=a(ue),r=t.firstChild,s=r.firstChild,i=s.nextSibling,n=r.nextSibling,o(s,()=>e.skillId),o(i,()=>b()("progress.reviews.overdueBy",{days:e.daysOverdue??0})),o(n,()=>b()("progress.reviews.practiceNow")),t;var t,r,s,i,n}})),e}}),r,s),o(e,n(c,{get when(){return(I()?.today.length??0)>0},get children(){var e=a(z),t=e.firstChild,r=t.firstChild,[s,i]=l(r.nextSibling),d=s.nextSibling.nextSibling,[c,g]=l(d.nextSibling);c.nextSibling;var u=t.nextSibling;return o(t,()=>b()("progress.reviews.dueToday"),s,i),o(t,()=>I()?.today.length,c,g),o(u,n(m,{get each(){return I()?.today},children:e=>{return t=a(pe),r=t.firstChild,s=r.firstChild,i=s.nextSibling,n=r.nextSibling,o(s,()=>e.skillId),o(i,()=>v(e.masteryLevel).level),o(n,()=>b()("progress.reviews.practiceNow")),t;var t,r,s,i,n}})),e}}),d,g),o(e,n(c,{get when(){return(I()?.thisWeek.length??0)>0},get children(){var e=a(G),t=e.firstChild,r=t.firstChild,[s,i]=l(r.nextSibling),d=s.nextSibling.nextSibling,[c,g]=l(d.nextSibling);c.nextSibling;var u=t.nextSibling;return o(t,()=>b()("progress.reviews.dueThisWeek"),s,i),o(t,()=>I()?.thisWeek.length,c,g),o(u,n(m,{get each(){return I()?.thisWeek},children:e=>{return t=a(xe),r=t.firstChild.firstChild,s=r.nextSibling,o(r,()=>e.skillId),o(s,()=>b()("progress.reviews.dueOn",{date:y(e.nextReviewAt)})),t;var t,r,s}})),e}}),p,x),e}})}}),s,i),e})()]}}),x,w),e}})};t(["click"]);export{be as P,O as a,T as b,q as c,F as d,J as e,M as f,N as l,I as s,Y as u};
