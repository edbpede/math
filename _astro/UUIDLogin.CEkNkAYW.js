import{d as ye,c as p,o as Ce,g as $,a as j,i as a,s as g,b as E,e as B,r as Ee,t as _,f as z,h as D,S as k,m as De}from"./store.C-Iyz76Y.js";import{m as ke,$ as Le}from"./store.BEcAnxVL.js";import{v as V}from"./uuid.BUVVKM1U.js";var Ie=_('<div id=uuid-error class="mt-2 text-sm text-red-700"role=alert aria-live=polite>'),Me=_('<div class="flex items-center justify-center gap-3"><div class="w-5 h-5 border-3 border-white border-t-transparent rounded-full animate-spin"aria-hidden=true></div><span>'),Te=_('<div role=region><div class="login-container max-w-md mx-auto"><div class="text-center mb-6"><h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2"></h2><p class="text-base text-gray-600"></p></div><form novalidate><div class="form-group mb-4"><label for=uuid-input class="block text-sm font-medium text-gray-700 mb-2"></label><input type=text id=uuid-input autocomplete=off autocorrect=off autocapitalize=off maxlength=19><!$><!/></div><div class="form-group mb-6"><label class="flex items-center gap-3 cursor-pointer select-none"><input type=checkbox class="w-5 h-5 min-w-44px min-h-44px text-blue-600 border-2 border-gray-300 rounded focus:ring-4 focus:ring-blue-300 cursor-pointer"><span class="text-sm font-medium text-gray-700"></span></label></div><!$><!/><!$><!/><button type=submit></button></form><div class="mt-6 text-center text-sm text-gray-600"><span></span><a href=/generate class="text-blue-600 hover:text-blue-700 font-medium underline focus:outline-none focus:ring-2 focus:ring-blue-300 rounded"></a><span>'),Ue=_('<div class="mt-1 text-xs text-red-800">'),Re=_('<div class="error-banner mb-4 p-4 bg-red-100 border-2 border-red-400 rounded-lg"role=alert aria-live=assertive><div class="flex items-start gap-3"><svg class="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-red-900"></div><!$><!/>'),Ae=_('<div class="rate-limit-banner mb-4 p-4 bg-orange-100 border-2 border-orange-400 rounded-lg"role=alert aria-live=assertive><div class="flex items-start gap-3"><svg class="w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-orange-900">');const W="math-remember-uuid",L=5,oe=6e4;function je(X){const r=ke(Le),[o,b]=p({status:"idle"}),[I,H]=p(""),[J,K]=p(!1),[S,w]=p(null),[Y,M]=p(0),[T,U]=p(null);Ce(()=>{try{const t=localStorage.getItem(W);t&&V(t)&&(H(t),K(!0))}catch(t){console.error("Error reading from localStorage:",t)}});const q=t=>{w(null);const n=t.replace(/[^0-9a-fA-F]/g,"").substring(0,16);let s="";for(let i=0;i<n.length;i++)i>0&&i%4===0&&(s+="-"),s+=n[i];H(s)},de=t=>{t.preventDefault();const d=t.clipboardData?.getData("text")||"";q(d)},ue=()=>{const t=I().trim();t&&!V(t)&&w(r()("auth.login.invalidFormat"))},ce=()=>{const t=Date.now(),d=T();if(d&&t>d)M(1),U(t+oe);else{const n=Y()+1;if(M(n),d||U(t+oe),n>=L){const s=(T()||t)-t,i=Math.ceil(s/1e3);b({status:"rateLimited",remainingSeconds:i,attemptsRemaining:0}),G()}}},G=()=>{const t=setInterval(()=>{const d=Date.now(),n=T();if(!n||d>n)M(0),U(null),b({status:"idle"}),clearInterval(t);else{const s=n-d,i=Math.ceil(s/1e3);b({status:"rateLimited",remainingSeconds:i,attemptsRemaining:0})}},1e3)},me=async t=>{if(t.preventDefault(),o().status==="rateLimited")return;const n=I().trim();if(!n){w(r()("auth.login.invalidFormat"));return}if(!V(n)){w(r()("auth.login.invalidFormat"));return}w(null),b({status:"submitting"});try{const s=await fetch("/api/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:n})}),i=await s.json();if(s.status===429){const l=i.resetAt||Date.now()+(i.retryAfter||60)*1e3,R=i.retryAfter||Math.ceil((l-Date.now())/1e3);U(l),M(L),b({status:"rateLimited",remainingSeconds:R,attemptsRemaining:0}),G();return}if(!i.success){ce();let l=i.error;i.code==="INVALID_UUID_FORMAT"?l=r()("auth.login.invalidFormat"):i.code==="UUID_NOT_FOUND"&&(l=r()("auth.login.notFound")),b({status:"error",message:l,code:i.code});return}if(J())try{localStorage.setItem(W,n)}catch(l){console.error("Error saving to localStorage:",l)}else try{localStorage.removeItem(W)}catch(l){console.error("Error removing from localStorage:",l)}const h=X.redirectTo||"/dashboard";window.location.href=h}catch(s){console.error("Error during login:",s),b({status:"error",message:r()("common.errors.unexpected"),code:"UNEXPECTED_ERROR"})}},P=()=>{const t=T();return!t||Date.now()>t?L:Math.max(0,L-Y())},Q=()=>{const t=o();return t.status==="submitting"||t.status==="rateLimited"||!I().trim()};return(()=>{var t=$(Te),d=t.firstChild,n=d.firstChild,s=n.firstChild,i=s.nextSibling,h=n.nextSibling,l=h.firstChild,R=l.firstChild,u=R.nextSibling,ge=u.nextSibling,[be,he]=j(ge.nextSibling),Z=l.nextSibling,ve=Z.firstChild,y=ve.firstChild,fe=y.nextSibling,xe=Z.nextSibling,[ee,pe]=j(xe.nextSibling),$e=ee.nextSibling,[te,_e]=j($e.nextSibling),A=te.nextSibling,Se=h.nextSibling,re=Se.firstChild,ie=re.nextSibling,we=ie.nextSibling;return a(s,()=>r()("auth.login.title")),a(i,()=>r()("auth.login.subtitle")),h.addEventListener("submit",me),a(R,()=>r()("auth.uuid.title")),u.addEventListener("blur",ue),u.addEventListener("paste",de),u.$$input=e=>q(e.currentTarget.value),g(u,"spellcheck",!1),a(l,E(k,{get when(){return S()},get children(){var e=$(Ie);return a(e,S),e}}),be,he),y.addEventListener("change",e=>K(e.currentTarget.checked)),a(fe,()=>r()("auth.login.rememberDevice")),a(h,E(k,{get when(){return o().status==="error"},children:e=>(()=>{var c=$(Re),m=c.firstChild,x=m.firstChild,v=x.nextSibling,f=v.firstChild,F=f.nextSibling,[N,O]=j(F.nextSibling);return a(f,()=>e().message),a(v,E(k,{get when(){return De(()=>P()>0)()&&P()<L},get children(){var C=$(Ue);return a(C,()=>r()("auth.login.attemptsRemaining",{count:P()})),C}}),N,O),c})()}),ee,pe),a(h,E(k,{get when(){return o().status==="rateLimited"},children:e=>(()=>{var c=$(Ae),m=c.firstChild,x=m.firstChild,v=x.nextSibling,f=v.firstChild;return a(f,()=>r()("auth.login.rateLimitExceeded",{seconds:e().remainingSeconds})),c})()}),te,_e),a(A,E(k,{get when(){return o().status==="submitting"},get fallback(){return r()("auth.login.submit")},get children(){var e=$(Me),c=e.firstChild,m=c.nextSibling;return a(m,()=>r()("common.status.loading")),e}})),a(re,()=>r()("auth.login.newUser").split("{{link}}")[0]),a(ie,()=>r()("auth.login.newUserLink")),a(we,()=>r()("auth.login.newUser").split("{{link}}")[1]||""),B(e=>{var c=`uuid-login ${X.class||""}`,m=r()("auth.login.title"),x=r()("auth.login.placeholder"),v=r()("auth.uuid.title"),f=!!S(),F=S()?"uuid-error":void 0,N=o().status==="submitting"||o().status==="rateLimited",O=`
                w-full px-4 py-3 text-lg font-mono tracking-wider text-center
                border-2 rounded-lg shadow-sm
                focus:outline-none focus:ring-4 focus:ring-blue-300
                transition-all duration-200
                min-h-44px
                ${S()||o().status==="error"?"border-red-400 bg-red-50 text-red-900":"border-gray-300 bg-white text-gray-900 hover:border-blue-400"}
                ${o().status==="submitting"||o().status==="rateLimited"?"opacity-60 cursor-not-allowed":""}
              `,C=o().status==="submitting"||o().status==="rateLimited",ne=r()("auth.login.rememberDevice"),ae=Q(),se=`
              w-full px-6 py-4 text-lg font-bold rounded-lg shadow-lg
              transition-all duration-200
              focus:outline-none focus:ring-4 focus:ring-blue-300
              min-h-44px
              ${Q()?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-60":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"}
            `,le=o().status==="submitting"?r()("common.status.loading"):r()("auth.login.submit");return c!==e.e&&z(t,e.e=c),m!==e.t&&g(t,"aria-label",e.t=m),x!==e.a&&g(u,"placeholder",e.a=x),v!==e.o&&g(u,"aria-label",e.o=v),f!==e.i&&g(u,"aria-invalid",e.i=f),F!==e.n&&g(u,"aria-describedby",e.n=F),N!==e.s&&D(u,"disabled",e.s=N),O!==e.h&&z(u,e.h=O),C!==e.r&&D(y,"disabled",e.r=C),ne!==e.d&&g(y,"aria-label",e.d=ne),ae!==e.l&&D(A,"disabled",e.l=ae),se!==e.u&&z(A,e.u=se),le!==e.c&&g(A,"aria-label",e.c=le),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0}),B(()=>D(u,"value",I())),B(()=>D(y,"checked",J())),Ee(),t})()}ye(["input"]);export{je as default};
