import{s as e,o as n}from"./offline.Be4NG-P-.js";import{c as t,a}from"./solid-core.DXeZPQOr.js";const s=a({online:"undefined"==typeof navigator||navigator.onLine,lastChanged:new Date}),o=a({syncing:!1,queueCount:0,lastSyncTime:null,error:null,lastSyncedCount:0});async function i(){if(await e.initialize(),r(),await c(),e.addEventListener(u),"undefined"!=typeof window&&setInterval(async()=>{const n=await e.getQueueCount();o.set({...o.get(),queueCount:n})},5e3),"undefined"!=typeof window)try{const e=await n.getPreference("lastSyncTime");e&&"string"==typeof e&&o.set({...o.get(),lastSyncTime:new Date(e)})}catch(t){}}function r(){const n=e.getOnlineStatus();s.set({online:n,lastChanged:new Date})}async function c(){const n=e.getSyncingStatus(),t=await e.getQueueCount();o.set({...o.get(),syncing:n,queueCount:t})}function u(e){switch(e.type){case"network-change":r(),c();break;case"sync-start":o.set({...o.get(),syncing:!0,error:null});break;case"sync-success":o.set({...o.get(),syncing:!1,error:null,lastSyncTime:e.timestamp,lastSyncedCount:e.itemsSynced??0}),async function(e){try{await n.setPreference("lastSyncTime",e.toISOString())}catch(t){}}(e.timestamp);break;case"sync-error":o.set({...o.get(),syncing:!1,error:e.error??"Unknown error"});break;case"sync-complete":o.set({...o.get(),syncing:!1,queueCount:e.queueCount??0})}}async function y(){if(!s.get().online)throw new Error("Cannot sync while offline");return await e.manualSync()}function l(){const{lastSyncTime:e}=o.get();if(!e)return"Never";const n=(new Date).getTime()-e.getTime(),t=Math.floor(n/1e3),a=Math.floor(t/60),s=Math.floor(a/60),i=Math.floor(s/24);return t<60?"Just now":a<60?`${a} minute${a>1?"s":""} ago`:s<24?`${s} hour${s>1?"s":""} ago`:`${i} day${i>1?"s":""} ago`}t(s,e=>e.online?"online":"offline"),t(o,e=>e.syncing?"syncing":e.error?"error":e.queueCount>0?"pending":e.lastSyncTime?"synced":"idle");export{s as $,o as a,l as g,i,y as t};
