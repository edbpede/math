const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/ToastNotification.8BzCrt3X.js","_astro/solid-core.DXeZPQOr.js","_astro/exercises.CmwZ4dJn.js","_astro/island-practice.Crw8XKdE.js"])))=>i.map(i=>d[i]);
import{$ as t,_ as e}from"./exercises.CmwZ4dJn.js";import{s as n,o as s}from"./offline.Bc__k3kr.js";import{c as o,a}from"./solid-core.DXeZPQOr.js";import"./idb.B3QPy4uZ.js";import"./island-dashboard.Bt_Br7pH.js";import"./mastery.BYaRoLpV.js";import"./supabase.BYn26wLR.js";import"./vendor.CmgFkl6N.js";import"./qrcode.B15vZz8I.js";const i=a({online:"undefined"==typeof navigator||navigator.onLine,lastChanged:new Date}),r=a({syncing:!1,queueCount:0,lastSyncTime:null,error:null,lastSyncedCount:0});async function c(){if(await n.initialize(),u(),await y(),n.addEventListener(f),"undefined"!=typeof window&&setInterval(async()=>{const t=await n.getQueueCount();r.set({...r.get(),queueCount:t})},5e3),"undefined"!=typeof window)try{const t=await s.getPreference("lastSyncTime");t&&"string"==typeof t&&r.set({...r.get(),lastSyncTime:new Date(t)})}catch(t){}}function u(){const t=n.getOnlineStatus();i.set({online:t,lastChanged:new Date})}async function y(){const t=n.getSyncingStatus(),e=await n.getQueueCount();r.set({...r.get(),syncing:t,queueCount:e})}function f(o){switch(o.type){case"network-change":if(u(),y(),"undefined"!=typeof window){const s=n.getOnlineStatus(),o=t.get();e(async()=>{const{toast:t}=await import("./ToastNotification.8BzCrt3X.js");return{toast:t}},__vite__mapDeps([0,1,2,3])).then(({toast:t})=>{s?t.info(o("sync.messages.connectionRestored"),3e3):t.warning(o("sync.messages.connectionLost"),5e3)}).catch(t=>{})}break;case"sync-start":r.set({...r.get(),syncing:!0,error:null});break;case"sync-success":if(r.set({...r.get(),syncing:!1,error:null,lastSyncTime:o.timestamp,lastSyncedCount:o.itemsSynced??0}),async function(t){try{await s.setPreference("lastSyncTime",t.toISOString())}catch(e){}}(o.timestamp),"undefined"!=typeof window&&o.itemsSynced&&o.itemsSynced>0){const n=t.get();e(async()=>{const{toast:t}=await import("./ToastNotification.8BzCrt3X.js");return{toast:t}},__vite__mapDeps([0,1,2,3])).then(({toast:t})=>{t.success(n("sync.messages.syncSuccess",{count:o.itemsSynced?.toString()??"0"}),3e3)}).catch(t=>{})}break;case"sync-error":if(r.set({...r.get(),syncing:!1,error:o.error??"Unknown error"}),"undefined"!=typeof window){const n=t.get();e(async()=>{const{toast:t}=await import("./ToastNotification.8BzCrt3X.js");return{toast:t}},__vite__mapDeps([0,1,2,3])).then(({toast:t})=>{t.error(o.error??n("sync.errors.syncFailed"),7e3)}).catch(t=>{})}break;case"item-retry":if("undefined"!=typeof window&&o.retryAttempt){const n=t.get();e(async()=>{const{toast:t}=await import("./ToastNotification.8BzCrt3X.js");return{toast:t}},__vite__mapDeps([0,1,2,3])).then(({toast:t})=>{const e=Math.round((o.nextRetryDelayMs??0)/1e3);t.warning(n("sync.messages.syncFailedWithRetry",{seconds:e.toString()}),5e3)}).catch(t=>{})}break;case"sync-complete":r.set({...r.get(),syncing:!1,queueCount:o.queueCount??0})}}async function g(){if(!i.get().online)throw new Error("Cannot sync while offline");return await n.manualSync()}function d(){const{lastSyncTime:t}=r.get();if(!t)return"Never";const e=(new Date).getTime()-t.getTime(),n=Math.floor(e/1e3),s=Math.floor(n/60),o=Math.floor(s/60),a=Math.floor(o/24);return n<60?"Just now":s<60?`${s} minute${s>1?"s":""} ago`:o<24?`${o} hour${o>1?"s":""} ago`:`${a} day${a>1?"s":""} ago`}o(i,t=>t.online?"online":"offline"),o(r,t=>t.syncing?"syncing":t.error?"error":t.queueCount>0?"pending":t.lastSyncTime?"synced":"idle");export{i as $networkStatus,r as $syncStatus,d as getTimeSinceLastSync,c as initializeStatusStores,g as triggerManualSync};
