import{d as t,m as e,b as i,C as r,g as n,h as a,i as s,n as l,f as o,l as d,r as u,t as c,w as g,A as m,j as b,k as h}from"./solid-core.DXeZPQOr.js";import{$ as f}from"./exercises.DgCluh1K.js";import{v}from"./island-settings.CeeMt4Rk.js";var x=c('<div id=uuid-error class="mt-2 text-sm text-red-700"role=alert aria-live=polite>'),p=c('<div class="mt-1 text-xs text-red-800">'),w=c('<div class="error-banner mb-4 p-4 bg-red-100 border-2 border-red-400 rounded-lg"role=alert aria-live=assertive><div class="flex items-start gap-3"><svg class="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-red-900"></div><!$><!/>'),y=c('<div class="rate-limit-banner mb-4 p-4 bg-orange-100 border-2 border-orange-400 rounded-lg"role=alert aria-live=assertive><div class="flex items-start gap-3"><svg class="w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-orange-900">'),S=c('<div class="flex items-center justify-center gap-3"><div class="w-5 h-5 border-3 border-white border-t-transparent rounded-full animate-spin"aria-hidden=true></div><span>'),k=c('<div role=region><div class="login-container max-w-md mx-auto"><div class="text-center mb-6"><h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2"></h2><p class="text-base text-gray-600"></p></div><form novalidate><div class="form-group mb-4"><label for=uuid-input class="block text-sm font-medium text-gray-700 mb-2"></label><input type=text id=uuid-input autocomplete=off autocorrect=off autocapitalize=off maxlength=19><!$><!/></div><div class="form-group mb-6"><label class="flex items-center gap-3 cursor-pointer select-none"><input type=checkbox class="w-5 h-5 min-w-44px min-h-44px text-blue-600 border-2 border-gray-300 rounded focus:ring-4 focus:ring-blue-300 cursor-pointer"><span class="text-sm font-medium text-gray-700"></span></label></div><!$><!/><!$><!/><button type=submit></button></form><div class="mt-6 text-center text-sm text-gray-600"><span></span><a href=/generate class="text-blue-600 hover:text-blue-700 font-medium underline focus:outline-none focus:ring-2 focus:ring-blue-300 rounded"></a><span>');const C="math-remember-uuid";function L(t){const c=e(f),[L,D]=i({status:"idle"}),[$,E]=i(""),[U,j]=i(!1),[I,A]=i(null),[F,M]=i(0),[R,T]=i(null);r(()=>{try{const t=localStorage.getItem(C);t&&v(t)&&(E(t),j(!0))}catch(t){}});const O=t=>{A(null);const e=t.replace(/[^0-9a-fA-F]/g,"").substring(0,16);let i="";for(let r=0;r<e.length;r++)r>0&&r%4==0&&(i+="-"),i+=e[r];E(i)},N=t=>{t.preventDefault();const e=t.clipboardData?.getData("text")||"";O(e)},_=()=>{const t=$().trim();t&&!v(t)&&A(c()("auth.login.invalidFormat"))},z=()=>{const t=setInterval(()=>{const e=Date.now(),i=R();if(!i||e>i)M(0),T(null),D({status:"idle"}),clearInterval(t);else{const t=i-e,r=Math.ceil(t/1e3);D({status:"rateLimited",remainingSeconds:r,attemptsRemaining:0})}},1e3)},B=async e=>{e.preventDefault();if("rateLimited"===L().status)return;const i=$().trim();if(i)if(v(i)){A(null),D({status:"submitting"});try{const e=await fetch("/api/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:i})}),n=await e.json();if(429===e.status){const t=!n.success&&n.resetAt?n.resetAt:Date.now()+1e3*(!n.success&&n.retryAfter||60),e=!n.success&&n.retryAfter||Math.ceil((t-Date.now())/1e3);return T(t),M(5),D({status:"rateLimited",remainingSeconds:e,attemptsRemaining:0}),void z()}if(!n.success){if((()=>{const t=Date.now(),e=R();if(e&&t>e)M(1),T(t+6e4);else{const i=F()+1;if(M(i),e||T(t+6e4),i>=5){const e=(R()||t)-t,i=Math.ceil(e/1e3);D({status:"rateLimited",remainingSeconds:i,attemptsRemaining:0}),z()}}})(),"rateLimited"===L().status)return;let t=n.error;return"INVALID_UUID_FORMAT"===n.code?t=c()("auth.login.invalidFormat"):"UUID_NOT_FOUND"===n.code&&(t=c()("auth.login.notFound")),void D({status:"error",message:t,code:n.code})}if(U())try{localStorage.setItem(C,i)}catch(r){}else try{localStorage.removeItem(C)}catch(r){}window.location.href=t.redirectTo??"/dashboard"}catch(r){D({status:"error",message:c()("common.errors.unexpected"),code:"UNEXPECTED_ERROR"})}}else A(c()("auth.login.invalidFormat"));else A(c()("auth.login.invalidFormat"))},P=()=>{const t=R();return!t||Date.now()>t?5:Math.max(0,5-F())},J=()=>{const t=L();return"submitting"===t.status||"rateLimited"===t.status||!$().trim()};return(()=>{var e=n(k),i=e.firstChild.firstChild,r=i.firstChild,f=r.nextSibling,v=i.nextSibling,C=v.firstChild,D=C.firstChild,E=D.nextSibling,A=E.nextSibling,[F,M]=a(A.nextSibling),R=C.nextSibling,T=R.firstChild.firstChild,z=T.nextSibling,V=R.nextSibling,[X,q]=a(V.nextSibling),G=X.nextSibling,[H,K]=a(G.nextSibling),Q=H.nextSibling,W=v.nextSibling.firstChild,Y=W.nextSibling,Z=Y.nextSibling;return s(r,()=>c()("auth.login.title")),s(f,()=>c()("auth.login.subtitle")),v.addEventListener("submit",B),s(D,()=>c()("auth.uuid.title")),E.addEventListener("blur",_),E.addEventListener("paste",N),E.$$input=t=>O(t.currentTarget.value),l(E,"spellcheck",!1),s(C,o(b,{get when(){return I()},get children(){var t=n(x);return s(t,I),t}}),F,M),T.addEventListener("change",t=>j(t.currentTarget.checked)),s(z,()=>c()("auth.login.rememberDevice")),s(v,o(b,{get when(){return"error"===L().status},get children(){var t=n(w),e=t.firstChild.firstChild.nextSibling,i=e.firstChild,r=i.nextSibling,[l,d]=a(r.nextSibling);return s(i,()=>{const t=L();return"error"===t.status?t.message:""}),s(e,o(b,{get when(){return h(()=>P()>0)()&&P()<5},get children(){var t=n(p);return s(t,()=>c()("auth.login.attemptsRemaining",{count:P()})),t}}),l,d),t}}),X,q),s(v,o(b,{get when(){return"rateLimited"===L().status},get children(){var t=n(y),e=t.firstChild.firstChild.nextSibling.firstChild;return s(e,()=>{const t=L(),e="rateLimited"===t.status?t.remainingSeconds:0;return c()("auth.login.rateLimitExceeded",{seconds:e})}),t}}),H,K),s(Q,o(b,{get when(){return"submitting"===L().status},get fallback(){return c()("auth.login.submit")},get children(){var t=n(S),e=t.firstChild.nextSibling;return s(e,()=>c()("common.status.loading")),t}})),s(W,()=>c()("auth.login.newUser").split("{{link}}")[0]),s(Y,()=>c()("auth.login.newUserLink")),s(Z,()=>c()("auth.login.newUser").split("{{link}}")[1]||""),d(i=>{var r=`uuid-login ${t.class||""}`,n=c()("auth.login.title"),a=c()("auth.login.title"),s=c()("auth.login.placeholder"),o=c()("auth.uuid.title"),d=!!I(),u=I()?"uuid-error":void 0,b="submitting"===L().status||"rateLimited"===L().status,h=`\n                w-full px-4 py-3 text-lg font-mono tracking-wider text-center\n                border-2 rounded-lg shadow-sm\n                focus:outline-none focus:ring-4 focus:ring-blue-300\n                transition-all duration-200\n                min-h-44px\n                ${I()||"error"===L().status?"border-red-400 bg-red-50 text-red-900":"border-gray-300 bg-white text-gray-900 hover:border-blue-400"}\n                ${"submitting"===L().status||"rateLimited"===L().status?"opacity-60 cursor-not-allowed":""}\n              `,f="submitting"===L().status||"rateLimited"===L().status,x=c()("auth.login.rememberDevice"),p=J(),w=`\n              w-full px-6 py-4 text-lg font-bold rounded-lg shadow-lg\n              transition-all duration-200\n              focus:outline-none focus:ring-4 focus:ring-blue-300\n              min-h-44px\n              ${J()?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-60":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"}\n            `,y="submitting"===L().status?c()("common.status.loading"):c()("auth.login.submit");return r!==i.e&&g(e,i.e=r),n!==i.t&&l(e,"aria-label",i.t=n),a!==i.a&&l(v,"aria-label",i.a=a),s!==i.o&&l(E,"placeholder",i.o=s),o!==i.i&&l(E,"aria-label",i.i=o),d!==i.n&&l(E,"aria-invalid",i.n=d),u!==i.s&&l(E,"aria-describedby",i.s=u),b!==i.h&&m(E,"disabled",i.h=b),h!==i.r&&g(E,i.r=h),f!==i.d&&m(T,"disabled",i.d=f),x!==i.l&&l(T,"aria-label",i.l=x),p!==i.u&&m(Q,"disabled",i.u=p),w!==i.c&&g(Q,i.c=w),y!==i.w&&l(Q,"aria-label",i.w=y),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0}),d(()=>m(E,"value",$())),d(()=>m(T,"checked",U())),u(),e})()}t(["input"]);export{L as U};
