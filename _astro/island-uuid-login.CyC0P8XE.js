import{d as t,f as e,m as i,b as r,C as n,g as a,t as s,h as o,i as l,n as d,j as u,k as c,l as g,w as m,A as h,r as b}from"./solid-core.DXeZPQOr.js";import{$ as f}from"./exercises.CmwZ4dJn.js";import{v}from"./island-settings.CRmBYshX.js";import{E as x}from"./island-practice.Crw8XKdE.js";var p=s('<div id=uuid-error class="mt-2 text-sm text-red-700"role=alert aria-live=polite>'),w=s('<div class="mt-1 text-xs text-red-800">'),y=s('<div class="error-banner mb-4 p-4 bg-red-100 border-2 border-red-400 rounded-lg"role=alert aria-live=assertive><div class="flex items-start gap-3"><svg class="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-red-900"></div><!$><!/>'),S=s('<div class="rate-limit-banner mb-4 p-4 bg-orange-100 border-2 border-orange-400 rounded-lg"role=alert aria-live=assertive><div class="flex items-start gap-3"><svg class="w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-orange-900">'),k=s('<div class="flex items-center justify-center gap-3"><div class="w-5 h-5 border-3 border-white border-t-transparent rounded-full animate-spin"aria-hidden=true></div><span>'),C=s('<div role=region><div class="login-container max-w-md mx-auto"><div class="text-center mb-6"><h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2"></h2><p class="text-base text-gray-600"></p></div><form novalidate><div class="form-group mb-4"><label for=uuid-input class="block text-sm font-medium text-gray-700 mb-2"></label><input type=text id=uuid-input autocomplete=off autocorrect=off autocapitalize=off maxlength=19><!$><!/></div><div class="form-group mb-6"><label class="flex items-center gap-3 cursor-pointer select-none"><input type=checkbox class="w-5 h-5 min-w-44px min-h-44px text-blue-600 border-2 border-gray-300 rounded focus:ring-4 focus:ring-blue-300 cursor-pointer"><span class="text-sm font-medium text-gray-700"></span></label></div><!$><!/><!$><!/><button type=submit></button></form><div class="mt-6 text-center text-sm text-gray-600"><span></span><a href=/generate class="text-blue-600 hover:text-blue-700 font-medium underline focus:outline-none focus:ring-2 focus:ring-blue-300 rounded"></a><span>');const L="math-remember-uuid",D=t=>{const s=i(f),[x,D]=r({status:"idle"}),[U,$]=r(""),[j,E]=r(!1),[I,F]=r(null),[M,A]=r(0),[R,T]=r(null);n(()=>{try{const t=localStorage.getItem(L);t&&v(t)&&($(t),E(!0))}catch(t){}});const N=t=>{F(null);const e=t.replace(/[^0-9a-fA-F]/g,"").substring(0,16);let i="";for(let r=0;r<e.length;r++)r>0&&r%4==0&&(i+="-"),i+=e[r];$(i)},O=t=>{t.preventDefault();const e=t.clipboardData?.getData("text")||"";N(e)},_=()=>{const t=U().trim();t&&!v(t)&&F(s()("auth.login.invalidFormat"))},z=()=>{const t=setInterval(()=>{const e=Date.now(),i=R();if(!i||e>i)A(0),T(null),D({status:"idle"}),clearInterval(t);else{const t=i-e,r=Math.ceil(t/1e3);D({status:"rateLimited",remainingSeconds:r,attemptsRemaining:0})}},1e3)},B=async e=>{e.preventDefault();if("rateLimited"===x().status)return;const i=U().trim();if(i)if(v(i)){F(null),D({status:"submitting"});try{const e=await fetch("/api/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:i})}),n=await e.json();if(429===e.status){const t=!n.success&&n.resetAt?n.resetAt:Date.now()+1e3*(!n.success&&n.retryAfter||60),e=!n.success&&n.retryAfter||Math.ceil((t-Date.now())/1e3);return T(t),A(5),D({status:"rateLimited",remainingSeconds:e,attemptsRemaining:0}),void z()}if(!n.success){if((()=>{const t=Date.now(),e=R();if(e&&t>e)A(1),T(t+6e4);else{const i=M()+1;if(A(i),e||T(t+6e4),i>=5){const e=(R()||t)-t,i=Math.ceil(e/1e3);D({status:"rateLimited",remainingSeconds:i,attemptsRemaining:0}),z()}}})(),"rateLimited"===x().status)return;let t=n.error;return"INVALID_UUID_FORMAT"===n.code?t=s()("auth.login.invalidFormat"):"UUID_NOT_FOUND"===n.code&&(t=s()("auth.login.notFound")),void D({status:"error",message:t,code:n.code})}if(j())try{localStorage.setItem(L,i)}catch(r){}else try{localStorage.removeItem(L)}catch(r){}window.location.href=t.redirectTo??"/dashboard"}catch(r){D({status:"error",message:s()("common.errors.unexpected"),code:"UNEXPECTED_ERROR"})}}else F(s()("auth.login.invalidFormat"));else F(s()("auth.login.invalidFormat"))},P=()=>{const t=R();return!t||Date.now()>t?5:Math.max(0,5-M())},G=()=>{const t=x();return"submitting"===t.status||"rateLimited"===t.status||!U().trim()};return(()=>{var i=a(C),r=i.firstChild.firstChild,n=r.firstChild,f=n.nextSibling,v=r.nextSibling,L=v.firstChild,D=L.firstChild,$=D.nextSibling,F=$.nextSibling,[M,A]=o(F.nextSibling),R=L.nextSibling,T=R.firstChild.firstChild,z=T.nextSibling,H=R.nextSibling,[J,K]=o(H.nextSibling),V=J.nextSibling,[X,q]=o(V.nextSibling),Q=X.nextSibling,W=v.nextSibling.firstChild,Y=W.nextSibling,Z=Y.nextSibling;return l(n,()=>s()("auth.login.title")),l(f,()=>s()("auth.login.subtitle")),v.addEventListener("submit",B),l(D,()=>s()("auth.uuid.title")),$.addEventListener("blur",_),$.addEventListener("paste",O),$.$$input=t=>N(t.currentTarget.value),d($,"spellcheck",!1),l(L,e(u,{get when(){return I()},get children(){var t=a(p);return l(t,I),t}}),M,A),T.addEventListener("change",t=>E(t.currentTarget.checked)),l(z,()=>s()("auth.login.rememberDevice")),l(v,e(u,{get when(){return"error"===x().status},get children(){var t=a(y),i=t.firstChild.firstChild.nextSibling,r=i.firstChild,n=r.nextSibling,[d,g]=o(n.nextSibling);return l(r,()=>{const t=x();return"error"===t.status?t.message:""}),l(i,e(u,{get when(){return c(()=>P()>0)()&&P()<5},get children(){var t=a(w);return l(t,()=>s()("auth.login.attemptsRemaining",{count:P()})),t}}),d,g),t}}),J,K),l(v,e(u,{get when(){return"rateLimited"===x().status},get children(){var t=a(S),e=t.firstChild.firstChild.nextSibling.firstChild;return l(e,()=>{const t=x(),e="rateLimited"===t.status?t.remainingSeconds:0;return s()("auth.login.rateLimitExceeded",{seconds:e})}),t}}),X,q),l(Q,e(u,{get when(){return"submitting"===x().status},get fallback(){return s()("auth.login.submit")},get children(){var t=a(k),e=t.firstChild.nextSibling;return l(e,()=>s()("common.status.loading")),t}})),l(W,()=>s()("auth.login.newUser").split("{{link}}")[0]),l(Y,()=>s()("auth.login.newUserLink")),l(Z,()=>s()("auth.login.newUser").split("{{link}}")[1]||""),g(e=>{var r=`uuid-login ${t.class||""}`,n=s()("auth.login.title"),a=s()("auth.login.title"),o=s()("auth.login.placeholder"),l=s()("auth.uuid.title"),u=!!I(),c=I()?"uuid-error":void 0,g="submitting"===x().status||"rateLimited"===x().status,b=`\n                w-full px-4 py-3 text-lg font-mono tracking-wider text-center\n                border-2 rounded-lg shadow-sm\n                focus:outline-none focus:ring-4 focus:ring-blue-300\n                transition-all duration-200\n                min-h-44px\n                ${I()||"error"===x().status?"border-red-400 bg-red-50 text-red-900":"border-gray-300 bg-white text-gray-900 hover:border-blue-400"}\n                ${"submitting"===x().status||"rateLimited"===x().status?"opacity-60 cursor-not-allowed":""}\n              `,f="submitting"===x().status||"rateLimited"===x().status,p=s()("auth.login.rememberDevice"),w=G(),y=`\n              w-full px-6 py-4 text-lg font-bold rounded-lg shadow-lg\n              transition-all duration-200\n              focus:outline-none focus:ring-4 focus:ring-blue-300\n              min-h-44px\n              ${G()?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-60":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"}\n            `,S="submitting"===x().status?s()("common.status.loading"):s()("auth.login.submit");return r!==e.e&&m(i,e.e=r),n!==e.t&&d(i,"aria-label",e.t=n),a!==e.a&&d(v,"aria-label",e.a=a),o!==e.o&&d($,"placeholder",e.o=o),l!==e.i&&d($,"aria-label",e.i=l),u!==e.n&&d($,"aria-invalid",e.n=u),c!==e.s&&d($,"aria-describedby",e.s=c),g!==e.h&&h($,"disabled",e.h=g),b!==e.r&&m($,e.r=b),f!==e.d&&h(T,"disabled",e.d=f),p!==e.l&&d(T,"aria-label",e.l=p),w!==e.u&&h(Q,"disabled",e.u=w),y!==e.c&&m(Q,e.c=y),S!==e.w&&d(Q,"aria-label",e.w=S),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0}),g(()=>h($,"value",U())),g(()=>h(T,"checked",j())),b(),i})()};function U(t){return e(x,{componentName:"UUIDLogin",errorMessageKey:"errors.auth.loginFailed",get children(){return e(D,t)}})}t(["input"]);export{U};
