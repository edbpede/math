import{s as e,o as n}from"./offline.Cje6W5Yz.js";import{c as t,a as s}from"./solid-core.DXeZPQOr.js";import"./idb.B3QPy4uZ.js";import"./island-dashboard.BXXnSGgj.js";import"./exercises.qBB0Fcdg.js";import"./mastery.Dl1Tnavr.js";import"./supabase.Bg7B0XWC.js";import"./vendor.DULspf60.js";import"./qrcode.C5UO-pJ-.js";const o=s({online:"undefined"==typeof navigator||navigator.onLine,lastChanged:new Date}),a=s({syncing:!1,queueCount:0,lastSyncTime:null,error:null,lastSyncedCount:0});async function i(){if(await e.initialize(),r(),await c(),e.addEventListener(u),"undefined"!=typeof window&&setInterval(async()=>{const n=await e.getQueueCount();a.set({...a.get(),queueCount:n})},5e3),"undefined"!=typeof window)try{const e=await n.getPreference("lastSyncTime");e&&"string"==typeof e&&a.set({...a.get(),lastSyncTime:new Date(e)})}catch(t){}}function r(){const n=e.getOnlineStatus();o.set({online:n,lastChanged:new Date})}async function c(){const n=e.getSyncingStatus(),t=await e.getQueueCount();a.set({...a.get(),syncing:n,queueCount:t})}function u(e){switch(e.type){case"network-change":r(),c();break;case"sync-start":a.set({...a.get(),syncing:!0,error:null});break;case"sync-success":a.set({...a.get(),syncing:!1,error:null,lastSyncTime:e.timestamp,lastSyncedCount:e.itemsSynced??0}),async function(e){try{await n.setPreference("lastSyncTime",e.toISOString())}catch(t){}}(e.timestamp);break;case"sync-error":a.set({...a.get(),syncing:!1,error:e.error??"Unknown error"});break;case"sync-complete":a.set({...a.get(),syncing:!1,queueCount:e.queueCount??0})}}async function l(){if(!o.get().online)throw new Error("Cannot sync while offline");return await e.manualSync()}function y(){const{lastSyncTime:e}=a.get();if(!e)return"Never";const n=(new Date).getTime()-e.getTime(),t=Math.floor(n/1e3),s=Math.floor(t/60),o=Math.floor(s/60),i=Math.floor(o/24);return t<60?"Just now":s<60?`${s} minute${s>1?"s":""} ago`:o<24?`${o} hour${o>1?"s":""} ago`:`${i} day${i>1?"s":""} ago`}t(o,e=>e.online?"online":"offline"),t(a,e=>e.syncing?"syncing":e.error?"error":e.queueCount>0?"pending":e.lastSyncTime?"synced":"idle");export{o as $networkStatus,a as $syncStatus,y as getTimeSinceLastSync,i as initializeStatusStores,l as triggerManualSync};
