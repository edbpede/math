import{A as e,P as s,S as t,F as a,R as n}from"./vendor.CmgFkl6N.js";let i="";i="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const r={headers:{"X-Client-Info":`supabase-js-${i}/2.80.0`}},o={schema:"public"},h={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},c={},l=e=>e?(...s)=>e(...s):(...e)=>fetch(...e),u=(e,s,t)=>{const a=l(t),n=Headers;return async(t,i)=>{var r;const o=null!==(r=await s())&&void 0!==r?r:e;let h=new n(null==i?void 0:i.headers);return h.has("apikey")||h.set("apikey",e),h.has("Authorization")||h.set("Authorization",`Bearer ${o}`),a(t,Object.assign(Object.assign({},i),{headers:h}))}};class d extends e{constructor(e){super(e)}}class g{constructor(e,a,n){var i,l,d;this.supabaseUrl=e,this.supabaseKey=a;const g=function(e){const s=null==e?void 0:e.trim();if(!s)throw new Error("supabaseUrl is required.");if(!s.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((t=s).endsWith("/")?t:t+"/")}catch(i){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var t}(e);if(!a)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",g),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",g),this.storageUrl=new URL("storage/v1",g),this.functionsUrl=new URL("functions/v1",g);const b=`sb-${g.hostname.split(".")[0]}-auth-token`,p=function(e,s){var t,a;const{db:n,auth:i,realtime:r,global:o}=e,{db:h,auth:c,realtime:l,global:u}=s,d={db:Object.assign(Object.assign({},h),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},l),r),storage:{},global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(t=null==u?void 0:u.headers)&&void 0!==t?t:{}),null!==(a=null==o?void 0:o.headers)&&void 0!==a?a:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=n?n:{},{db:o,realtime:c,auth:Object.assign(Object.assign({},h),{storageKey:b}),global:r});this.storageKey=null!==(i=p.auth.storageKey)&&void 0!==i?i:"",this.headers=null!==(l=p.global.headers)&&void 0!==l?l:{},p.accessToken?(this.accessToken=p.accessToken,this.auth=new Proxy({},{get:(e,s)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(s)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(d=p.auth)&&void 0!==d?d:{},this.headers,p.global.fetch),this.fetch=u(a,this._getAccessToken.bind(this),p.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},p.realtime)),this.rest=new s(new URL("rest/v1",g).href,{headers:this.headers,schema:p.db.schema,fetch:this.fetch}),this.storage=new t(this.storageUrl.href,this.headers,this.fetch,null==n?void 0:n.storage),p.accessToken||this._listenForAuthEvents()}get functions(){return new a(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,s={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,s,t)}channel(e,s={config:{}}){return this.realtime.channel(e,s)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,s;if(this.accessToken)return await this.accessToken();const{data:t}=await this.auth.getSession();return null!==(s=null===(e=t.session)||void 0===e?void 0:e.access_token)&&void 0!==s?s:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:s,detectSessionInUrl:t,storage:a,userStorage:n,storageKey:i,flowType:r,lock:o,debug:h,throwOnError:c},l,u){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new d({url:this.authUrl.href,headers:Object.assign(Object.assign({},g),l),storageKey:i,autoRefreshToken:e,persistSession:s,detectSessionInUrl:t,storage:a,userStorage:n,flowType:r,lock:o,debug:h,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new n(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,s)=>{this._handleTokenChanged(e,"CLIENT",null==s?void 0:s.access_token)})}_handleTokenChanged(e,s,t){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===t?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==s&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=t,this.realtime.setAuth(t))}}const b=(e,s,t)=>new g(e,s,t);!function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const s=e.match(/^v(\d+)\./);!!s&&parseInt(s[1],10)}();export{b as c};
