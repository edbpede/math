import{s as e}from"./island-dashboard.BXXnSGgj.js";import{a as t,d as s,m as r,b as i,g as n,h as a,i as l,f as o,l as d,t as c,w as g,A as u,j as b,F as f,n as p,r as h}from"./solid-core.DXeZPQOr.js";import{$ as v}from"./exercises.qBB0Fcdg.js";function m(e){const t=e.replace(/-/g,"").toLowerCase().substring(0,16);return`${t.substring(0,4)}-${t.substring(4,8)}-${t.substring(8,12)}-${t.substring(12,16)}`}function x(e){if(!e||"string"!=typeof e)return!1;const t=e.trim();return/^[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}$/i.test(t)||/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)}async function y(t,s){try{const r={...s.gradeRange&&{grade_range:s.gradeRange},...s.locale&&{locale:s.locale},...s.preferences&&{preferences:s.preferences},last_active_at:(new Date).toISOString()},{data:i,error:n}=await e.from("users").update(r).eq("id",t).select().single();if(n)return{success:!1,error:"Failed to update user",code:"UPDATE_FAILED"};if(!i)return{success:!1,error:"User not found",code:"USER_NOT_FOUND"};return{success:!0,data:{user:{id:i.id,createdAt:new Date(i.created_at),lastActiveAt:new Date(i.last_active_at),gradeRange:i.grade_range,locale:i.locale,preferences:i.preferences||{}}}}}catch(r){return{success:!1,error:"An unexpected error occurred",code:"UNEXPECTED_ERROR"}}}async function S(t){try{const{error:s}=await e.from("users").delete().eq("id",t);return s?{success:!1,error:"Failed to delete user",code:"DELETE_FAILED"}:{success:!0,data:{deleted:!0}}}catch(s){return{success:!1,error:"An unexpected error occurred",code:"UNEXPECTED_ERROR"}}}async function C(){try{const e=await fetch("/api/auth/session",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)return null;const t=await e.json();return t.success&&t.authenticated&&t.user?{id:t.user.id,gradeRange:t.user.gradeRange,locale:t.user.locale,createdAt:new Date(t.user.createdAt),lastActiveAt:new Date(t.user.lastActiveAt),preferences:t.user.preferences||{}}:null}catch(e){return null}}const w={theme:"light",fontSize:"medium",dyslexiaFont:!1,highContrast:!1};const E=t(w);function $(e){const t=function(e={}){return{theme:e.theme||w.theme,fontSize:e.fontSize||w.fontSize,dyslexiaFont:void 0!==e.dyslexiaFont?Boolean(e.dyslexiaFont):w.dyslexiaFont,highContrast:void 0!==e.highContrast?Boolean(e.highContrast):w.highContrast}}({...E.get(),...e});E.set(t)}var L=c('<div class="flex items-center gap-2"><div class="h-4 w-4 animate-spin rounded-full border-2 border-blue-800 border-t-transparent"></div><span>'),k=c('<div class="flex items-center gap-2"><svg class="h-5 w-5"fill=currentColor viewBox="0 0 20 20"><path fill-rule=evenodd d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"clip-rule=evenodd></path></svg><span>'),z=c('<div class="flex items-center gap-2"><svg class="h-5 w-5"fill=currentColor viewBox="0 0 20 20"><path fill-rule=evenodd d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"clip-rule=evenodd></path></svg><span>'),F=c("<div role=status aria-live=polite><!$><!/><!$><!/><!$><!/>"),A=c('<div class="text-sm text-gray-600"role=status aria-live=polite>'),K=c('<div><!$><!/><section class=mb-8><h3 class="mb-2 text-lg font-semibold text-gray-900"></h3><p class="mb-4 text-sm text-gray-600"></p><fieldset class=space-y-3><legend class=sr-only></legend><!$><!/></fieldset></section><section class=mb-8><h3 class="mb-2 text-lg font-semibold text-gray-900"></h3><p class="mb-4 text-sm text-gray-600"></p><div class=space-y-6><div><label class="mb-2 block text-sm font-medium text-gray-700"></label><p class="mb-3 text-sm text-gray-600"></p><div class="grid grid-cols-3 gap-3"></div></div><div><label class="mb-2 block text-sm font-medium text-gray-700"></label><p class="mb-3 text-sm text-gray-600"></p><div class="grid grid-cols-3 gap-3"></div></div><div class="flex items-start gap-4 rounded-lg border border-gray-200 p-4"><input type=checkbox id=dyslexia-font class="mt-1 h-5 w-5 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"><div class=flex-1><label for=dyslexia-font class="block cursor-pointer font-medium text-gray-900"></label><p class="mt-1 text-sm text-gray-600"></p></div></div><div class="flex items-start gap-4 rounded-lg border border-gray-200 p-4"><input type=checkbox id=high-contrast class="mt-1 h-5 w-5 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"><div class=flex-1><label for=high-contrast class="block cursor-pointer font-medium text-gray-900"></label><p class="mt-1 text-sm text-gray-600"></p></div></div></div></section><!$><!/>'),R=c('<label><input type=radio name=gradeRange class="mt-1 h-5 w-5 cursor-pointer text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"><div class=flex-1><div class="font-medium text-gray-900"></div><div class="text-sm text-gray-600">'),T=c("<button type=button>");let _=null;function D(e){const t=r(v),s=r(E),[c,m]=i(e.initialGradeRange),[x,S]=i({status:"idle"}),[C,w]=i(!1);let D=e.initialGradeRange,j=s();const U=()=>{w(!0),_&&clearTimeout(_),_=setTimeout(()=>{(async()=>{_&&(clearTimeout(_),_=null),S({status:"saving"}),w(!1);const r=s();if(!function(e){return!(void 0!==e.theme&&"light"!==(t=e.theme)&&"dark"!==t&&"system"!==t||void 0!==e.fontSize&&!function(e){return"small"===e||"medium"===e||"large"===e}(e.fontSize)||void 0!==e.dyslexiaFont&&"boolean"!=typeof e.dyslexiaFont||void 0!==e.highContrast&&"boolean"!=typeof e.highContrast);var t}(r))return void S({status:"error",message:t()("settings.messages.saveError")});const i=c(),n=r;try{const s=await y(e.userId,{gradeRange:i,preferences:r});if(!s.success)return m(D),$(j),void S({status:"error",message:s.error||t()("settings.messages.saveError")});D=i,j=n,S({status:"saved"}),setTimeout(()=>{S(e=>"saved"===e.status?{status:"idle"}:e)},3e3)}catch(a){m(D),$(j),S({status:"error",message:t()("settings.messages.saveError")})}})()},1e3)},O=[{value:"0-3",labelKey:"settings.gradeLevel.options.0-3.label",descKey:"settings.gradeLevel.options.0-3.description"},{value:"4-6",labelKey:"settings.gradeLevel.options.4-6.label",descKey:"settings.gradeLevel.options.4-6.description"},{value:"7-9",labelKey:"settings.gradeLevel.options.7-9.label",descKey:"settings.gradeLevel.options.7-9.description"}],B=[{value:"light",labelKey:"settings.display.theme.options.light"},{value:"dark",labelKey:"settings.display.theme.options.dark"},{value:"system",labelKey:"settings.display.theme.options.system"}],I=[{value:"small",labelKey:"settings.display.fontSize.options.small"},{value:"medium",labelKey:"settings.display.fontSize.options.medium"},{value:"large",labelKey:"settings.display.fontSize.options.large"}];return(()=>{var r=n(K),i=r.firstChild,[v,y]=a(i.nextSibling),S=v.nextSibling,w=S.firstChild,E=w.nextSibling,_=E.nextSibling,D=_.firstChild,j=D.nextSibling,[N,G]=a(j.nextSibling),M=S.nextSibling,P=M.firstChild,q=P.nextSibling,X=q.nextSibling.firstChild,H=X.firstChild,J=H.nextSibling,Q=J.nextSibling,V=X.nextSibling,W=V.firstChild,Y=W.nextSibling,Z=Y.nextSibling,ee=V.nextSibling,te=ee.firstChild,se=te.nextSibling.firstChild,re=se.nextSibling,ie=ee.nextSibling.firstChild,ne=ie.nextSibling.firstChild,ae=ne.nextSibling,le=M.nextSibling,[oe,de]=a(le.nextSibling);return l(r,o(b,{get when(){return"idle"!==x().status},get children(){var e=n(F),s=e.firstChild,[r,i]=a(s.nextSibling),c=r.nextSibling,[u,f]=a(c.nextSibling),p=u.nextSibling,[h,v]=a(p.nextSibling);return l(e,o(b,{get when(){return"saving"===x().status},get children(){var e=n(L),s=e.firstChild.nextSibling;return l(s,()=>t()("settings.display.autoSave")),e}}),r,i),l(e,o(b,{get when(){return"saved"===x().status},get children(){var e=n(k),s=e.firstChild.nextSibling;return l(s,()=>t()("settings.display.saved")),e}}),u,f),l(e,o(b,{get when(){return"error"===x().status},get children(){var e=n(z),t=e.firstChild.nextSibling;return l(t,()=>x().message),e}}),h,v),d(()=>g(e,`\n            mb-6 rounded-lg border p-4\n            ${"saving"===x().status?"border-blue-300 bg-blue-50 text-blue-800":"saved"===x().status?"border-green-300 bg-green-50 text-green-800":"border-red-300 bg-red-50 text-red-800"}\n          `)),e}}),v,y),l(w,()=>t()("settings.sections.gradeLevel.title")),l(E,()=>t()("settings.sections.gradeLevel.description")),l(D,()=>t()("settings.gradeLevel.label")),l(_,o(f,{each:O,children:e=>{return s=n(R),r=s.firstChild,i=r.nextSibling.firstChild,a=i.nextSibling,r.addEventListener("change",()=>{m(e.value),U()}),l(i,()=>t()(e.labelKey)),l(a,()=>t()(e.descKey)),d(()=>g(s,`\n                  flex cursor-pointer items-start gap-3 rounded-lg border-2 p-4\n                  transition-all duration-200\n                  ${c()===e.value?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-blue-300"}\n                `)),d(()=>u(r,"value",e.value)),d(()=>u(r,"checked",c()===e.value)),s;var s,r,i,a}}),N,G),l(P,()=>t()("settings.sections.display.title")),l(q,()=>t()("settings.sections.display.description")),l(H,()=>t()("settings.display.theme.label")),l(J,()=>t()("settings.display.theme.description")),l(Q,o(f,{each:B,children:e=>{return(r=n(T)).$$click=()=>{$({theme:e.value}),U()},l(r,()=>t()(e.labelKey)),d(t=>{var i=`\n                      rounded-lg border-2 px-4 py-3 text-sm font-medium\n                      transition-all duration-200\n                      focus:outline-none focus:ring-4 focus:ring-blue-300\n                      touch-target\n                      ${s().theme===e.value?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-blue-300"}\n                    `,n=s().theme===e.value;return i!==t.e&&g(r,t.e=i),n!==t.t&&p(r,"aria-pressed",t.t=n),t},{e:void 0,t:void 0}),h(),r;var r}})),l(W,()=>t()("settings.display.fontSize.label")),l(Y,()=>t()("settings.display.fontSize.description")),l(Z,o(f,{each:I,children:e=>{return(r=n(T)).$$click=()=>{$({fontSize:e.value}),U()},l(r,()=>t()(e.labelKey)),d(t=>{var i=`\n                      rounded-lg border-2 px-4 py-3 text-sm font-medium\n                      transition-all duration-200\n                      focus:outline-none focus:ring-4 focus:ring-blue-300\n                      touch-target\n                      ${s().fontSize===e.value?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-blue-300"}\n                    `,n=s().fontSize===e.value;return i!==t.e&&g(r,t.e=i),n!==t.t&&p(r,"aria-pressed",t.t=n),t},{e:void 0,t:void 0}),h(),r;var r}})),te.addEventListener("change",e=>{$({dyslexiaFont:e.currentTarget.checked}),U()}),l(se,()=>t()("settings.display.dyslexiaFont.label")),l(re,()=>t()("settings.display.dyslexiaFont.description")),ie.addEventListener("change",e=>{$({highContrast:e.currentTarget.checked}),U()}),l(ne,()=>t()("settings.display.highContrast.label")),l(ae,()=>t()("settings.display.highContrast.description")),l(r,o(b,{get when(){return C()},get children(){var e=n(A);return l(e,()=>t()("settings.display.autoSave")),e}}),oe,de),d(()=>g(r,`settings-form ${e.class||""}`)),d(()=>u(te,"checked",s().dyslexiaFont)),d(()=>u(ie,"checked",s().highContrast)),r})()}s(["click"]);export{D as S,S as d,m as f,C as g,y as u,x as v};
