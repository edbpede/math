import{s as e}from"./island-dashboard.Bt_Br7pH.js";import{a as t,d as s,f as r,m as i,b as n,g as a,t as l,h as o,i as d,j as c,l as g,w as u,A as b,F as f,n as p,r as v}from"./solid-core.DXeZPQOr.js";import{$ as h}from"./exercises.CmwZ4dJn.js";import{E as m}from"./island-practice.Crw8XKdE.js";function x(e){const t=e.replace(/-/g,"").toLowerCase().substring(0,16);return`${t.substring(0,4)}-${t.substring(4,8)}-${t.substring(8,12)}-${t.substring(12,16)}`}function y(e){if(!e||"string"!=typeof e)return!1;const t=e.trim();return/^[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}$/i.test(t)||/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)}async function S(t,s){try{const r={...s.gradeRange&&{grade_range:s.gradeRange},...s.locale&&{locale:s.locale},...s.preferences&&{preferences:s.preferences},last_active_at:(new Date).toISOString()},{data:i,error:n}=await e.from("users").update(r).eq("id",t).select().single();if(n)return{success:!1,error:"Failed to update user",code:"UPDATE_FAILED"};if(!i)return{success:!1,error:"User not found",code:"USER_NOT_FOUND"};return{success:!0,data:{user:{id:i.id,createdAt:new Date(i.created_at),lastActiveAt:new Date(i.last_active_at),gradeRange:i.grade_range,locale:i.locale,preferences:i.preferences||{}}}}}catch(r){return{success:!1,error:"An unexpected error occurred",code:"UNEXPECTED_ERROR"}}}async function C(t){try{const{error:s}=await e.from("users").delete().eq("id",t);return s?{success:!1,error:"Failed to delete user",code:"DELETE_FAILED"}:{success:!0,data:{deleted:!0}}}catch(s){return{success:!1,error:"An unexpected error occurred",code:"UNEXPECTED_ERROR"}}}async function w(){try{const e=await fetch("/api/auth/session",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)return null;const t=await e.json();return t.success&&t.authenticated&&t.user?{id:t.user.id,gradeRange:t.user.gradeRange,locale:t.user.locale,createdAt:new Date(t.user.createdAt),lastActiveAt:new Date(t.user.lastActiveAt),preferences:t.user.preferences||{}}:null}catch(e){return null}}const E={theme:"light",fontSize:"medium",dyslexiaFont:!1,highContrast:!1};const $=t(E);function L(e){const t=function(e={}){return{theme:e.theme||E.theme,fontSize:e.fontSize||E.fontSize,dyslexiaFont:void 0!==e.dyslexiaFont?Boolean(e.dyslexiaFont):E.dyslexiaFont,highContrast:void 0!==e.highContrast?Boolean(e.highContrast):E.highContrast}}({...$.get(),...e});$.set(t)}var F=l('<div class="flex items-center gap-2"><div class="h-4 w-4 animate-spin rounded-full border-2 border-blue-800 border-t-transparent"></div><span>'),k=l('<div class="flex items-center gap-2"><svg class="h-5 w-5"fill=currentColor viewBox="0 0 20 20"><path fill-rule=evenodd d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"clip-rule=evenodd></path></svg><span>'),z=l('<div class="flex items-center gap-2"><svg class="h-5 w-5"fill=currentColor viewBox="0 0 20 20"><path fill-rule=evenodd d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"clip-rule=evenodd></path></svg><span>'),K=l("<div role=status aria-live=polite><!$><!/><!$><!/><!$><!/>"),R=l('<div class="text-sm text-gray-600"role=status aria-live=polite>'),A=l('<div><!$><!/><section class=mb-8><h3 class="mb-2 text-lg font-semibold text-gray-900"></h3><p class="mb-4 text-sm text-gray-600"></p><fieldset class=space-y-3><legend class=sr-only></legend><!$><!/></fieldset></section><section class=mb-8><h3 class="mb-2 text-lg font-semibold text-gray-900"></h3><p class="mb-4 text-sm text-gray-600"></p><div class=space-y-6><div><label class="mb-2 block text-sm font-medium text-gray-700"></label><p class="mb-3 text-sm text-gray-600"></p><div class="grid grid-cols-3 gap-3"></div></div><div><label class="mb-2 block text-sm font-medium text-gray-700"></label><p class="mb-3 text-sm text-gray-600"></p><div class="grid grid-cols-3 gap-3"></div></div><div class="flex items-start gap-4 rounded-lg border border-gray-200 p-4"><input type=checkbox id=dyslexia-font class="mt-1 h-5 w-5 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"><div class=flex-1><label for=dyslexia-font class="block cursor-pointer font-medium text-gray-900"></label><p class="mt-1 text-sm text-gray-600"></p></div></div><div class="flex items-start gap-4 rounded-lg border border-gray-200 p-4"><input type=checkbox id=high-contrast class="mt-1 h-5 w-5 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"><div class=flex-1><label for=high-contrast class="block cursor-pointer font-medium text-gray-900"></label><p class="mt-1 text-sm text-gray-600"></p></div></div></div></section><!$><!/>'),D=l('<label><input type=radio name=gradeRange class="mt-1 h-5 w-5 cursor-pointer text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"><div class=flex-1><div class="font-medium text-gray-900"></div><div class="text-sm text-gray-600">'),T=l("<button type=button>");let _=null;const j=e=>{const t=i(h),s=i($),[l,m]=n(e.initialGradeRange),[x,y]=n({status:"idle"}),[C,w]=n(!1);let E=e.initialGradeRange,j=s();const U=()=>{w(!0),_&&clearTimeout(_),_=setTimeout(()=>{(async()=>{_&&(clearTimeout(_),_=null),y({status:"saving"}),w(!1);const r=s();if(!function(e){return!(void 0!==e.theme&&"light"!==(t=e.theme)&&"dark"!==t&&"system"!==t||void 0!==e.fontSize&&!function(e){return"small"===e||"medium"===e||"large"===e}(e.fontSize)||void 0!==e.dyslexiaFont&&"boolean"!=typeof e.dyslexiaFont||void 0!==e.highContrast&&"boolean"!=typeof e.highContrast);var t}(r))return void y({status:"error",message:t()("settings.messages.saveError")});const i=l(),n=r;try{const s=await S(e.userId,{gradeRange:i,preferences:r});if(!s.success)return m(E),L(j),void y({status:"error",message:s.error||t()("settings.messages.saveError")});E=i,j=n,y({status:"saved"}),setTimeout(()=>{y(e=>"saved"===e.status?{status:"idle"}:e)},3e3)}catch(a){m(E),L(j),y({status:"error",message:t()("settings.messages.saveError")})}})()},1e3)},B=[{value:"0-3",labelKey:"settings.gradeLevel.options.0-3.label",descKey:"settings.gradeLevel.options.0-3.description"},{value:"4-6",labelKey:"settings.gradeLevel.options.4-6.label",descKey:"settings.gradeLevel.options.4-6.description"},{value:"7-9",labelKey:"settings.gradeLevel.options.7-9.label",descKey:"settings.gradeLevel.options.7-9.description"}],N=[{value:"light",labelKey:"settings.display.theme.options.light"},{value:"dark",labelKey:"settings.display.theme.options.dark"},{value:"system",labelKey:"settings.display.theme.options.system"}],O=[{value:"small",labelKey:"settings.display.fontSize.options.small"},{value:"medium",labelKey:"settings.display.fontSize.options.medium"},{value:"large",labelKey:"settings.display.fontSize.options.large"}];return(()=>{var i=a(A),n=i.firstChild,[h,y]=o(n.nextSibling),S=h.nextSibling,w=S.firstChild,E=w.nextSibling,$=E.nextSibling,_=$.firstChild,j=_.nextSibling,[G,I]=o(j.nextSibling),M=S.nextSibling,P=M.firstChild,q=P.nextSibling,X=q.nextSibling.firstChild,H=X.firstChild,J=H.nextSibling,Q=J.nextSibling,V=X.nextSibling,W=V.firstChild,Y=W.nextSibling,Z=Y.nextSibling,ee=V.nextSibling,te=ee.firstChild,se=te.nextSibling.firstChild,re=se.nextSibling,ie=ee.nextSibling.firstChild,ne=ie.nextSibling.firstChild,ae=ne.nextSibling,le=M.nextSibling,[oe,de]=o(le.nextSibling);return d(i,r(c,{get when(){return"idle"!==x().status},get children(){var e=a(K),s=e.firstChild,[i,n]=o(s.nextSibling),l=i.nextSibling,[b,f]=o(l.nextSibling),p=b.nextSibling,[v,h]=o(p.nextSibling);return d(e,r(c,{get when(){return"saving"===x().status},get children(){var e=a(F),s=e.firstChild.nextSibling;return d(s,()=>t()("settings.display.autoSave")),e}}),i,n),d(e,r(c,{get when(){return"saved"===x().status},get children(){var e=a(k),s=e.firstChild.nextSibling;return d(s,()=>t()("settings.display.saved")),e}}),b,f),d(e,r(c,{get when(){return"error"===x().status},get children(){var e=a(z),t=e.firstChild.nextSibling;return d(t,()=>x().message),e}}),v,h),g(()=>u(e,`\n            mb-6 rounded-lg border p-4\n            ${"saving"===x().status?"border-blue-300 bg-blue-50 text-blue-800":"saved"===x().status?"border-green-300 bg-green-50 text-green-800":"border-red-300 bg-red-50 text-red-800"}\n          `)),e}}),h,y),d(w,()=>t()("settings.sections.gradeLevel.title")),d(E,()=>t()("settings.sections.gradeLevel.description")),d(_,()=>t()("settings.gradeLevel.label")),d($,r(f,{each:B,children:e=>{return s=a(D),r=s.firstChild,i=r.nextSibling.firstChild,n=i.nextSibling,r.addEventListener("change",()=>{m(e.value),U()}),d(i,()=>t()(e.labelKey)),d(n,()=>t()(e.descKey)),g(()=>u(s,`\n                  flex cursor-pointer items-start gap-3 rounded-lg border-2 p-4\n                  transition-all duration-200\n                  ${l()===e.value?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-blue-300"}\n                `)),g(()=>b(r,"value",e.value)),g(()=>b(r,"checked",l()===e.value)),s;var s,r,i,n}}),G,I),d(P,()=>t()("settings.sections.display.title")),d(q,()=>t()("settings.sections.display.description")),d(H,()=>t()("settings.display.theme.label")),d(J,()=>t()("settings.display.theme.description")),d(Q,r(f,{each:N,children:e=>{return(r=a(T)).$$click=()=>{L({theme:e.value}),U()},d(r,()=>t()(e.labelKey)),g(t=>{var i=`\n                      rounded-lg border-2 px-4 py-3 text-sm font-medium\n                      transition-all duration-200\n                      focus:outline-none focus:ring-4 focus:ring-blue-300\n                      touch-target\n                      ${s().theme===e.value?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-blue-300"}\n                    `,n=s().theme===e.value;return i!==t.e&&u(r,t.e=i),n!==t.t&&p(r,"aria-pressed",t.t=n),t},{e:void 0,t:void 0}),v(),r;var r}})),d(W,()=>t()("settings.display.fontSize.label")),d(Y,()=>t()("settings.display.fontSize.description")),d(Z,r(f,{each:O,children:e=>{return(r=a(T)).$$click=()=>{L({fontSize:e.value}),U()},d(r,()=>t()(e.labelKey)),g(t=>{var i=`\n                      rounded-lg border-2 px-4 py-3 text-sm font-medium\n                      transition-all duration-200\n                      focus:outline-none focus:ring-4 focus:ring-blue-300\n                      touch-target\n                      ${s().fontSize===e.value?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-blue-300"}\n                    `,n=s().fontSize===e.value;return i!==t.e&&u(r,t.e=i),n!==t.t&&p(r,"aria-pressed",t.t=n),t},{e:void 0,t:void 0}),v(),r;var r}})),te.addEventListener("change",e=>{L({dyslexiaFont:e.currentTarget.checked}),U()}),d(se,()=>t()("settings.display.dyslexiaFont.label")),d(re,()=>t()("settings.display.dyslexiaFont.description")),ie.addEventListener("change",e=>{L({highContrast:e.currentTarget.checked}),U()}),d(ne,()=>t()("settings.display.highContrast.label")),d(ae,()=>t()("settings.display.highContrast.description")),d(i,r(c,{get when(){return C()},get children(){var e=a(R);return d(e,()=>t()("settings.display.autoSave")),e}}),oe,de),g(()=>u(i,`settings-form ${e.class||""}`)),g(()=>b(te,"checked",s().dyslexiaFont)),g(()=>b(ie,"checked",s().highContrast)),i})()};function U(e){return r(m,{componentName:"SettingsForm",errorMessageKey:"errors.settings.saveFailed",get children(){return r(j,e)}})}s(["click"]);export{U as S,C as d,x as f,w as g,S as u,y as v};
