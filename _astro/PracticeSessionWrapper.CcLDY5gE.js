import{d as Ce,c as K,g as m,t as x,a as R,i as l,b as h,S as P,e as O,s as w,f as ie,r as se,k as et,y as Y,z as Ne,M as oe,F as he,A as Se,j as qe,u as tt,m as ke,h as Ue,B as Me,o as vt,x as $t}from"./store.C-Iyz76Y.js";import{a as nt,_ as _e,d as re,m as le,$ as ce}from"./store.BEcAnxVL.js";import{s as yt,e as wt,l as Qe,u as pt}from"./progress.isgvytKC.js";import"./client.D0X2hLWc.js";import"./_commonjsHelpers.gnU0ypJ3.js";const Xe=[{locale:"da-DK",name:"Danish",nativeName:"Dansk",direction:"ltr",numberFormat:{decimalSeparator:",",thousandsSeparator:"."},dateFormat:{short:"dd/MM/yyyy",medium:"d. MMM yyyy",long:"d. MMMM yyyy"}},{locale:"en-US",name:"English",nativeName:"English",direction:"ltr",numberFormat:{decimalSeparator:".",thousandsSeparator:","},dateFormat:{short:"MM/dd/yyyy",medium:"MMM d, yyyy",long:"MMMM d, yyyy"}}];function _t(n){const e=Xe.find(t=>t.locale===n);return e||(console.warn(`Locale config not found for ${n}, using da-DK`),Xe[0])}function St(n,e){const t=e?.locale||nt.get(),r=e?.decimals??2,i=e?.useGrouping??!0,s=_t(t),o=n.toFixed(r).split(".");let a=o[0];const c=o[1];return i&&a.length>3&&(a=a.replace(/\B(?=(\d{3})+(?!\d))/g,s.numberFormat.thousandsSeparator)),r>0&&c?`${a}${s.numberFormat.decimalSeparator}${c}`:a}async function kt(n){const e=n||nt.get();try{const t=await _e(Object.assign({"../../locales/da-DK/contexts.json":()=>re(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>re(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${e}/contexts.json`,5),r=t.default||t;return{locale:e,names:r.names?.male.concat(r.names?.female||[]).concat(r.names?.neutral||[])||[],places:r.places?.cities.concat(r.places?.locations||[])||[],currency:r.currency||{symbol:"kr",name:"kroner"},items:r.items||{}}}catch(t){return console.error(`Failed to load context pool for locale ${e}:`,t),{locale:e,names:[],places:[],currency:{symbol:"kr",name:"kroner"},items:{}}}}class rt{locale;contextPool=null;usageTrackers=new Map;defaultMaxRecent;constructor(e,t=10){this.locale=e,this.defaultMaxRecent=t}async loadContextPool(){this.contextPool=await kt(this.locale)}getTracker(e){return this.usageTrackers.has(e)||this.usageTrackers.set(e,{category:e,recentlyUsed:[],maxRecentSize:this.defaultMaxRecent}),this.usageTrackers.get(e)}markAsUsed(e,t){const r=this.getTracker(e),i=r.recentlyUsed.indexOf(t);i>-1&&r.recentlyUsed.splice(i,1),r.recentlyUsed.unshift(t),r.recentlyUsed.length>r.maxRecentSize&&(r.recentlyUsed=r.recentlyUsed.slice(0,r.maxRecentSize))}getAvailableItems(e,t){const r=this.getTracker(e),i=t.filter(s=>!r.recentlyUsed.includes(s));return i.length===0?(r.recentlyUsed=[],t):i}async selectName(e){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const t=await _e(Object.assign({"../../locales/da-DK/contexts.json":()=>re(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>re(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),r=t.default||t;let i=[],s="names";if(e?(i=r.names?.[e]||[],s=`names:${e}`):i=[...r.names?.male||[],...r.names?.female||[],...r.names?.neutral||[]],i.length===0)throw new Error(`No names available for gender: ${e||"any"}`);const o=this.getAvailableItems(s,i),a=o[Math.floor(Math.random()*o.length)];return this.markAsUsed(s,a),a}async selectNames(e=1,t){const r=[];for(let i=0;i<e;i++)r.push(await this.selectName(t));return r}async selectPlace(e){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const t=await _e(Object.assign({"../../locales/da-DK/contexts.json":()=>re(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>re(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),r=t.default||t;let i=[],s="places";if(e?(i=r.places?.[e]||[],s=`places:${e}`):i=[...r.places?.cities||[],...r.places?.locations||[],...r.places?.neighborhoods||[]],i.length===0)throw new Error(`No places available for type: ${e||"any"}`);const o=this.getAvailableItems(s,i),a=o[Math.floor(Math.random()*o.length)];return this.markAsUsed(s,a),a}async selectItems(e,t=1){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const r=await _e(Object.assign({"../../locales/da-DK/contexts.json":()=>re(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>re(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),s=(r.default||r).items?.[e]||[];if(s.length===0)throw new Error(`No items available for category: ${e}`);const o=`items:${e}`,c=[...this.getAvailableItems(o,s)].sort(()=>Math.random()-.5),d=c.slice(0,Math.min(t,c.length));return d.forEach(u=>this.markAsUsed(o,u)),d}async selectScenario(e){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const t=await _e(Object.assign({"../../locales/da-DK/contexts.json":()=>re(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>re(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),i=(t.default||t).scenarios?.[e]||[];if(i.length===0)throw new Error(`No scenarios available for category: ${e}`);const s=`scenarios:${e}`,o=this.getAvailableItems(s,i),a=o[Math.floor(Math.random()*o.length)];return this.markAsUsed(s,a),a}async selectActivityVerb(){if(this.contextPool||await this.loadContextPool(),!this.contextPool)throw new Error("Failed to load context pool");const e=await _e(Object.assign({"../../locales/da-DK/contexts.json":()=>re(()=>import("./contexts.BWTsIbiN.js"),[]),"../../locales/en-US/contexts.json":()=>re(()=>import("./contexts.OqJEuN6e.js"),[])}),`../../locales/${this.locale}/contexts.json`,5),r=(e.default||e).activities?.verbs||[];if(r.length===0)throw new Error("No activity verbs available");const i="activities:verbs",s=this.getAvailableItems(i,r),o=s[Math.floor(Math.random()*s.length)];return this.markAsUsed(i,o),o}getCurrency(){if(!this.contextPool)throw new Error("Context pool not loaded. Call loadContextPool() first.");return this.contextPool.currency}resetUsageTracking(){this.usageTrackers.clear()}resetCategoryTracking(e){this.usageTrackers.delete(e)}getUsageStats(){const e={};for(const[t,r]of this.usageTrackers.entries())e[t]={total:r.recentlyUsed.length,available:r.maxRecentSize-r.recentlyUsed.length};return e}}class $e extends Error{constructor(e,t,r){super(`Parameter generation failed for '${t}': ${e}`),this.parameterName=t,this.cause=r,this.name="ParameterGenerationError"}}class ye extends Error{constructor(e,t,r){super(`Constraint violation for '${t}' (value: ${r}): ${e}`),this.parameterName=t,this.value=r,this.name="ConstraintViolationError"}}const Ct={maxAttempts:100,seed:Date.now()};class De{state;constructor(e){this.state=e>>>0||1}next(){let e=this.state+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}nextInt(e,t){if(!Number.isInteger(e)||!Number.isInteger(t))throw new Error("nextInt requires integer bounds");if(e>t)throw new Error("min must be less than or equal to max");return Math.floor(this.next()*(t-e+1))+e}nextFloat(e,t){if(e>=t)throw new Error("min must be less than max");return this.next()*(t-e)+e}choice(e){if(e.length===0)throw new Error("Cannot select from empty array");return e[Math.floor(this.next()*e.length)]}shuffle(e){const t=[...e];for(let r=t.length-1;r>0;r--){const i=Math.floor(this.next()*(r+1));[t[r],t[i]]=[t[i],t[r]]}return t}}class At{rng;config;constructor(e={}){this.config={...Ct,...e},this.rng=new De(this.config.seed)}generate(e){const t=this.computeGenerationOrder(e);for(let r=0;r<this.config.maxAttempts;r++)try{const i={};for(const s of t){const o=e[s],a=this.generateParameter(s,o,i);i[s]=a}return this.validateParameters(i,e),i}catch(i){if(r===this.config.maxAttempts-1)throw i instanceof ye?new $e(`Failed to generate valid parameters after ${this.config.maxAttempts} attempts`,i.parameterName,i):i;continue}throw new $e(`Failed to generate parameters after ${this.config.maxAttempts} attempts`,"unknown")}validate(e,t,r,i={}){if(!this.validateType(t,r.type))throw new ye(`Expected type ${r.type} but got ${typeof t}`,e,t);if(r.type==="integer"||r.type==="decimal"){const s=t;if(r.min!==void 0&&s<r.min)throw new ye(`Value ${s} is less than minimum ${r.min}`,e,t);if(r.max!==void 0&&s>r.max)throw new ye(`Value ${s} is greater than maximum ${r.max}`,e,t);if(r.step!==void 0&&r.min!==void 0){const o=(s-r.min)/r.step;if(!Number.isInteger(o))throw new ye(`Value ${s} does not match step ${r.step} from minimum ${r.min}`,e,t)}}if(r.options&&r.options.length>0&&!r.options.includes(t))throw new ye(`Value is not in allowed options: ${JSON.stringify(r.options)}`,e,t);if(r.constraint){const s={...i,[e]:t};if(!r.constraint(s))throw new ye("Custom constraint function returned false",e,t)}}getRNG(){return this.rng}resetSeed(e){this.rng=new De(e),this.config.seed=e}generateParameter(e,t,r){try{if(t.options&&t.options.length>0)return this.rng.choice(t.options);switch(t.type){case"integer":return this.generateInteger(t);case"decimal":return this.generateDecimal(t);case"fraction":return this.generateFraction(t);case"string":return this.generateString(t);default:throw new $e(`Unknown parameter type: ${t.type}`,e)}}catch(i){throw i instanceof $e?i:new $e(`Failed to generate parameter: ${i instanceof Error?i.message:String(i)}`,e,i)}}generateInteger(e){const t=e.min??0,r=e.max??100,i=e.step??1,s=Math.floor((r-t)/i),o=this.rng.nextInt(0,s);return t+o*i}generateDecimal(e){const t=e.min??0,r=e.max??100,i=e.step;if(i!==void 0){const s=Math.floor((r-t)/i),o=this.rng.nextInt(0,s);return Number((t+o*i).toFixed(10))}return Number(this.rng.nextFloat(t,r).toFixed(2))}generateFraction(e){const t=e.min??1,r=e.max??10,i=this.rng.nextInt(t,r),s=this.rng.nextInt(t,r);return`${i}/${s===0?1:s}`}generateString(e){if(!e.options||e.options.length===0)throw new Error("String parameters must have options defined");return this.rng.choice(e.options)}validateType(e,t){switch(t){case"integer":return typeof e=="number"&&Number.isInteger(e);case"decimal":return typeof e=="number";case"fraction":return typeof e=="string"&&/^\d+\/\d+$/.test(e);case"string":return typeof e=="string";default:return!1}}computeGenerationOrder(e){const t=Object.keys(e),r=new Set,i=new Set,s=[],o=a=>{if(r.has(a))return;if(i.has(a))throw new $e("Circular dependency detected",a);i.add(a);const c=e[a];if(c.dependsOn)for(const d of c.dependsOn){if(!e[d])throw new $e(`Depends on undefined parameter: ${d}`,a);o(d)}i.delete(a),r.add(a),s.push(a)};for(const a of t)o(a);return s}validateParameters(e,t){for(const[r,i]of Object.entries(t)){const s=e[r];this.validate(r,s,i,e)}}}const Tt={srsBaseline:1,bindingBonus:.3,recencyPenalty:.5,masteryAdjustment:0};class Q extends Error{constructor(e,t,r){super(`Template validation failed for '${t}': ${e}`),this.templateId=t,this.field=r,this.name="TemplateValidationError"}}class It{templates=new Map;competencyIndex=new Map;skillsIndex=new Map;gradeIndex=new Map;difficultyIndex=new Map;bindingIndex=new Map;tagIndex=new Map;recentlyUsed=[];maxRecentSize=20;register(e){if(this.validateTemplate(e),this.templates.has(e.id))throw new Q("Template ID already registered",e.id,"id");const t={template:e,weight:1,lastUsed:void 0,usageCount:0};this.templates.set(e.id,t),this.indexTemplate(e.id,e.metadata)}unregister(e){const t=this.templates.get(e);return t?(this.deindexTemplate(e,t.template.metadata),this.templates.delete(e),this.recentlyUsed=this.recentlyUsed.filter(r=>r!==e),!0):!1}get(e){return this.templates.get(e)?.template}has(e){return this.templates.has(e)}count(){return this.templates.size}find(e){let t=new Set(this.templates.keys());return e.competencyAreaId!==void 0&&(t=this.intersect(t,this.competencyIndex.get(e.competencyAreaId))),e.skillsAreaId!==void 0&&(t=this.intersect(t,this.skillsIndex.get(e.skillsAreaId))),e.gradeRange!==void 0&&(t=this.intersect(t,this.gradeIndex.get(e.gradeRange))),e.difficulty!==void 0&&(t=this.intersect(t,this.difficultyIndex.get(e.difficulty))),e.isBinding!==void 0&&(t=this.intersect(t,this.bindingIndex.get(e.isBinding))),e.tags&&e.tags.length>0&&(t=new Set(Array.from(t).filter(r=>{const i=this.templates.get(r);return i?e.tags.every(s=>i.template.metadata.tags.includes(s)):!1}))),e.excludeTemplateIds&&e.excludeTemplateIds.length>0&&e.excludeTemplateIds.forEach(r=>t.delete(r)),Array.from(t)}select(e,t={},r=50){const i=this.find(e);if(i.length===0)return;if(i.length===1)return i[0];const s={...Tt,...t},o=i.map(a=>({id:a,weight:this.calculateWeight(a,s,r)}));return this.weightedRandomSelect(o)}markUsed(e){const t=this.templates.get(e);t&&(t.lastUsed=new Date,t.usageCount+=1,this.recentlyUsed.push(e),this.recentlyUsed.length>this.maxRecentSize&&this.recentlyUsed.shift())}getRecentlyUsed(){return[...this.recentlyUsed].reverse()}clearRecentlyUsed(){this.recentlyUsed=[]}getUsageStats(e){const t=this.templates.get(e);if(t)return{usageCount:t.usageCount,lastUsed:t.lastUsed}}validateTemplate(e){if(!e.id||typeof e.id!="string"||e.id.trim()==="")throw new Q("Template ID is required and must be a non-empty string",e.id||"unknown","id");if(!e.name||typeof e.name!="string"||e.name.trim()==="")throw new Q("Template name is required and must be a non-empty string",e.id,"name");if(!e.metadata)throw new Q("Template metadata is required",e.id,"metadata");if(this.validateMetadata(e.id,e.metadata),!e.parameters||typeof e.parameters!="object")throw new Q("Template parameters must be an object",e.id,"parameters");if(typeof e.generate!="function")throw new Q("Template generate must be a function",e.id,"generate");if(typeof e.validate!="function")throw new Q("Template validate must be a function",e.id,"validate");if(!Array.isArray(e.hints))throw new Q("Template hints must be an array",e.id,"hints");if(e.hints.length<4)throw new Q("Template must provide at least 4 hint levels",e.id,"hints");e.hints.forEach((t,r)=>{if(typeof t!="function")throw new Q(`Hint at index ${r} must be a function`,e.id,`hints[${r}]`)})}validateMetadata(e,t){if(!["matematiske-kompetencer","tal-og-algebra","geometri-og-maling","statistik-og-sandsynlighed"].includes(t.competencyAreaId))throw new Q(`Invalid competency area ID: ${t.competencyAreaId}`,e,"metadata.competencyAreaId");if(!t.skillsAreaId||typeof t.skillsAreaId!="string")throw new Q("Skills area ID is required and must be a string",e,"metadata.skillsAreaId");if(!["0-3","4-6","7-9"].includes(t.gradeRange))throw new Q(`Invalid grade range: ${t.gradeRange}`,e,"metadata.gradeRange");if(!["A","B","C"].includes(t.difficulty))throw new Q(`Invalid difficulty: ${t.difficulty}`,e,"metadata.difficulty");if(typeof t.isBinding!="boolean")throw new Q("isBinding must be a boolean",e,"metadata.isBinding");if(!Array.isArray(t.tags))throw new Q("Tags must be an array",e,"metadata.tags");t.tags.forEach((o,a)=>{if(typeof o!="string")throw new Q(`Tag at index ${a} must be a string`,e,`metadata.tags[${a}]`)})}indexTemplate(e,t){this.addToIndex(this.competencyIndex,t.competencyAreaId,e),this.addToIndex(this.skillsIndex,t.skillsAreaId,e),this.addToIndex(this.gradeIndex,t.gradeRange,e),this.addToIndex(this.difficultyIndex,t.difficulty,e),this.addToIndex(this.bindingIndex,t.isBinding,e),t.tags.forEach(r=>{this.addToIndex(this.tagIndex,r,e)})}deindexTemplate(e,t){this.removeFromIndex(this.competencyIndex,t.competencyAreaId,e),this.removeFromIndex(this.skillsIndex,t.skillsAreaId,e),this.removeFromIndex(this.gradeIndex,t.gradeRange,e),this.removeFromIndex(this.difficultyIndex,t.difficulty,e),this.removeFromIndex(this.bindingIndex,t.isBinding,e),t.tags.forEach(r=>{this.removeFromIndex(this.tagIndex,r,e)})}addToIndex(e,t,r){let i=e.get(t);i||(i=new Set,e.set(t,i)),i.add(r)}removeFromIndex(e,t,r){const i=e.get(t);i&&(i.delete(r),i.size===0&&e.delete(t))}intersect(e,t){return t?new Set(Array.from(e).filter(r=>t.has(r))):new Set}calculateWeight(e,t,r){const i=this.templates.get(e);if(!i)return 0;let s=t.srsBaseline;i.template.metadata.isBinding&&(s+=t.bindingBonus);const o=this.recentlyUsed.indexOf(e);if(o!==-1){const g=(this.recentlyUsed.length-o)/this.recentlyUsed.length;s-=t.recencyPenalty*g}const c={A:1,B:2,C:3}[i.template.metadata.difficulty],d=1+r/50,u=Math.abs(c-d);return s-=t.masteryAdjustment*u,Math.max(0,s)}weightedRandomSelect(e){const t=e.reduce((i,s)=>i+s.weight,0);if(t<=0)return e[Math.floor(Math.random()*e.length)].id;let r=Math.random()*t;for(const i of e)if(r-=i.weight,r<=0)return i.id;return e[e.length-1].id}}const Ve=new It;function Et(n,e={}){const{count:t=3,strategies:r,seed:i=Date.now(),excludeValues:s=[]}=e,o=new De(i),a=new Set,c=typeof n.value=="number"?n.value:parseFloat(n.value.toString()),d=new Set([n.value.toString(),...s.map(C=>C.toString())]);n.equivalents&&n.equivalents.forEach(C=>d.add(C.toString()));const u=r||["off-by-one","wrong-operation","sign-error","place-value","factor-multiple"];let g=0;const S=t*10;for(;a.size<t&&g<S;){g++;const C=o.choice(u),E=Mt(c,C,o).toString();d.has(E)||a.has(E)||a.add(E)}for(;a.size<t&&g<S;){g++;const C=o.nextInt(-10,10);if(C===0)continue;const E=(c+C).toString();!d.has(E)&&!a.has(E)&&a.add(E)}return Array.from(a)}function Mt(n,e,t){switch(e){case"off-by-one":return Dt(n,t);case"wrong-operation":return Rt(n,t);case"sign-error":return Pt(n);case"place-value":return Ut(n,t);case"factor-multiple":return Ft(n,t);case"common-mistake":return Lt(n,t);default:return n+t.nextInt(-5,5)}}function Dt(n,e){return n+(e.next()<.5?1:-1)}function Rt(n,e){const t=e.nextInt(2,5);return e.next()<.5?n*t:Math.floor(n/t)}function Pt(n){return-n}function Ut(n,e){const t=e.next()<.5?10:.1;return n*t}function Ft(n,e){if(n<=1)return n*2;const t=[2,3,4,5],r=e.choice(t);return e.next()<.5?n*r:Math.floor(n/r)}function Lt(n,e){const t=[()=>Math.floor(n/10)*10,()=>Math.floor(n/100)*100,()=>n+Math.floor(n*.1),()=>n-Math.floor(n*.1)];return e.choice(t)()}function jt(n,e={}){const{count:t=3,seed:r=Date.now(),excludeValues:i=[]}=e,s=new De(r),o=new Set,c=n.value.toString().match(/^(\d+)\/(\d+)$/);if(!c)return[];const[,d,u]=c,g=parseInt(d,10),S=parseInt(u,10),C=new Set([n.value.toString(),...i.map(b=>b.toString())]);n.equivalents&&n.equivalents.forEach(b=>C.add(b.toString()));const U=[()=>`${S}/${g}`,()=>`${g+1}/${S}`,()=>`${g-1}/${S}`,()=>`${g}/${S+1}`,()=>`${g}/${S-1}`,()=>{const b=s.nextInt(2,4);return`${g*b}/${S*b+1}`},()=>{const b=s.nextInt(2,3);return`${Math.floor(g/b)}/${Math.floor(S/b)}`}];let E=0;const F=t*10;for(;o.size<t&&E<F;){E++;const A=s.choice(U)();A.match(/^\d+\/\d+$/)&&!C.has(A)&&!o.has(A)&&o.add(A)}return Array.from(o)}function Vt(n,e={}){const{count:t=3,seed:r=Date.now(),excludeValues:i=[],alternatives:s=[]}=e,o=new De(r),a=new Set,c=new Set([n.value.toString(),...i.map(d=>d.toString())]);if(n.equivalents&&n.equivalents.forEach(d=>c.add(d.toString())),s.length>0){const d=o.shuffle(s);for(const u of d){if(a.size>=t)break;c.has(u)||a.add(u)}}return Array.from(a)}function Bt(n,e={}){const t=n.value;return typeof t=="number"?Et(n,e):typeof t=="string"?t.match(/^\d+\/\d+$/)?jt(n,e):Vt(n,e):[]}class Be extends Error{constructor(e,t,r,i){super(`Instance generation failed for template '${t}' with seed ${r}: ${e}`),this.templateId=t,this.seed=r,this.cause=i,this.name="InstanceGenerationError"}}async function Ot(n,e,t={}){const{locale:r="da-DK",contextSelector:i,includeDistractors:s=!0,distractorCount:o=3}=t,a=Ve.get(n);if(!a)throw new Be("Template not found in registry",n,e);try{const d=new At({seed:e}).generate(a.parameters),u=i||new rt(r),g={locale:r,contextType:a.contextType};if(a.contextType&&a.contextType!=="abstract")try{g.names=await u.selectNames(2),g.places=await u.selectPlace();const A={shopping:"food",school:"school",nature:"animals",sports:"sports"}[a.contextType];A&&(g.items=await u.selectItems(A,3))}catch(b){console.warn(`Context selection failed for template ${n}:`,b)}const S=a.generate(d,r),C=qt(S.questionText,d,r,g),U=a.hints.map((b,A)=>{const $=b(d,r);return typeof $=="string"?{level:A+1,text:$,visualAid:S.visualAid}:{level:A+1,...$}});let E;s&&(E=Bt(S.correctAnswer,{count:o,seed:e,excludeValues:[]}));const F=`${n}-${e}`;return Ve.markUsed(n),{id:F,templateId:n,questionText:C,correctAnswer:S.correctAnswer,distractors:E,hints:U,metadata:a.metadata,context:g,seed:e}}catch(c){throw new Be(c instanceof Error?c.message:String(c),n,e,c)}}async function Nt(n,e,t={}){const{startSeed:r=Date.now(),locale:i="da-DK",contextSelector:s,includeDistractors:o=!0,distractorCount:a=3}=t,c=new Array(e),d=s||new rt(i);for(let u=0;u<e;u++){const g=Ve.select(n);if(!g)throw new Be("No templates found matching criteria","unknown",r+u);const S=r+u,C=await Ot(g,S,{locale:i,contextSelector:d,includeDistractors:o,distractorCount:a});c[u]=C}return c}function qt(n,e,t,r){let i=n;if(r.names&&r.names.length>0&&(r.names.forEach((o,a)=>{i=i.replace(new RegExp(`\\{\\{context\\.names\\[${a}\\]\\}\\}`,"g"),o)}),i=i.replace(/\{\{context\.name\}\}/g,r.names[0])),r.places){const o=Array.isArray(r.places)?r.places[0]:r.places;i=i.replace(/\{\{context\.place\}\}/g,o)}r.items&&r.items.length>0&&(r.items.forEach((o,a)=>{i=i.replace(new RegExp(`\\{\\{context\\.items\\[${a}\\]\\}\\}`,"g"),o)}),i=i.replace(/\{\{context\.item\}\}/g,r.items[0]));const s=/\{\{([^:}]+)(?::([^}]+))?\}\}/g;return i=i.replace(s,(o,a,c)=>{const d=e[a];return d===void 0?(console.warn(`Parameter ${a} not found in params`),o):c==="number"&&typeof d=="number"?St(d,t):String(d)}),i}var Kt=x('<div class="mb-8 p-4 bg-blue-50 border border-blue-200 rounded-lg"role=status aria-live=polite><p class="text-blue-800 text-sm">'),zt=x('<div><div class=mb-8><h1 class="text-3xl font-bold text-gray-900 mb-2"></h1><p class="text-lg text-gray-600"></p></div><!$><!/><div class=mb-8><label id=difficulty-label class="block text-lg font-semibold text-gray-800 mb-4"></label><div role=radiogroup aria-labelledby=difficulty-label class=space-y-3></div></div><div class=mb-8><label id=count-label class="block text-lg font-semibold text-gray-800 mb-4"></label><div role=radiogroup aria-labelledby=count-label class=space-y-3></div></div><div class=mt-8><button type=button class="w-full py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold text-lg rounded-lg transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-md hover:shadow-lg">'),Je=x('<div class="w-full h-full rounded-full bg-white scale-40">'),Ye=x('<button type=button role=radio><div class="flex items-start"><div aria-hidden=true></div><div class=flex-1><div class="font-semibold text-gray-900 mb-1"></div><div class="text-sm text-gray-600">');function Ht(n){const e=le(ce),[t,r]=K(n.isFirstTime?"A":"Auto"),[i,s]=K(20),o=()=>{n.onStart({difficulty:t(),exerciseCount:i()})},a=[{value:"Auto",key:"auto"},{value:"A",key:"a"},{value:"B",key:"b"},{value:"C",key:"c"}],c=[{value:10,key:"10"},{value:20,key:"20"},{value:30,key:"30"}];return(()=>{var d=m(zt),u=d.firstChild,g=u.firstChild,S=g.nextSibling,C=u.nextSibling,[U,E]=R(C.nextSibling),F=U.nextSibling,b=F.firstChild,A=b.nextSibling,$=F.nextSibling,y=$.firstChild,k=y.nextSibling,v=$.nextSibling,M=v.firstChild;return l(g,()=>e()("exercises.session.setup.title")),l(S,()=>e()("exercises.session.setup.subtitle")),l(d,h(P,{get when(){return n.isFirstTime},get children(){var I=m(Kt),T=I.firstChild;return l(T,()=>e()("exercises.session.setup.firstTimeNotice")),I}}),U,E),l(b,()=>e()("exercises.session.setup.difficulty.label")),l(A,()=>a.map(I=>{const T=()=>t()===I.value;return(()=>{var D=m(Ye),j=D.firstChild,B=j.firstChild,W=B.nextSibling,X=W.firstChild,p=X.nextSibling;return D.$$click=()=>r(I.value),l(B,h(P,{get when(){return T()},get children(){return m(Je)}})),l(X,()=>e()(`exercises.session.setup.difficulty.${I.key}`)),l(p,()=>e()(`exercises.session.setup.difficulty.${I.key}Description`)),O(f=>{var V=T(),N=`
                  w-full text-left p-4 rounded-lg border-2 transition-all
                  min-h-[44px] cursor-pointer
                  ${T()?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 bg-white hover:border-blue-300 hover:bg-blue-50"}
                  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
                `,_=`
                      flex-shrink-0 w-5 h-5 rounded-full border-2 mt-0.5 mr-3
                      ${T()?"border-blue-500 bg-blue-500":"border-gray-400 bg-white"}
                    `;return V!==f.e&&w(D,"aria-checked",f.e=V),N!==f.t&&ie(D,f.t=N),_!==f.a&&ie(B,f.a=_),f},{e:void 0,t:void 0,a:void 0}),se(),D})()})),l(y,()=>e()("exercises.session.setup.exerciseCount.label")),l(k,()=>c.map(I=>{const T=()=>i()===I.value;return(()=>{var D=m(Ye),j=D.firstChild,B=j.firstChild,W=B.nextSibling,X=W.firstChild,p=X.nextSibling;return D.$$click=()=>s(I.value),l(B,h(P,{get when(){return T()},get children(){return m(Je)}})),l(X,()=>e()(`exercises.session.setup.exerciseCount.${I.key}`)),l(p,()=>e()(`exercises.session.setup.exerciseCount.${I.key}Description`)),O(f=>{var V=T(),N=`
                  w-full text-left p-4 rounded-lg border-2 transition-all
                  min-h-[44px] cursor-pointer
                  ${T()?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 bg-white hover:border-blue-300 hover:bg-blue-50"}
                  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
                `,_=`
                      flex-shrink-0 w-5 h-5 rounded-full border-2 mt-0.5 mr-3
                      ${T()?"border-blue-500 bg-blue-500":"border-gray-400 bg-white"}
                    `;return V!==f.e&&w(D,"aria-checked",f.e=V),N!==f.t&&ie(D,f.t=N),_!==f.a&&ie(B,f.a=_),f},{e:void 0,t:void 0,a:void 0}),se(),D})()})),M.$$click=o,l(M,()=>e()("exercises.session.setup.startButton")),O(()=>ie(d,`session-setup ${n.class||""}`)),se(),d})()}Ce(["click"]);function Gt(n){const e=n.toLowerCase().split("+"),t={ctrl:e.includes("ctrl")||e.includes("control"),alt:e.includes("alt"),shift:e.includes("shift"),meta:e.includes("meta")||e.includes("cmd")||e.includes("command")};return{key:e[e.length-1],...t}}function Wt(n,e){const t=Gt(e.key);return!(n.key.toLowerCase()!==t.key.toLowerCase()||t.ctrl&&!n.ctrlKey||!t.ctrl&&n.ctrlKey||t.alt&&!n.altKey||!t.alt&&n.altKey||t.shift&&!n.shiftKey||!t.shift&&n.shiftKey||t.meta&&!n.metaKey||!t.meta&&n.metaKey)}function Qt(n,e){const t=n.target;if(e.scope){const s=typeof e.scope=="function"?e.scope():e.scope;if(s&&!s.contains(t))return!0}const r=t.tagName.toLowerCase(),i=t.isContentEditable;return r==="input"||r==="textarea"||i?n.key!=="Escape":!1}function Xt(n={}){const[e,t]=K(n.enabled??!0),r=new Map,i=n.debug??!1,s=d=>{if(e()){for(const[u,g]of r.entries())if(Wt(d,g)&&!Qt(d,g)&&!(g.condition&&!g.condition())){g.preventDefault!==!1&&d.preventDefault(),g.stopPropagation&&d.stopPropagation(),i&&console.log(`[KeyboardShortcuts] Triggered: ${u} (${g.key})`),g.handler(d);break}}},o=(d,u)=>{r.has(d)&&console.warn(`[KeyboardShortcuts] Shortcut '${d}' already registered, overwriting`),r.set(d,u),i&&console.log(`[KeyboardShortcuts] Registered: ${d} (${u.key})`)},a=d=>{const u=r.delete(d);i&&u&&console.log(`[KeyboardShortcuts] Unregistered: ${d}`)},c=()=>new Map(r);return typeof document<"u"&&(document.addEventListener("keydown",s),et(()=>{document.removeEventListener("keydown",s)})),{register:o,unregister:a,getAll:c,setEnabled:t,isEnabled:e}}function Jt(){if(typeof document>"u")return{announce:()=>{},clear:()=>{},destroy:()=>{}};let n=null,e=null;const t=[];let r=!1,i=null;const s=()=>{n=document.createElement("div"),n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true"),n.className="sr-only",n.id="announcer-polite",document.body.appendChild(n),e=document.createElement("div"),e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),e.className="sr-only",e.id="announcer-assertive",document.body.appendChild(e)},o=()=>{if(t.length===0){r=!1;return}r=!0;const u=t.shift(),g=u.priority==="assertive"?e:n;g?(g.textContent="",setTimeout(()=>{g.textContent=u.message,setTimeout(()=>{g.textContent="",o()},3e3)},100)):o()},a=(u,g={})=>{if(!u.trim())return;const{priority:S="polite",delay:C=0,clearQueue:U=!1}=g;U&&(t.length=0),t.push({message:u,priority:S,timestamp:Date.now()}),r||(C>0?i=window.setTimeout(()=>{o()},C):o())},c=()=>{t.length=0,i!==null&&(clearTimeout(i),i=null),n&&(n.textContent=""),e&&(e.textContent=""),r=!1},d=()=>{c(),n&&n.parentNode&&n.parentNode.removeChild(n),e&&e.parentNode&&e.parentNode.removeChild(e),n=null,e=null};return s(),et(()=>{d()}),{announce:a,clear:c,destroy:d}}let je=null;function Yt(){return je||(je=Jt()),je}function Fe(n,e){Yt().announce(n,e)}function Zt(n,e){return{revealNext(){let t=null;return e(r=>r>=n.length?r:(t=n[r],r+1)),t},reset(){e(0)},getRevealedHints(t){return n.slice(0,t)},areAllRevealed(t){return t>=n.length}}}function en(n,e){const[t,r]=n.range,i=[];for(const o of n.hops)o>0?i.push(`${e("accessibility.math.operations.plus")} ${o}`):o<0&&i.push(`${e("accessibility.math.operations.minus")} ${Math.abs(o)}`);const s=i.join(", ");return e("accessibility.visualAids.numberLine",{start:t.toString(),end:r.toString(),description:s||"no operations"})}function tn(n,e){const{hundreds:t=0,tens:r=0,ones:i=0}=n.breakdown;return e("accessibility.visualAids.placeValue",{hundreds:t.toString(),tens:r.toString(),ones:i.toString()})}function nn(n,e){const t=n.shapeType==="circle"?"accessibility.visualAids.fractionCircle":"accessibility.visualAids.fractionRectangle";return e(t,{numerator:n.numerator.toString(),denominator:n.denominator.toString()})}function rn(n,e){switch(n.diagramType){case"place-value":return tn(n,e);case"fraction":return nn(n,e);case"generic":default:const t=n.description;return e("accessibility.visualAids.genericDiagram",{description:t||"mathematical concept"})}}function sn(n,e){const t=n.description||"data visualization";return e("accessibility.visualAids.chart",{chartType:n.chartType,description:t})}function on(n){return n.alt}function an(n,e){try{switch(n.type){case"number-line":return en(n.data,e);case"diagram":return rn(n.data,e);case"chart":return sn(n.data,e);case"image":return on(n.data);default:return"Visual aid: mathematical diagram"}}catch(t){return console.error("Error generating visual aid description:",t),"Visual aid: mathematical diagram"}}function ln(n,e){switch(n.type){case"number-line":{const t=n.data,[r,i]=t.range;let s=`This is a number line visualization spanning from ${r} to ${i}. `;if(s+=`It starts at ${t.start}. `,t.hops.length>0){s+="The following operations are shown: ";let o=t.start;for(let a=0;a<t.hops.length;a++){const c=t.hops[a],d=o+c;c>0?s+=`Move forward ${c} from ${o} to ${d}. `:c<0&&(s+=`Move backward ${Math.abs(c)} from ${o} to ${d}. `),o=d}s+=`The final position is ${o}.`}return s}case"diagram":{const t=n.data;if(t.diagramType==="place-value"){const r=t,{hundreds:i=0,tens:s=0,ones:o=0}=r.breakdown;return`This place value diagram shows the number ${i*100+s*10+o} broken down into its components. It displays ${i} hundred block${i!==1?"s":""}, ${s} tens block${s!==1?"s":""}, and ${o} ones block${o!==1?"s":""}.`}if(t.diagramType==="fraction"){const r=t,{numerator:i,denominator:s,shapeType:o}=r;return`This fraction diagram uses a ${o==="circle"?"circle":"rectangular bar"} divided into ${s} equal parts. ${i} of these parts are shaded to represent the fraction ${i}/${s}.`}return null}default:return null}}var cn=x("<div class=sr-only>"),dn=x("<div><div role=img></div><!$><!/>"),un=x('<div class="number-line-container p-4"><svg viewBox="0 0 540 120"class="w-full h-auto"role=img><line x1=20 y1=60 x2=520 y2=60 stroke=currentColor stroke-width=2 class=text-gray-700></line><!$><!/><!$><!/><defs><marker id=arrowhead markerWidth=10 markerHeight=7 refX=9 refY=3.5 orient=auto><polygon points="0 0, 10 3.5, 0 7"fill=currentColor>'),gn=x("<svg><line y1=55 y2=65 stroke=currentColor stroke-width=2 class=text-gray-700></svg>",!1,!0,!1),hn=x('<svg><text y=85 text-anchor=middle class="text-sm font-medium fill-gray-700"></svg>',!1,!0,!1),fn=x("<svg><path fill=none stroke-width=2 marker-end=url(#arrowhead)></svg>",!1,!0,!1),mn=x('<svg><text text-anchor=middle class="text-sm font-bold"><!$><!/><!$><!/></svg>',!1,!0,!1),xn=x('<div class="p-4 bg-gray-100 rounded text-center text-gray-600"><p>Diagram type: <!$><!/></p><p class=text-sm>(Visualization coming soon)'),bn=x('<div class="diagram-container p-4">'),vn=x('<div class="place-value-diagram flex gap-4 justify-center items-end p-4">'),$n=x('<div class="place-column flex flex-col items-center gap-2"><div class="text-sm font-bold text-gray-700 capitalize"></div><div class="blocks flex flex-col-reverse gap-1"></div><div class="text-lg font-bold text-gray-800">'),yn=x('<div class="block w-16 h-16 rounded border-2 flex items-center justify-center font-bold text-lg">'),wn=x('<svg viewBox="0 0 200 200"class="w-48 h-48 mx-auto"><circle cx=100 cy=100 r=90 fill=white stroke=currentColor stroke-width=2 class=text-gray-700></circle><!$><!/>'),pn=x("<svg><line x1=100 y1=100 stroke=currentColor stroke-width=1 class=text-gray-700></svg>",!1,!0,!1),_n=x('<svg><path fill="rgb(147, 51, 234)"opacity=0.7></svg>',!1,!0,!1),Sn=x('<svg viewBox="0 0 200 80"class="w-full h-24 mx-auto"><rect x=0 y=10 width=200 height=60 fill=white stroke=currentColor stroke-width=2 class=text-gray-700></rect><!$><!/>'),kn=x("<svg><line y1=10 y2=70 stroke=currentColor stroke-width=1 class=text-gray-700></svg>",!1,!0,!1),Cn=x('<svg><rect y=11 height=58 fill="rgb(147, 51, 234)"opacity=0.7></svg>',!1,!0,!1),An=x('<div class="chart-container p-4 bg-gray-100 rounded text-center"><p class=text-gray-600><!$><!/>: <!$><!/></p><p class="text-sm text-gray-500">(Chart visualization coming soon)'),Tn=x('<div class="image-container p-4"><img class="max-w-full h-auto rounded shadow-md"loading=lazy>',!0,!1,!1);function Oe(n){const e=le(ce),t=Y(()=>an(n.visualAid,e())),r=Y(()=>ln(n.visualAid,e())),i=`visual-aid-desc-${Math.random().toString(36).substring(2,9)}`;return(()=>{var s=m(dn),o=s.firstChild,a=o.nextSibling,[c,d]=R(a.nextSibling);return l(o,h(Ne,{get children(){return[h(oe,{get when(){return n.visualAid.type==="number-line"},get children(){return h(In,{get data(){return n.visualAid.data}})}}),h(oe,{get when(){return n.visualAid.type==="diagram"},get children(){return h(En,{get data(){return n.visualAid.data}})}}),h(oe,{get when(){return n.visualAid.type==="chart"},get children(){return h(Un,{get data(){return n.visualAid.data}})}}),h(oe,{get when(){return n.visualAid.type==="image"},get children(){return h(Fn,{get data(){return n.visualAid.data}})}})]}})),l(s,h(P,{get when(){return r()},get children(){var u=m(cn);return w(u,"id",i),l(u,r),u}}),c,d),O(u=>{var g=`visual-aid ${n.class||""}`,S=t(),C=r()?i:void 0;return g!==u.e&&ie(s,u.e=g),S!==u.t&&w(o,"aria-label",u.t=S),C!==u.a&&w(o,"aria-describedby",u.a=C),u},{e:void 0,t:void 0,a:void 0}),s})()}function In(n){const e=le(ce),[t,r]=n.data.range,i=r-t+1,s=500,o=u=>(u-t)/(r-t)*s,a=Array.from({length:i},(u,g)=>t+g);let c=n.data.start;const d=n.data.hops.map(u=>{const g=c;return c+=u,{start:g,end:c,value:u}});return(()=>{var u=m(un),g=u.firstChild,S=g.firstChild,C=S.nextSibling,[U,E]=R(C.nextSibling),F=U.nextSibling,[b,A]=R(F.nextSibling);return b.nextSibling,l(g,h(he,{each:a,children:$=>{const y=o($)+20;return[(()=>{var k=m(gn);return w(k,"x1",y),w(k,"x2",y),k})(),(()=>{var k=m(hn);return w(k,"x",y),l(k,$),k})()]}}),U,E),l(g,h(he,{each:d,children:($,y)=>{const k=o($.start)+20,v=o($.end)+20,M=35-y()*10,I=$.value>0;return[(()=>{var T=m(fn);return w(T,"d",`M ${k} ${M} Q ${(k+v)/2} ${M-15} ${v} ${M}`),w(T,"stroke",I?"rgb(34, 197, 94)":"rgb(239, 68, 68)"),T})(),(()=>{var T=m(mn),D=T.firstChild,[j,B]=R(D.nextSibling),W=j.nextSibling,[X,p]=R(W.nextSibling);return w(T,"x",(k+v)/2),w(T,"y",M-20),w(T,"fill",I?"rgb(34, 197, 94)":"rgb(239, 68, 68)"),l(T,I?"+":"",j,B),l(T,()=>$.value,X,p),T})()]}}),b,A),O(()=>w(g,"aria-label",e()("solutions.numberLine"))),u})()}function En(n){return(()=>{var e=m(bn);return l(e,h(Ne,{get children(){return[h(oe,{get when(){return n.data.diagramType==="place-value"},get children(){return h(Mn,{get data(){return n.data}})}}),h(oe,{get when(){return n.data.diagramType==="fraction"},get children(){return h(Dn,{get data(){return n.data}})}}),h(oe,{when:!0,get children(){var t=m(xn),r=t.firstChild,i=r.firstChild,s=i.nextSibling,[o,a]=R(s.nextSibling);return l(r,()=>n.data.diagramType,o,a),t}})]}})),e})()}function Mn(n){const e=n.data.breakdown,t=Object.entries(e).reverse();return(()=>{var r=m(vn);return l(r,h(he,{each:t,children:([i,s])=>(()=>{var o=m($n),a=o.firstChild,c=a.nextSibling,d=c.nextSibling;return l(a,i),l(c,h(he,{get each(){return Array(s)},children:()=>(()=>{var u=m(yn);return l(u,i==="hundreds"?"100":i==="tens"?"10":"1"),O(g=>Se(u,{"bg-blue-200 border-blue-500 text-blue-900":i==="hundreds","bg-green-200 border-green-500 text-green-900":i==="tens","bg-yellow-200 border-yellow-500 text-yellow-900":i==="ones"},g)),u})()})),l(d,s),o})()})),r})()}function Dn(n){const e=n.data.numerator,t=n.data.denominator;return n.data.shapeType==="circle"?h(Rn,{numerator:e,denominator:t}):h(Pn,{numerator:e,denominator:t})}function Rn(n){const e=360/n.denominator,t=Array.from({length:n.denominator},(r,i)=>i);return(()=>{var r=m(wn),i=r.firstChild,s=i.nextSibling,[o,a]=R(s.nextSibling);return l(r,h(he,{each:t,children:c=>{const d=c*e-90,u=(c+1)*e-90,g=d*Math.PI/180,S=u*Math.PI/180,C=100+90*Math.cos(g),U=100+90*Math.sin(g),E=100+90*Math.cos(S),F=100+90*Math.sin(S);return[(()=>{var b=m(pn);return w(b,"x2",C),w(b,"y2",U),b})(),h(P,{get when(){return c<n.numerator},get children(){var b=m(_n);return w(b,"d",`M 100 100 L ${C} ${U} A 90 90 0 0 1 ${E} ${F} Z`),b}})]}}),o,a),r})()}function Pn(n){const e=Array.from({length:n.denominator},(t,r)=>r);return 100/n.denominator,(()=>{var t=m(Sn),r=t.firstChild,i=r.nextSibling,[s,o]=R(i.nextSibling);return l(t,h(he,{each:e,children:a=>{const c=a*200/n.denominator,d=200/n.denominator;return[h(P,{when:a>0,get children(){var u=m(kn);return w(u,"x1",c),w(u,"x2",c),u}}),h(P,{get when(){return a<n.numerator},get children(){var u=m(Cn);return w(u,"x",c+1),w(u,"width",d-2),u}})]}}),s,o),t})()}function Un(n){const e=le(ce);return(()=>{var t=m(An),r=t.firstChild,i=r.firstChild,[s,o]=R(i.nextSibling),a=s.nextSibling,c=a.nextSibling,[d,u]=R(c.nextSibling);return l(r,()=>e()("solutions.chartType"),s,o),l(r,()=>n.data.chartType,d,u),t})()}function Fn(n){return(()=>{var e=m(Tn),t=e.firstChild;return O(r=>{var i=n.data.src,s=n.data.alt,o=n.data.width,a=n.data.height;return i!==r.e&&w(t,"src",r.e=i),s!==r.t&&w(t,"alt",r.t=s),o!==r.a&&w(t,"width",r.a=o),a!==r.o&&w(t,"height",r.o=a),r},{e:void 0,t:void 0,a:void 0,o:void 0}),e})()}var Ln=x('<div class="solution-visual-aid mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200"><div class="text-sm font-medium text-purple-900 mb-3"></div><!$><!/>'),jn=x('<div role=region><div class="worked-solution-header mb-4 pb-3 border-b-2 border-purple-300"><h3 class="text-lg font-bold text-purple-900 flex items-center gap-2"><svg class="w-6 h-6"fill=none stroke=currentColor viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span></span></h3></div><div class="solution-steps space-y-4 mb-6"role=list></div><!$><!/><div class="final-answer p-4 rounded-lg bg-gradient-to-r from-green-100 to-green-200 border-2 border-green-400 shadow-md"role=status><div class="flex items-center gap-3"><svg class="w-8 h-8 text-green-700"fill=none stroke=currentColor viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-green-800 uppercase tracking-wide mb-1"></div><div class="text-xl font-bold text-green-900">'),Vn=x('<div class="step-visual-aid mt-3">'),Bn=x('<div class="solution-step p-4 rounded-lg bg-gradient-to-r from-purple-50 to-purple-100 border border-purple-200 shadow-sm transition-all duration-200 hover:shadow-md"role=listitem><div class="flex items-start gap-4"><div class="step-number flex-shrink-0 w-8 h-8 rounded-full bg-purple-600 text-white flex items-center justify-center font-bold text-sm shadow"aria-hidden=true></div><div class="step-content flex-1"><div class="step-explanation text-gray-700 font-medium mb-2"></div><div class="step-expression p-3 bg-white rounded border border-purple-200 font-mono text-lg text-purple-900 shadow-sm"></div><!$><!/>');function it(n){const e=le(ce);return qe(()=>{n.show!==!1&&n.show!==void 0&&Fe(e()("accessibility.screenReader.solutionRevealed"),{priority:"polite",delay:200})}),h(P,{get when(){return n.show!==!1},get children(){var t=m(jn),r=t.firstChild,i=r.firstChild,s=i.firstChild,o=s.nextSibling,a=r.nextSibling,c=a.nextSibling,[d,u]=R(c.nextSibling),g=d.nextSibling,S=g.firstChild,C=S.firstChild,U=C.nextSibling,E=U.firstChild,F=E.nextSibling;return l(o,()=>e()("solutions.stepByStepSolution")),l(a,h(he,{get each(){return n.solution.steps},children:(b,A)=>(()=>{var $=m(Bn),y=$.firstChild,k=y.firstChild,v=k.nextSibling,M=v.firstChild,I=M.nextSibling,T=I.nextSibling,[D,j]=R(T.nextSibling);return l(k,()=>A()+1),l(M,()=>b.explanation),l(I,()=>b.expression),l(v,h(P,{get when(){return b.visualAid},get children(){var B=m(Vn);return l(B,h(Oe,{get visualAid(){return b.visualAid}})),B}}),D,j),O(()=>w($,"aria-label",`${e()("solutions.step")} ${A()+1}`)),$})()})),l(t,h(P,{get when(){return n.solution.visualAid},get children(){var b=m(Ln),A=b.firstChild,$=A.nextSibling,[y,k]=R($.nextSibling);return l(A,()=>e()("solutions.overallVisualization")),l(b,h(Oe,{get visualAid(){return n.solution.visualAid}}),y,k),b}}),d,u),l(E,()=>e()("solutions.finalAnswer")),l(F,()=>n.solution.finalAnswer),O(b=>{var A=`worked-solution-container ${n.class||""}`,$=e()("solutions.workedSolutionLabel"),y=e()("solutions.solutionSteps"),k=e()("solutions.finalAnswer");return A!==b.e&&ie(t,b.e=A),$!==b.t&&w(t,"aria-label",b.t=$),y!==b.a&&w(a,"aria-label",b.a=y),k!==b.o&&w(g,"aria-label",b.o=k),b},{e:void 0,t:void 0,a:void 0,o:void 0}),t}})}var On=x('<span class="flex items-center gap-2"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg><span>'),Nn=x('<div class="hint-progress mt-2 text-sm text-gray-600"aria-live=polite>'),qn=x('<div class="revealed-hints space-y-4"role=list>'),Kn=x('<div class=hint-system role=region><div class="hint-button-container mb-4"><button type=button class="hint-button px-6 py-3 rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2"style=min-width:44px;min-height:44px></button><!$><!/></div><!$><!/>'),zn=x('<span class="flex items-center gap-2"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M5 13l4 4L19 7"></path></svg><span>'),Hn=x('<div class="hint-visual-aid mt-3 p-3 bg-white rounded border border-gray-200"role=img><div class="text-sm text-gray-600 mb-2 font-medium"></div><div class="text-xs text-gray-500">Type: <!$><!/>'),Gn=x('<div class="worked-solution-wrapper mt-4">'),Wn=x('<div class="hint-item p-4 rounded-lg border-l-4 transition-all duration-300 animate-fade-in"role=listitem><div class="flex items-start gap-3"><div class="hint-level-badge flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm"aria-hidden=true></div><div class="hint-content flex-1"><div class="hint-text text-gray-800 leading-relaxed whitespace-pre-line"></div><!$><!/><!$><!/>');function Qn(n){const e=le(ce),[t,r]=K(0),i=Zt(n.hints,r);qe(()=>{n.resetKey,i.reset()});const s=()=>{const d=i.revealNext();d&&(n.onHintRequested(d.level),Fe(e()("accessibility.screenReader.hintRevealed",{level:d.level.toString()}),{priority:"polite",delay:200}))},o=()=>i.getRevealedHints(t()),a=()=>i.areAllRevealed(t()),c=()=>n.hints.length;return(()=>{var d=m(Kn),u=d.firstChild,g=u.firstChild,S=g.nextSibling,[C,U]=R(S.nextSibling),E=u.nextSibling,[F,b]=R(E.nextSibling);g.$$click=s;var A=n.hintButtonRef;return typeof A=="function"?tt(A,g):n.hintButtonRef=g,l(g,h(P,{get when(){return!a()},get fallback(){return(()=>{var $=m(zn),y=$.firstChild,k=y.nextSibling;return l(k,()=>e()("hints.common.allHintsShown")),$})()},get children(){var $=m(On),y=$.firstChild,k=y.nextSibling;return l(k,(()=>{var v=ke(()=>t()===0);return()=>v()?e()("hints.common.getHint"):e()("hints.common.getNextHint")})()),$}})),l(u,h(P,{get when(){return t()>0},get children(){var $=m(Nn);return l($,()=>e()("hints.common.hintProgress",{current:t().toString(),total:c().toString()})),$}}),C,U),l(d,h(P,{get when(){return t()>0},get children(){var $=m(qn);return l($,h(he,{get each(){return o()},children:y=>(()=>{var k=m(Wn),v=k.firstChild,M=v.firstChild,I=M.nextSibling,T=I.firstChild,D=T.nextSibling,[j,B]=R(D.nextSibling),W=j.nextSibling,[X,p]=R(W.nextSibling);return l(M,()=>y.level),l(T,()=>y.text),l(I,h(P,{get when(){return y.visualAid},get children(){var f=m(Hn),V=f.firstChild,N=V.nextSibling,_=N.firstChild,z=_.nextSibling,[H,J]=R(z.nextSibling);return l(V,()=>e()("hints.common.visualAid")),l(N,()=>y.visualAid?.type,H,J),O(()=>w(f,"aria-label",e()("hints.common.visualAid"))),f}}),j,B),l(I,h(P,{get when(){return y.workedSolution},get children(){var f=m(Gn);return l(f,h(it,{get solution(){return y.workedSolution}})),f}}),X,p),O(f=>{var V={"bg-blue-50 border-blue-500":y.level===1,"bg-green-50 border-green-500":y.level===2,"bg-yellow-50 border-yellow-500":y.level===3,"bg-purple-50 border-purple-500":y.level===4},N=`${e()("hints.common.hintLevel")} ${y.level}`,_={"bg-blue-600 text-white":y.level===1,"bg-green-600 text-white":y.level===2,"bg-yellow-600 text-white":y.level===3,"bg-purple-600 text-white":y.level===4};return f.e=Se(k,V,f.e),N!==f.t&&w(k,"aria-label",f.t=N),f.a=Se(M,_,f.a),f},{e:void 0,t:void 0,a:void 0}),k})()})),O(()=>w($,"aria-label",e()("hints.common.revealedHints"))),$}}),F,b),O($=>{var y=e()("hints.common.hintProgress",{current:t().toString(),total:c().toString()}),k={"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":!a()&&!n.disabled,"bg-gray-300 text-gray-500 cursor-not-allowed":a()||n.disabled},v=a()||n.disabled,M=a()?e()("hints.common.allHintsShown"):`${e()("hints.common.hintProgress",{current:(t()+1).toString(),total:c().toString()})}`;return y!==$.e&&w(d,"aria-label",$.e=y),$.t=Se(g,k,$.t),v!==$.a&&Ue(g,"disabled",$.a=v),M!==$.o&&w(g,"aria-label",$.o=M),$},{e:void 0,t:void 0,a:void 0,o:void 0}),se(),d})()}Ce(["click"]);var Xn=x('<svg class="w-8 h-8 text-green-600"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z">'),Jn=x('<p class="text-base font-semibold text-orange-900 mt-2">'),Yn=x('<div class="visual-aid-section mb-6 p-4 bg-white rounded-lg border-2 border-gray-200 shadow-sm"><div class="text-sm font-medium text-gray-700 mb-3"></div><!$><!/>'),Zn=x('<div class="p-4 bg-white rounded-lg border-2 border-purple-200 shadow-sm">'),er=x('<div class="worked-solution-section mb-6"><button class="mb-4 px-5 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all flex items-center gap-2"aria-controls=worked-solution-content style=min-width:44px;min-height:44px><svg class="w-5 h-5 transition-transform duration-200"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M19 9l-7 7-7-7"></path></svg><span></span></button><div id=worked-solution-content>'),tr=x('<button class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all"style=min-width:44px;min-height:44px>'),nr=x('<div role=alert aria-live=polite aria-atomic=true><div class=feedback-content><div class="feedback-header flex items-start gap-4 mb-4"><div class=flex-shrink-0></div><div class=flex-1><h4 class="text-lg font-bold mb-2"></h4><p class="text-base mb-3"></p><!$><!/></div></div><!$><!/><!$><!/><div class="action-buttons flex gap-3 flex-wrap">'),rr=x('<svg class="w-8 h-8 text-orange-600"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">'),ir=x('<button class="px-6 py-3 bg-orange-600 text-white font-semibold rounded-lg hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-all"style=min-width:44px;min-height:44px>');function Ze(n){const e=le(ce),[t,r]=K(!1),i=()=>{r(s=>!s)};return(()=>{var s=m(nr),o=s.firstChild,a=o.firstChild,c=a.firstChild,d=c.nextSibling,u=d.firstChild,g=u.nextSibling,S=g.nextSibling,[C,U]=R(S.nextSibling),E=a.nextSibling,[F,b]=R(E.nextSibling),A=F.nextSibling,[$,y]=R(A.nextSibling),k=$.nextSibling;return l(c,h(P,{get when(){return n.isCorrect},get fallback(){return m(rr)},get children(){return m(Xn)}})),l(u,(()=>{var v=ke(()=>!!n.isCorrect);return()=>v()?e()("feedback.correct.title"):e()("feedback.incorrect.title")})()),l(g,()=>n.message),l(d,h(P,{get when(){return!n.isCorrect},get children(){var v=m(Jn);return l(v,()=>e()("feedback.incorrect.showCorrect",{answer:n.correctAnswer})),v}}),C,U),l(o,h(P,{get when(){return n.visualAid},get children(){var v=m(Yn),M=v.firstChild,I=M.nextSibling,[T,D]=R(I.nextSibling);return l(M,()=>e()("hints.common.visualAid")),l(v,h(Oe,{get visualAid(){return n.visualAid}}),T,D),v}}),F,b),l(o,h(P,{get when(){return n.workedSolution},get children(){var v=m(er),M=v.firstChild,I=M.firstChild,T=I.nextSibling,D=M.nextSibling;return M.$$click=i,l(T,(()=>{var j=ke(()=>!!t());return()=>j()?e()("feedback.incorrect.hideSolution"):e()("feedback.incorrect.viewSolution")})()),l(D,h(P,{get when(){return t()},get children(){var j=m(Zn);return l(j,h(it,{get solution(){return n.workedSolution},show:!0})),j}})),O(j=>{var B=t(),W=!!t();return B!==j.e&&w(M,"aria-expanded",j.e=B),W!==j.t&&I.classList.toggle("rotate-180",j.t=W),j},{e:void 0,t:void 0}),se(),v}}),$,y),l(k,h(P,{get when(){return n.isCorrect},get fallback(){return h(P,{get when(){return n.onTryAgain},get children(){var v=m(ir);return Me(v,"click",n.onTryAgain),l(v,()=>e()("feedback.incorrect.tryAgain")),O(()=>w(v,"aria-label",e()("feedback.incorrect.tryAgain"))),se(),v}})},get children(){return h(P,{get when(){return n.onContinue},get children(){var v=m(tr);return Me(v,"click",n.onContinue),l(v,()=>e()("feedback.correct.continue")),O(()=>w(v,"aria-label",e()("feedback.correct.continue"))),se(),v}})}})),O(v=>{var M=`feedback-display-container mb-6 p-6 rounded-lg border-2 transition-all duration-300 animate-slide-in ${n.class||""}`,I={"bg-green-50 border-green-400":n.isCorrect,"bg-orange-50 border-orange-400":!n.isCorrect},T=!!n.isCorrect,D=!n.isCorrect,j=!!n.isCorrect,B=!n.isCorrect;return M!==v.e&&ie(s,v.e=M),v.t=Se(s,I,v.t),T!==v.a&&u.classList.toggle("text-green-900",v.a=T),D!==v.o&&u.classList.toggle("text-orange-900",v.o=D),j!==v.i&&g.classList.toggle("text-green-800",v.i=j),B!==v.n&&g.classList.toggle("text-orange-800",v.n=B),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),s})()}Ce(["click"]);function sr(n){return/^-?\d+(\.\d+)?$/.test(n.trim())}function or(n){const e=n.trim();if(!sr(e))return null;const t=parseFloat(e),r=e.includes(".");return{type:"number",value:t,isDecimal:r,originalText:n}}function ar(n){const e=/^(\d+)\s*\/\s*(\d+)$/,t=n.trim().match(e);if(!t)return null;const r=parseInt(t[1],10),i=parseInt(t[2],10);return i===0?null:{type:"fraction",numerator:r,denominator:i,originalText:n}}function lr(n){const e=/^(.+?)\s*([\+\-\*\/])\s*(.+)$/,t=n.trim().match(e);if(!t)return null;const r=t[1],i=t[2],s=t[3],o=Re(r),a=Re(s);return{type:"operation",left:o,operator:i,right:a,originalText:n}}function cr(n){const e=/^(.+?)\s*=\s*(.+)$/,t=n.trim().match(e);if(!t)return null;const r=t[1],i=t[2],s=Re(r),o=Re(i);return{type:"equation",left:s,right:o,originalText:n}}function Re(n){const e=n.trim();if(e.includes("=")){const s=cr(e);if(s)return s}const t=ar(e);if(t)return t;const r=or(e);if(r)return r;const i=lr(e);return i||{type:"text",text:e,originalText:n}}function dr(n){const e=/[\+\-\*\/\=]/,t=/\d+\s*\/\s*\d+/,r=/\d/;return e.test(n)||t.test(n)||r.test(n)&&n.trim().split(/\s+/).length<=3}function ur(n){return n.value.toString()}function gr(n,e){const{numerator:t,denominator:r}=n;return t===1&&r===2?e("accessibility.math.fractions.oneHalf"):t===1&&r===3?e("accessibility.math.fractions.oneThird"):t===1&&r===4?e("accessibility.math.fractions.oneQuarter"):t===2&&r===3?e("accessibility.math.fractions.twoThirds"):t===3&&r===4?e("accessibility.math.fractions.threeQuarters"):e("accessibility.math.fractions.generic",{numerator:t.toString(),denominator:r.toString()})}function hr(n,e){switch(n){case"+":return e("accessibility.math.operations.plus");case"-":return e("accessibility.math.operations.minus");case"":case"*":return e("accessibility.math.operations.times");case"":case"/":return e("accessibility.math.operations.dividedBy");default:return n}}function fr(n,e){const t=Pe(n.left,e),r=hr(n.operator,e),i=Pe(n.right,e);return`${t} ${r} ${i}`}function mr(n,e){const t=Pe(n.left,e),r=e("accessibility.math.operations.equals"),i=Pe(n.right,e);return`${t} ${r} ${i}`}function Pe(n,e){switch(n.type){case"number":return ur(n);case"fraction":return gr(n,e);case"operation":return fr(n,e);case"equation":return mr(n,e);case"text":return n.text;default:return n.originalText}}var xr=x("<span>");function br(n){const e=le(ce),t=Y(()=>dr(n.expression)),r=Y(()=>t()?Re(n.expression):null),i=Y(()=>{const a=r();if(!a)return n.expression;try{return Pe(a,e())}catch(c){return console.error("Error converting math to speech:",c),n.expression}}),s=Y(()=>t()),o=Y(()=>{const a=n.class||"",c=n.display==="block"?"block":"inline",d=s()?"math-expression font-mono":"";return`${a} ${c} ${d}`.trim()});return(()=>{var a=m(xr);return l(a,()=>n.expression),O(c=>{var d=o(),u=s()?"math":void 0,g=s()?i():void 0;return d!==c.e&&ie(a,c.e=d),u!==c.t&&w(a,"role",c.t=u),g!==c.a&&w(a,"aria-label",c.a=g),c},{e:void 0,t:void 0,a:void 0}),a})()}var vr=x('<div role=main><div class="progress-section mb-8"role=region><div class="flex items-center justify-between mb-3"><h2 class="text-lg font-semibold text-gray-700"></h2><span class="text-sm text-gray-600"><!$><!/>%</span></div><div class="progress-bar w-full h-3 bg-gray-200 rounded-full overflow-hidden"role=progressbar aria-valuemin=1><div class="progress-fill h-full bg-blue-600 transition-all duration-500 ease-out"></div></div></div><!$><!/>'),$r=x('<div class="text-center text-gray-600">'),yr=x('<span class="text-xs px-3 py-1 rounded-full bg-purple-100 text-purple-700 font-medium">'),wr=x('<button type=submit class="px-6 py-3 font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2"style=min-width:44px;min-height:44px>'),pr=x('<button class="px-5 py-2 text-gray-600 font-medium rounded hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-all text-sm"style=min-height:44px>'),_r=x('<div class="skip-section flex justify-end">'),Sr=x('<div class="exercise-content bg-white rounded-lg shadow-md p-8"><div class="question-section mb-8"role=region><h3 class="text-xl font-bold text-gray-900 mb-4"></h3><div class="question-text text-2xl font-medium text-gray-800 leading-relaxed p-6 bg-blue-50 rounded-lg border-2 border-blue-200"></div><div class="mt-4 flex gap-3 flex-wrap"><span class="text-xs px-3 py-1 rounded-full bg-gray-100 text-gray-700"></span><!$><!/></div></div><form class="answer-section mb-6"><label for=answer-input class="block text-lg font-semibold text-gray-700 mb-3"></label><div class="flex gap-3"><input id=answer-input type=text class="flex-1 px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed transition-all"aria-required=true style=min-height:44px><!$><!/></div></form><!$><!/><!$><!/><div class="hint-section mb-6"></div><!$><!/>'),kr=x('<div class="skip-confirm flex items-center gap-3 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg"><p class="text-sm text-yellow-900 font-medium"></p><button class="px-4 py-2 bg-yellow-600 text-white font-medium rounded hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all text-sm"style=min-height:44px></button><button class="px-4 py-2 bg-gray-300 text-gray-700 font-medium rounded hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-all text-sm"style=min-height:44px>');function Cr(n){const e=le(ce),[t,r]=K(""),[i,s]=K({status:"pending"}),[o,a]=K(0),[c,d]=K(Date.now()),[u,g]=K(!1),[S,C]=K();let U;const E=Xt();E.register("hint",{key:"h",description:"Get hint",handler:()=>{U&&!U.disabled&&U.click()},condition:()=>i().status!=="validating"}),E.register("skip",{key:"s",description:"Skip exercise",handler:()=>{const _=i();(_.status==="pending"||_.status==="validating")&&(u()||D())},condition:()=>{const _=i();return _.status==="pending"||_.status==="validating"}}),E.register("continue",{key:"Enter",description:"Continue to next exercise",handler:()=>{const _=i();_.status==="correct"?T():_.status==="incorrect"&&I()},condition:()=>{const _=i();return _.status==="correct"||_.status==="incorrect"}});const F=()=>n.exercises[n.currentIndex],b=()=>n.currentIndex>=n.exercises.length-1,A=()=>n.exercises.length;qe(()=>{if(n.currentIndex,F()){r(""),s({status:"pending"}),a(0),d(Date.now()),g(!1);const z=n.currentIndex+1,H=A();Fe(e()("accessibility.screenReader.newQuestionLoaded",{current:z.toString(),total:H.toString()}),{priority:"polite",delay:300});const J=Math.round(z/H*100);(J===25||J===50||J===75)&&Fe(e()("accessibility.screenReader.progressMilestone",{percent:J.toString()}),{priority:"polite",delay:600}),setTimeout(()=>{S()?.focus()},100)}}),vt(()=>{S()?.focus()});const $=_=>{a(z=>z+1)},y=()=>Math.floor((Date.now()-c())/1e3),k=_=>_.trim(),v=_=>{r(_)},M=async _=>{_?.preventDefault();const z=k(t());if(!z)return;const H=F();if(H){s({status:"validating"});try{const J=H.templateId,fe=H.metadata.competencyAreaId,we=z.toLowerCase()===String(H.correctAnswer.value).toLowerCase(),pe=y(),me={exerciseId:H.id,templateId:H.templateId,correct:we,timeSpentSeconds:pe,hintsUsed:o(),userAnswer:z};if(we){const Z=e()("feedback.correct.messages"),xe=Z[Math.floor(Math.random()*Z.length)];s({status:"correct",message:xe}),n.onExerciseComplete(me)}else{const Z=e()("feedback.incorrect.messages"),xe=Z[Math.floor(Math.random()*Z.length)];s({status:"incorrect",message:xe,correctAnswer:String(H.correctAnswer.value)}),n.onExerciseComplete(me)}}catch(J){console.error("Error validating answer:",J);const fe=k(t())===String(F()?.correctAnswer.value);s({status:fe?"correct":"incorrect",message:fe?e()("feedback.correct.title"):e()("feedback.incorrect.title"),correctAnswer:String(F()?.correctAnswer.value)})}}},I=()=>{r(""),s({status:"pending"}),S()?.focus()},T=()=>{b()&&n.onSessionComplete()},D=()=>{g(!0)},j=()=>{const _=F();if(!_)return;const z=y(),H={exerciseId:_.id,templateId:_.templateId,correct:!1,timeSpentSeconds:z,hintsUsed:o(),userAnswer:"",skipped:!0};n.onSkip(H),g(!1)},B=()=>{g(!1)},W=_=>{_.key==="Enter"&&(_.preventDefault(),M())},X=F(),p=i(),f=p.status==="validating",V=p.status==="correct"||p.status==="incorrect";p.status;const N=p.status==="incorrect";return(()=>{var _=m(vr),z=_.firstChild,H=z.firstChild,J=H.firstChild,fe=J.nextSibling,we=fe.firstChild,[pe,me]=R(we.nextSibling);pe.nextSibling;var Z=H.nextSibling,xe=Z.firstChild,ee=z.nextSibling,[te,de]=R(ee.nextSibling);return l(J,()=>e()("exercises.session.progress",{current:(n.currentIndex+1).toString(),total:A().toString()})),l(fe,()=>Math.round((n.currentIndex+1)/A()*100),pe,me),l(_,h(P,{when:X,get fallback(){return(()=>{var L=m($r);return l(L,()=>e()("errors.exercise.notFound")),L})()},children:L=>(()=>{var ne=m(Sr),ae=ne.firstChild,ue=ae.firstChild,Ae=ue.nextSibling,Te=Ae.nextSibling,Ie=Te.firstChild,st=Ie.nextSibling,[ot,at]=R(st.nextSibling),Le=ae.nextSibling,Ke=Le.firstChild,ze=Ke.nextSibling,ge=ze.firstChild,lt=ge.nextSibling,[ct,dt]=R(lt.nextSibling),ut=Le.nextSibling,[He,gt]=R(ut.nextSibling),ht=He.nextSibling,[Ge,ft]=R(ht.nextSibling),We=Ge.nextSibling,mt=We.nextSibling,[xt,bt]=R(mt.nextSibling);return l(ue,()=>e()("exercises.exercise.question")),l(Ae,h(br,{get expression(){return L().questionText},class:"text-2xl"})),l(Ie,()=>e()("exercises.exercise.difficulty",{level:L().metadata.difficulty})),l(Te,h(P,{get when(){return L().metadata.isBinding},get children(){var q=m(yr);return l(q,()=>e()("exercises.exercise.bindingContent")),q}}),ot,at),Le.addEventListener("submit",M),l(Ke,()=>e()("exercises.exercise.yourAnswer")),ge.$$keydown=W,ge.$$input=q=>v(q.currentTarget.value),tt(C,ge),Ue(ge,"disabled",V||f),w(ge,"aria-invalid",N),l(ze,h(P,{when:!V,get children(){var q=m(wr);return l(q,h(P,{when:f,get fallback(){return e()("exercises.exercise.checkAnswer")},get children(){return e()("exercises.validation.checking")}})),O(G=>{var be=!t().trim()||f,ve={"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":!f&&t().trim(),"bg-gray-300 text-gray-500 cursor-not-allowed":!t().trim()||f},Ee=e()("exercises.exercise.checkAnswer");return be!==G.e&&Ue(q,"disabled",G.e=be),G.t=Se(q,ve,G.t),Ee!==G.a&&w(q,"aria-label",G.a=Ee),G},{e:void 0,t:void 0,a:void 0}),q}}),ct,dt),l(ne,h(P,{get when(){return V&&p.status==="correct"},get children(){return h(Ze,{isCorrect:!0,get message(){return p.message},get correctAnswer(){return String(L().correctAnswer.value)},get userAnswer(){return t()},get workedSolution(){return L().workedSolution},get visualAid(){return L().visualAid},onContinue:T})}}),He,gt),l(ne,h(P,{get when(){return V&&p.status==="incorrect"},get children(){return h(Ze,{isCorrect:!1,get message(){return p.message},get correctAnswer(){return ke(()=>"correctAnswer"in p)()?p.correctAnswer:String(L().correctAnswer.value)},get userAnswer(){return t()},get workedSolution(){return L().workedSolution},get visualAid(){return L().visualAid},onTryAgain:I})}}),Ge,ft),l(We,h(Qn,{get hints(){return L().hints},onHintRequested:$,disabled:f,get resetKey(){return L().id},hintButtonRef:q=>U=q})),l(ne,h(P,{when:!V,get children(){var q=m(_r);return l(q,h(P,{get when(){return!u()},get fallback(){return(()=>{var G=m(kr),be=G.firstChild,ve=be.nextSibling,Ee=ve.nextSibling;return l(be,()=>e()("exercises.session.confirmQuit")),ve.$$click=j,l(ve,()=>e()("common.actions.confirm")),Ee.$$click=B,l(Ee,()=>e()("common.actions.cancel")),se(),G})()},get children(){var G=m(pr);return G.$$click=D,l(G,()=>e()("exercises.exercise.skipExercise")),O(()=>w(G,"aria-label",e()("exercises.exercise.skipExercise"))),se(),G}})),q}}),xt,bt),O(q=>{var G=e()("exercises.exercise.question"),be=e()("exercises.exercise.placeholder"),ve=e()("exercises.exercise.yourAnswer");return G!==q.e&&w(ae,"aria-label",q.e=G),be!==q.t&&w(ge,"placeholder",q.t=be),ve!==q.a&&w(ge,"aria-label",q.a=ve),q},{e:void 0,t:void 0,a:void 0}),O(()=>Ue(ge,"value",t())),se(),ne})()}),te,de),O(L=>{var ne=`exercise-practice-container max-w-4xl mx-auto p-6 ${n.class||""}`,ae=e()("exercises.session.title"),ue=e()("exercises.session.progress",{current:(n.currentIndex+1).toString(),total:A().toString()}),Ae=n.currentIndex+1,Te=A(),Ie=`${(n.currentIndex+1)/A()*100}%`;return ne!==L.e&&ie(_,L.e=ne),ae!==L.t&&w(_,"aria-label",L.t=ae),ue!==L.a&&w(z,"aria-label",L.a=ue),Ae!==L.o&&w(Z,"aria-valuenow",L.o=Ae),Te!==L.i&&w(Z,"aria-valuemax",L.i=Te),Ie!==L.n&&$t(xe,"width",L.n=Ie),L},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),_})()}Ce(["input","keydown","click"]);var Ar=x('<div class="mb-8 p-6 bg-yellow-50 border border-yellow-200 rounded-lg"><h2 class="text-lg font-semibold text-yellow-900 mb-4 text-center">Achievements Unlocked!</h2><div class="grid grid-cols-1 sm:grid-cols-2 gap-3">'),Tr=x('<div class=text-center><div class="text-3xl font-bold text-yellow-600 mb-1"></div><div class="text-sm text-gray-600">'),Ir=x('<div class=text-center><div class="text-3xl font-bold text-gray-600 mb-1"></div><div class="text-sm text-gray-600">'),Er=x('<div class="text-center col-span-2"><div class="text-3xl font-bold text-indigo-600 mb-1">+<!$><!/></div><div class="text-sm text-gray-600">'),Mr=x('<div><div class="text-center mb-8"><div class="text-6xl mb-4"aria-hidden=true></div><h1 class="text-3xl font-bold text-gray-900 mb-2"></h1><p class="text-xl text-gray-700"></p></div><!$><!/><div class="mb-8 p-6 bg-white border border-gray-200 rounded-lg shadow-sm"><h2 class="text-xl font-semibold text-gray-900 mb-6"></h2><div class="grid grid-cols-2 gap-6"><div class=text-center><div class="text-3xl font-bold text-blue-600 mb-1"></div><div class="text-sm text-gray-600"></div></div><div class=text-center><div class="text-3xl font-bold text-green-600 mb-1"></div><div class="text-sm text-gray-600"></div></div><div class=text-center><div class="text-3xl font-bold text-purple-600 mb-1"><!$><!/>%</div><div class="text-sm text-gray-600"></div></div><div class=text-center><div class="text-3xl font-bold text-orange-600 mb-1"></div><div class="text-sm text-gray-600"></div></div><!$><!/><!$><!/><!$><!/></div></div><div class=space-y-3><button type=button class="w-full py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold text-lg rounded-lg transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-md hover:shadow-lg"></button><button type=button class="w-full py-4 px-6 bg-green-600 hover:bg-green-700 text-white font-semibold text-lg rounded-lg transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 shadow-md hover:shadow-lg"></button><button type=button class="w-full py-4 px-6 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold text-lg rounded-lg transition-colors min-h-[44px] focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 shadow-sm hover:shadow-md">'),Dr=x('<div class="flex items-center p-3 bg-white rounded-lg shadow-sm"><span class="text-2xl mr-3"aria-hidden=true></span><span class="text-sm font-medium text-gray-800">');function Rr(n){const e=le(ce),t=Y(()=>n.stats.totalExercises===0?0:Math.round(n.stats.correctCount/n.stats.totalExercises*100)),r=Y(()=>{const o=Math.round(n.stats.avgTimeSeconds),a=Math.floor(o/60),c=o%60;return`${a}:${c.toString().padStart(2,"0")}`}),i=Y(()=>{const o=t();return o>=90?e()("exercises.session.summary.excellentWork"):o>=70?e()("exercises.session.summary.goodProgress"):e()("exercises.session.summary.keepPracticing")}),s=Y(()=>{const o=[];return t()===100&&o.push("perfectScore"),n.stats.hintsUsed===0&&n.stats.correctCount>0&&o.push("noHints"),n.stats.avgTimeSeconds<30&&o.push("fastLearner"),n.stats.totalExercises>=30&&o.push("persistent"),o});return(()=>{var o=m(Mr),a=o.firstChild,c=a.firstChild,d=c.nextSibling,u=d.nextSibling,g=a.nextSibling,[S,C]=R(g.nextSibling),U=S.nextSibling,E=U.firstChild,F=E.nextSibling,b=F.firstChild,A=b.firstChild,$=A.nextSibling,y=b.nextSibling,k=y.firstChild,v=k.nextSibling,M=y.nextSibling,I=M.firstChild,T=I.firstChild,[D,j]=R(T.nextSibling);D.nextSibling;var B=I.nextSibling,W=M.nextSibling,X=W.firstChild,p=X.nextSibling,f=W.nextSibling,[V,N]=R(f.nextSibling),_=V.nextSibling,[z,H]=R(_.nextSibling),J=z.nextSibling,[fe,we]=R(J.nextSibling),pe=U.nextSibling,me=pe.firstChild,Z=me.nextSibling,xe=Z.nextSibling;return l(d,()=>e()("exercises.session.summary.title")),l(u,i),l(o,h(P,{get when(){return s().length>0},get children(){var ee=m(Ar),te=ee.firstChild,de=te.nextSibling;return l(de,h(he,{get each(){return s()},children:L=>(()=>{var ne=m(Dr),ae=ne.firstChild,ue=ae.nextSibling;return l(ue,()=>e()(`exercises.session.summary.achievements.${L}`)),ne})()})),ee}}),S,C),l(E,()=>e()("exercises.session.summary.statistics.title")),l(A,()=>n.stats.totalExercises),l($,()=>e()("exercises.session.summary.statistics.total")),l(k,()=>n.stats.correctCount),l(v,()=>e()("exercises.session.summary.statistics.correct")),l(I,t,D,j),l(B,()=>e()("exercises.session.summary.statistics.accuracy")),l(X,r),l(p,()=>e()("exercises.session.summary.statistics.avgTime")),l(F,h(P,{get when(){return n.stats.hintsUsed>0},get children(){var ee=m(Tr),te=ee.firstChild,de=te.nextSibling;return l(te,()=>n.stats.hintsUsed),l(de,()=>e()("exercises.session.summary.statistics.hintsUsed")),ee}}),V,N),l(F,h(P,{get when(){return n.stats.skippedCount>0},get children(){var ee=m(Ir),te=ee.firstChild,de=te.nextSibling;return l(te,()=>n.stats.skippedCount),l(de,()=>e()("exercises.session.summary.statistics.skipped")),ee}}),z,H),l(F,h(P,{get when(){return ke(()=>n.masteryGain!==void 0)()&&n.masteryGain>0},get children(){var ee=m(Er),te=ee.firstChild,de=te.firstChild,L=de.nextSibling,[ne,ae]=R(L.nextSibling),ue=te.nextSibling;return l(te,()=>n.masteryGain,ne,ae),l(ue,()=>e()("exercises.session.summary.statistics.masteryGain")),ee}}),fe,we),Me(me,"click",n.onPracticeAgain),l(me,()=>e()("exercises.session.summary.actions.practiceAgain")),Me(Z,"click",n.onViewProgress),l(Z,()=>e()("exercises.session.summary.actions.viewProgress")),Me(xe,"click",n.onReturnToDashboard),l(xe,()=>e()("exercises.session.summary.actions.dashboard")),O(()=>ie(o,`session-summary ${n.class||""}`)),se(),o})()}Ce(["click"]);var Pr=x('<div class="text-center py-12"><div class="text-red-600 text-xl font-semibold mb-4">Error</div><p class="text-gray-700 mb-6"></p><button type=button class="py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">Try Again'),Ur=x("<div>");function Or(n){const[e,t]=K("setup"),[r,i]=K(""),[s,o]=K([]),[a,c]=K(0),[d,u]=K(""),[g,S]=K(0),[C,U]=K(0),[E,F]=K(0),[b,A]=K(0),[$,y]=K(Date.now()),k=Y(()=>{const p=s(),f=a();return p[f]||null}),v=Y(()=>a()>=s().length-1),M=async p=>{try{const f=await yt(n.userId,n.gradeRange,n.competencyAreaId);i(f.id);const V=p.difficulty==="Auto"?void 0:p.difficulty,N=await Nt({competencyAreaId:n.competencyAreaId,gradeRange:n.gradeRange,difficulty:V},p.exerciseCount,{locale:n.locale});o(N),c(0),y(Date.now()),t("practicing")}catch(f){console.error("Failed to start session:",f),u("Failed to start session. Please try again."),t("error")}},I=async p=>{try{const f=k();if(!f)return;const V=Math.round((Date.now()-$())/1e3);A(b()+V),p.correct&&S(g()+1),U(C()+p.hintsUsed),await Qe({userId:n.userId,sessionId:r(),templateId:f.templateId,competencyAreaId:n.competencyAreaId,skillId:f.metadata.skillId||"unknown",difficulty:f.metadata.difficulty,isBinding:f.metadata.isBinding,correct:p.correct,timeSpentSeconds:V,hintsUsed:p.hintsUsed,userAnswer:p.userAnswer});const N=a()+1;N%5===0&&await pt(r(),N,g()),v()?await D():(c(a()+1),y(Date.now()))}catch(f){console.error("Failed to log exercise attempt:",f),v()?await D():(c(a()+1),y(Date.now()))}},T=async p=>{try{const f=k();if(!f)return;const V=Math.round((Date.now()-$())/1e3);A(b()+V),F(E()+1),U(C()+p.hintsUsed),await Qe({userId:n.userId,sessionId:r(),templateId:f.templateId,competencyAreaId:n.competencyAreaId,skillId:f.metadata.skillId||"unknown",difficulty:f.metadata.difficulty,isBinding:f.metadata.isBinding,correct:!1,timeSpentSeconds:V,hintsUsed:p.hintsUsed,userAnswer:p.userAnswer||""}),v()?await D():(c(a()+1),y(Date.now()))}catch(f){console.error("Failed to log skipped exercise:",f),v()?await D():(c(a()+1),y(Date.now()))}},D=async()=>{try{const p=s().length,f=p>0?b()/p:0;await wt(r(),p,g(),f),t("complete")}catch(p){console.error("Failed to end session:",p),t("complete")}},j=()=>{i(""),o([]),c(0),S(0),U(0),F(0),A(0),t("setup")},B=()=>{window.location.href="/dashboard"},W=()=>{window.location.href="/dashboard"},X=Y(()=>({totalExercises:s().length,correctCount:g(),avgTimeSeconds:s().length>0?b()/s().length:0,hintsUsed:C(),skippedCount:E()}));return(()=>{var p=m(Ur);return l(p,h(Ne,{get children(){return[h(oe,{get when(){return e()==="setup"},get children(){return h(Ht,{get isFirstTime(){return n.isFirstTime},onStart:M})}}),h(oe,{get when(){return ke(()=>e()==="practicing")()&&k()},get children(){return h(Cr,{get exercises(){return s()},get currentIndex(){return a()},get sessionId(){return r()},onExerciseComplete:I,onSkip:T,onSessionComplete:D})}}),h(oe,{get when(){return e()==="complete"},get children(){return h(Rr,{get stats(){return X()},onPracticeAgain:j,onViewProgress:B,onReturnToDashboard:W})}}),h(oe,{get when(){return e()==="error"},get children(){var f=m(Pr),V=f.firstChild,N=V.nextSibling,_=N.nextSibling;return l(N,d),_.$$click=()=>t("setup"),se(),f}})]}})),O(()=>ie(p,`practice-session-wrapper max-w-4xl mx-auto px-4 py-8 ${n.class||""}`)),p})()}Ce(["click"]);export{Or as default};
