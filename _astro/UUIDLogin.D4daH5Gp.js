import{d as ye,c as p,o as Ce,g as $,a as A,i as a,s as g,b as E,e as P,r as Ee,t as _,f as B,h as D,S as k,m as De}from"./store.D7pQqe3Y.js";import{m as ke,$ as Le}from"./store.CLE7GteW.js";import{v as z}from"./uuid.BUVVKM1U.js";var Ie=_('<div id=uuid-error class="mt-2 text-sm text-red-700"role=alert aria-live=polite>'),Te=_('<div class="flex items-center justify-center gap-3"><div class="w-5 h-5 border-3 border-white border-t-transparent rounded-full animate-spin"aria-hidden=true></div><span>'),Ue=_('<div role=region><div class="login-container max-w-md mx-auto"><div class="text-center mb-6"><h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2"></h2><p class="text-base text-gray-600"></p></div><form novalidate><div class="form-group mb-4"><label for=uuid-input class="block text-sm font-medium text-gray-700 mb-2"></label><input type=text id=uuid-input autocomplete=off autocorrect=off autocapitalize=off maxlength=19><!$><!/></div><div class="form-group mb-6"><label class="flex items-center gap-3 cursor-pointer select-none"><input type=checkbox class="w-5 h-5 min-w-44px min-h-44px text-blue-600 border-2 border-gray-300 rounded focus:ring-4 focus:ring-blue-300 cursor-pointer"><span class="text-sm font-medium text-gray-700"></span></label></div><!$><!/><!$><!/><button type=submit></button></form><div class="mt-6 text-center text-sm text-gray-600"><span></span><a href=/generate class="text-blue-600 hover:text-blue-700 font-medium underline focus:outline-none focus:ring-2 focus:ring-blue-300 rounded"></a><span>'),Me=_('<div class="mt-1 text-xs text-red-800">'),Re=_('<div class="error-banner mb-4 p-4 bg-red-100 border-2 border-red-400 rounded-lg"role=alert aria-live=assertive><div class="flex items-start gap-3"><svg class="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-red-900"></div><!$><!/>'),Ae=_('<div class="rate-limit-banner mb-4 p-4 bg-orange-100 border-2 border-orange-400 rounded-lg"role=alert aria-live=assertive><div class="flex items-start gap-3"><svg class="w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5"fill=none stroke=currentColor viewBox="0 0 24 24"aria-hidden=true><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class=flex-1><div class="text-sm font-medium text-orange-900">');const V="math-remember-uuid",F=5,le=6e4;function je(W){const r=ke(Le),[s,f]=p({status:"idle"}),[L,X]=p(""),[H,J]=p(!1),[S,w]=p(null),[K,N]=p(0),[I,O]=p(null);Ce(()=>{try{const t=localStorage.getItem(V);t&&z(t)&&(X(t),J(!0))}catch(t){console.error("Error reading from localStorage:",t)}});const Y=t=>{w(null);const i=t.replace(/[^0-9a-fA-F]/g,"").substring(0,16);let l="";for(let n=0;n<i.length;n++)n>0&&n%4===0&&(l+="-"),l+=i[n];X(l)},oe=t=>{t.preventDefault();const o=t.clipboardData?.getData("text")||"";Y(o)},de=()=>{const t=L().trim();t&&!z(t)&&w(r()("auth.login.invalidFormat"))},ue=()=>{const t=Date.now(),o=I();if(o&&t>o)N(1),O(t+le);else{const i=K()+1;if(N(i),o||O(t+le),i>=F){const l=(I()||t)-t,n=Math.ceil(l/1e3);f({status:"rateLimited",remainingSeconds:n,attemptsRemaining:0}),ce()}}},ce=()=>{const t=setInterval(()=>{const o=Date.now(),i=I();if(!i||o>i)N(0),O(null),f({status:"idle"}),clearInterval(t);else{const l=i-o,n=Math.ceil(l/1e3);f({status:"rateLimited",remainingSeconds:n,attemptsRemaining:0})}},1e3)},me=async t=>{if(t.preventDefault(),s().status==="rateLimited")return;const i=L().trim();if(!i){w(r()("auth.login.invalidFormat"));return}if(!z(i)){w(r()("auth.login.invalidFormat"));return}w(null),f({status:"submitting"});try{const n=await(await fetch("/api/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:i})})).json();if(!n.success){ue();let u=n.error;n.code==="INVALID_UUID_FORMAT"?u=r()("auth.login.invalidFormat"):n.code==="UUID_NOT_FOUND"&&(u=r()("auth.login.notFound")),f({status:"error",message:u,code:n.code});return}if(H())try{localStorage.setItem(V,i)}catch(u){console.error("Error saving to localStorage:",u)}else try{localStorage.removeItem(V)}catch(u){console.error("Error removing from localStorage:",u)}const b=W.redirectTo||"/dashboard";window.location.href=b}catch(l){console.error("Error during login:",l),f({status:"error",message:r()("common.errors.unexpected"),code:"UNEXPECTED_ERROR"})}},j=()=>{const t=I();return!t||Date.now()>t?F:Math.max(0,F-K())},q=()=>{const t=s();return t.status==="submitting"||t.status==="rateLimited"||!L().trim()};return(()=>{var t=$(Ue),o=t.firstChild,i=o.firstChild,l=i.firstChild,n=l.nextSibling,b=i.nextSibling,u=b.firstChild,G=u.firstChild,d=G.nextSibling,ge=d.nextSibling,[be,he]=A(ge.nextSibling),Q=u.nextSibling,ve=Q.firstChild,y=ve.firstChild,fe=y.nextSibling,xe=Q.nextSibling,[Z,pe]=A(xe.nextSibling),$e=Z.nextSibling,[ee,_e]=A($e.nextSibling),T=ee.nextSibling,Se=b.nextSibling,te=Se.firstChild,re=te.nextSibling,we=re.nextSibling;return a(l,()=>r()("auth.login.title")),a(n,()=>r()("auth.login.subtitle")),b.addEventListener("submit",me),a(G,()=>r()("auth.uuid.title")),d.addEventListener("blur",de),d.addEventListener("paste",oe),d.$$input=e=>Y(e.currentTarget.value),g(d,"spellcheck",!1),a(u,E(k,{get when(){return S()},get children(){var e=$(Ie);return a(e,S),e}}),be,he),y.addEventListener("change",e=>J(e.currentTarget.checked)),a(fe,()=>r()("auth.login.rememberDevice")),a(b,E(k,{get when(){return s().status==="error"},children:e=>(()=>{var c=$(Re),m=c.firstChild,x=m.firstChild,h=x.nextSibling,v=h.firstChild,U=v.nextSibling,[M,R]=A(U.nextSibling);return a(v,()=>e().message),a(h,E(k,{get when(){return De(()=>j()>0)()&&j()<F},get children(){var C=$(Me);return a(C,()=>r()("auth.login.attemptsRemaining",{count:j()})),C}}),M,R),c})()}),Z,pe),a(b,E(k,{get when(){return s().status==="rateLimited"},children:e=>(()=>{var c=$(Ae),m=c.firstChild,x=m.firstChild,h=x.nextSibling,v=h.firstChild;return a(v,()=>r()("auth.login.rateLimitExceeded",{seconds:e().remainingSeconds})),c})()}),ee,_e),a(T,E(k,{get when(){return s().status==="submitting"},get fallback(){return r()("auth.login.submit")},get children(){var e=$(Te),c=e.firstChild,m=c.nextSibling;return a(m,()=>r()("common.status.loading")),e}})),a(te,()=>r()("auth.login.newUser").split("{{link}}")[0]),a(re,()=>r()("auth.login.newUserLink")),a(we,()=>r()("auth.login.newUser").split("{{link}}")[1]||""),P(e=>{var c=`uuid-login ${W.class||""}`,m=r()("auth.login.title"),x=r()("auth.login.placeholder"),h=r()("auth.uuid.title"),v=!!S(),U=S()?"uuid-error":void 0,M=s().status==="submitting"||s().status==="rateLimited",R=`
                w-full px-4 py-3 text-lg font-mono tracking-wider text-center
                border-2 rounded-lg shadow-sm
                focus:outline-none focus:ring-4 focus:ring-blue-300
                transition-all duration-200
                min-h-44px
                ${S()||s().status==="error"?"border-red-400 bg-red-50 text-red-900":"border-gray-300 bg-white text-gray-900 hover:border-blue-400"}
                ${s().status==="submitting"||s().status==="rateLimited"?"opacity-60 cursor-not-allowed":""}
              `,C=s().status==="submitting"||s().status==="rateLimited",ie=r()("auth.login.rememberDevice"),ne=q(),ae=`
              w-full px-6 py-4 text-lg font-bold rounded-lg shadow-lg
              transition-all duration-200
              focus:outline-none focus:ring-4 focus:ring-blue-300
              min-h-44px
              ${q()?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-60":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"}
            `,se=s().status==="submitting"?r()("common.status.loading"):r()("auth.login.submit");return c!==e.e&&B(t,e.e=c),m!==e.t&&g(t,"aria-label",e.t=m),x!==e.a&&g(d,"placeholder",e.a=x),h!==e.o&&g(d,"aria-label",e.o=h),v!==e.i&&g(d,"aria-invalid",e.i=v),U!==e.n&&g(d,"aria-describedby",e.n=U),M!==e.s&&D(d,"disabled",e.s=M),R!==e.h&&B(d,e.h=R),C!==e.r&&D(y,"disabled",e.r=C),ie!==e.d&&g(y,"aria-label",e.d=ie),ne!==e.l&&D(T,"disabled",e.l=ne),ae!==e.u&&B(T,e.u=ae),se!==e.c&&g(T,"aria-label",e.c=se),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0}),P(()=>D(d,"value",L())),P(()=>D(y,"checked",H())),Ee(),t})()}ye(["input"]);export{je as default};
